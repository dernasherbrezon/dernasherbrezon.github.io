---
title: "Расчёт вероятности ошибки для BPSK"
date: 2019-05-05T18:22:18+01:00
draft: false
mathjax: true
chartjs: true
cover: /img/ber-bpsk/ber-bpsk.png
tags:
  - radio
  - bpsk
  - ber
  - awgn
  - matlab
---

## Введение

Моя сеть приёма сигналов со спутников [r2cloud](https://github.com/dernasherbrezon/r2cloud) постепенно растёт. Однако уровень приёма оставляет желать лучшего. Несмотря на то, что на спектограмме виден сигнал, демодулятор не может восстановить его. В попытках найти проблему, я понял, что мне не хватает фундаментальных знаний по теории обработки сигналов и некоторой математики. Дело в том, что в интернете зачастую выкладываются демодуляторы без обоснования их работы. Меня это не устраивает, потому что нужны метрики по которым я буду понимать насколько один алгоритм эффективнее другого. И стал ли новый код лучше, если я добавлю какой-нибудь другой блок в обработку.

Всё это привело меня к \\( E_b / N_0 \\). Эта метрика показывает отношение энергии сигнала, приходящейся на 1 бит принимаемого сообщения (\\( E_b \\)), к энергетической спектральной плотности шума (\\( N_0 \\)). Почему она так важна? Дело в том, что она не зависит от способа модуляции сигнала и пропускной способности канала. Из-за этого её можно использовать, чтобы сравнивать различные модуляции между собой. Обычно строят график отношения \\( E_b / N_0 \\) к вероятности ошибки (BER). Вот [пример](https://ru.wikipedia.org/wiki/Eb/N0) графика сравнения BPSK/QPSK/8-PSK/16-PSK:

![](/img/ber-bpsk/PSK_BER_curves.svg)

Что из этого графика можно понять?

 1. Если увеличивать энергию передаваемого бита, то уменьшается вероятность возникновения ошибки.
 2. В BPSK/QPSK ошибка возникает значительно реже, чем в 8-PSK и 16-PSK при одинаковых значениях энергии передаваемого бита.
 3. График, например, читается следующим образом: при \\( E_b / N_0 \\) равным 4 децибелла и BPSK модуляции можно получить 1 ошибочный бит на каждые 100 полученных.

Мне же график прежде всего нужен:

 1. Сравнивать теоретические значения с практической реализацией демодулятора. Прямо сейчас я точно знаю, что различия есть из-за ограниченной точности АЦП. Дело в том, что rtl-sdr имеет разрешающую способность 8 бит. А в теории числа могут быть бесконечной точности. Именно эта разница и должна давать ошибку.
 2. Анализировать улучшится ли демодулятор, если добавить какой-то определённый блок. Как минимум я хочу попробовать различные алгоритмы получения несущего сигнала и компенсации [многолучевого распространения](https://ru.wikipedia.org/wiki/Многолучевое_распространение).
 
Ну и для того, чтобы понять математику, я решил проделать выводы сам. Ниже я буду рассчитывать вероятности ошибки для BPSK (см. синий график выше). Вдохновение я черпал у [dsplog](http://www.dsplog.com/2007/08/05/bit-error-probability-for-bpsk-modulation/) плюс добавлял свои мысли.

## Дано

Прежде всего необходимо описать физику процесса. Схема процесса показана ниже:

![](/img/ber-bpsk/bpsk.png)

 1. Изначальное сообщение кодируется в аналоговый сигнал. "1" кодируется в \\(+\sqrt{E_b}\\), "0" кодируется в \\(-\sqrt{E_b}\\). Почему именно как корень из \\(E_b\\)? Не знаю. Это единственное место, где я не разобрался.
 2. После этого сигнал складывается с [аддитивным белым гауссовским шумом](https://ru.wikipedia.org/wiki/Аддитивный_белый_гауссовский_шум).
 3. Далее сигнал демодулируется.
 
Модулированный BPSK сигнал выглядит следующим образом:

[![](/img/ber-bpsk/bpsk-constellation.png)](/img/ber-bpsk/bpsk-constellation.m)

Красными точками обозначается сигнал без шума. Синими - сигнал с добавлением белого гауссовского шума. Как демодулируется этот сигнал? Все точки, которые больше "0" становятся "1", а те, что меньше "0" становятся "0". На рисунке выше все синие точки достаточно далеко от "0", поэтому информацию можно однозначно восстановить. Но что если шум будет сильнее?

[![](/img/ber-bpsk/ber-awgn.png)](/img/ber-bpsk/ber-awgn.m)

Тут уже не всё так однозначно. Видно, что некоторые точки закодированные как "1" на самом деле оказались меньше "0". И если бы я попытался их демодулировать, то получил бы неправильную информацию.

## Решение

Теперь, когда стало понятно влияние шума на результат демодуляции, можно переходить к графику зависимости вероятности от энергии сигнала. Этот график поможет посчитать вероятность ошибок для различных входных значений. Для начала возьмём сигнал без шума. Вероятность получения "0" или "1" всегда 1.

[![](/img/ber-bpsk/no-error-bpsk.png)](/img/ber-bpsk/no-error-bpsk.m)

Частота получения ошибочных битов (Bit error rate) будет 0. Т.е. 0 ошибочных битов на бесконечное количество принятых. В случае наличия гауссовского шума, вероятность получения определяется гауссовской функцией вероятности:

[![](/img/ber-bpsk/awgn-bpsk.png)](/img/ber-bpsk/awgn-bpsk.m)

Гауссовский шум определяется следующей формулой:

$$
p(x) = \dfrac{1}{\sqrt{2\pi\sigma^2}}e^\dfrac{-(x-\mu)^2}{2\sigma^2}
$$

Где:

 - \\(\mu=0\\),
 - \\(\sigma^2=N_0/2\\)
 
При передаче "1" \\(\mu=+\sqrt{E_b}\\), при "0" \\(\mu=-\sqrt{E_b}\\). Подставляя это в формулу:

$$
\begin{align}
P(x|s_0)=\dfrac{1}{\sqrt{\pi N_0}}e^\dfrac{-(x+\sqrt{E_b})^2}{N_0} \newline
P(x|s_1)=\dfrac{1}{\sqrt{\pi N_0}}e^\dfrac{-(x-\sqrt{E_b})^2}{N_0}
\end{align}
$$

Теперь самое интересное. 

![](/img/ber-bpsk/awgn-bpsk-error.png)

На этом рисунке показаны области возникновения ошибки. Зелёная область - это место где возникает ошибка при передаче "1", красная - при передаче "0". Общую вероятность ошибки можно записать с помощью формулы полной вероятности:

$$
P(error)=\dfrac{1}{2}P(error|s\_0) + \dfrac{1}{2}P(error|s\_1)
$$ 

После этого необходимо найти каждую из вероятностей:

$$
\begin{align}
P(error|s\_0) = \int\_{0}^{\infty}P(x|s\_0)dx = \dfrac{1}{\sqrt{\pi N\_0}}\int\_{0}^{\infty}e^\dfrac{-(x+\sqrt{E\_b})^2}{N_0}dx \newline
P(error|s\_1) = \int\_{-\infty}^{0}P(x|s\_1)dx = \dfrac{1}{\sqrt{\pi N\_0}}\int\_{-\infty}^{0}e^\dfrac{-(x-\sqrt{E\_b})^2}{N_0}dx 
\end{align}
$$

Обычно вероятность ошибки записывают с помощью [функции ошибок](https://ru.wikipedia.org/wiki/Функция_ошибок):

$$
erfc(x)=\dfrac{2}{\sqrt\pi}\int\_{0}^{x}e^{-t^2}dt
$$

Для этого необходимо сделать следующее:

$$
z=\dfrac{y+\sqrt{E\_b}}{\sqrt{N\_0}} => z\sqrt{N\_0} = y + \sqrt{E\_b}
$$

Заменить пределы интегрирования:

$$
\begin{align}
y=0 => z = \dfrac{\sqrt{E\_b}}{\sqrt{N\_0}} \newline
y=\infty => z = \infty
\end{align}
$$

Получившаяся ошибка записывается как:

$$
\begin{align}
P(error|s\_0)=\dfrac{1}{\sqrt{\pi N\_0}}\int\_\limits{\sqrt{\dfrac{E\_b}{N\_0}}}^{\infty}e^{-z^2}\sqrt{N_0}dz 
=\dfrac{1}{\sqrt{\pi}}\int\_\limits{\sqrt{\dfrac{E\_b}{N\_0}}}^{\infty}e^{-z^2}dz
=\dfrac{1}{2}erfc(\sqrt{\dfrac{E\_b}{N\_0}})
\end{align}
$$

Аналогично можно найти ошибку при передачи "1":

$$
\begin{align}
P(error|s\_1)=1-P(s\_1)=1-\dfrac{1}{2}erfc(-\sqrt{\dfrac{E\_b}{N\_0}})
\end{align}
$$

Можно воспользоваться свойством функции ошибок:

$$
\begin{align}
erfc(-x)=2-erfc(x) => P(error|s\_1) = \dfrac{1}{2}erfc(\sqrt{\dfrac{E\_b}{N\_0}})
\end{align}
$$

Если подставить в формулу полной вероятности:

$$
P(error)=\dfrac{1}{2}(\dfrac{1}{2}erfc(\sqrt{\dfrac{E\_b}{N\_0}})) + \dfrac{1}{2}(\dfrac{1}{2}erfc(\sqrt{\dfrac{E\_b}{N\_0}}))=\dfrac{1}{2}erfc(\sqrt{\dfrac{E\_b}{N\_0}})
$$

## Ответ

Получившийся график:

{{< chartjs url="/static/img/ber-bpsk/ber-bpsk.json" id="berBpsk" title="BPSK BER" datasource="ber" datasourceLabel="Bit Error Rate" yAxisLabel="Bit Error Rate" yAxisUnit="" yMax="1" yAxisLogarithmic="true" yMaxTicksLimit="7" xAxis="ebno" xAxisLabel="Eb/No" xAxisUnit="dB" xMaxTicksLimit="11" staticSrc="/img/ber-bpsk/ber-bpsk.png" >}}
