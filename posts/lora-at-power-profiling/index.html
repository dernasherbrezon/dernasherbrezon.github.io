<!DOCTYPE html>
<html lang='ru' dir='auto'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Как следует разобравшись с тем, как работает Power Profiler Kit 2 (PPK2), я решил протестировать разные режимы работы. На самом деле lora-at - не такое уж и простое приложение. В нём есть работа с bluetooth и чипом sx127x, обработка команд с UART шины и режим глубокого сна. Есть, где развернуться.
Методология измерений Перед тем как начинать что-то измерять, необходимо определиться с тем, как это будет измеряться.
Во-первых, я собираюсь использовать PPK2 по-максимуму.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Тестирование потребления энергии в lora-at • dernasherbrezon'>
<meta property='og:description' content='Как следует разобравшись с тем, как работает Power Profiler Kit 2 (PPK2), я решил протестировать разные режимы работы. На самом деле lora-at - не такое уж и простое приложение. В нём есть работа с bluetooth и чипом sx127x, обработка команд с UART шины и режим глубокого сна. Есть, где развернуться.
Методология измерений Перед тем как начинать что-то измерять, необходимо определиться с тем, как это будет измеряться.
Во-первых, я собираюсь использовать PPK2 по-максимуму.'>
<meta property='og:url' content='https://dernasherbrezon.com/posts/lora-at-power-profiling/'>
<meta property='og:site_name' content='dernasherbrezon'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='lora'><meta property='article:tag' content='lora-at'><meta property='article:tag' content='esp32'><meta property='article:tag' content='esp-idf'><meta property='article:published_time' content='2023-11-25T23:28:18&#43;01:00'/><meta property='article:modified_time' content='2023-11-25T23:28:18&#43;01:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@dernasherbrezon'>

<meta name="generator" content="Hugo 0.124.0">

  <title>Тестирование потребления энергии в lora-at • dernasherbrezon</title>
  <link rel='canonical' href='https://dernasherbrezon.com/posts/lora-at-power-profiling/'>
  
    <link href="https://dernasherbrezon.com/posts/lora-at-power-profiling/index.xml" rel="alternate" type="application/rss+xml" title="dernasherbrezon" />
  
  <link rel='alternate' hreflang='ru' href='https://dernasherbrezon.com/posts/lora-at-power-profiling/'><link rel='alternate' hreflang='x-default' href='https://dernasherbrezon.com/posts/lora-at-power-profiling/'><link rel='alternate' hreflang='en' href='https://dernasherbrezon.com/en/posts/lora-at-power-profiling/'>
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><link rel='stylesheet' href='/css/custom.1.css'><style>
:root{--color-accent:#ffcd00;}
</style>

  <meta name="telegram:channel" content="@dernasherbrezonChannel">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><script src="/js/chart.min.js"></script>
</head>
<body class='page type-posts has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'></a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/img/logo.jpeg'>
      </a>
    </div>
    
    <h2 class='title site-title '>
      <a href='/'>
      dernasherbrezon
      </a>
    </h2>
    <div class='desc'>
    Блог о программировании на Java
    </div>
  </header>

</section>
<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label=''>
    <div class='container'>
      <ul><li class='item has-current'>
  <a href='/posts/'>Все записи</a></li><li class='item'>
  <a href='/products/'>Гаджеты</a></li><li class='item'>
  <a href='/%D0%BE%D0%B1-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B5/'>Об авторе</a></li><li class='item'>
  <a href='/%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D1%82%D1%8C/'>Поддержать</a></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Тэги</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud'><li>
        <a href='/tags/abbreviated-jpeg/' style='font-size:1.0204081632653061em'>abbreviated jpeg</a>
      </li><li>
        <a href='/tags/acme/' style='font-size:1em'>Acme</a>
      </li><li>
        <a href='/tags/api/' style='font-size:1.0612244897959184em'>api</a>
      </li><li>
        <a href='/tags/apt/' style='font-size:1.0612244897959184em'>Apt</a>
      </li><li>
        <a href='/tags/awgn/' style='font-size:1em'>Awgn</a>
      </li><li>
        <a href='/tags/bash/' style='font-size:1.0204081632653061em'>bash</a>
      </li><li>
        <a href='/tags/ber/' style='font-size:1.1020408163265305em'>ber</a>
      </li><li>
        <a href='/tags/bluetooth/' style='font-size:1.0204081632653061em'>Bluetooth</a>
      </li><li>
        <a href='/tags/bpsk/' style='font-size:1.0204081632653061em'>bpsk</a>
      </li><li>
        <a href='/tags/c/' style='font-size:1.4489795918367347em'>C</a>
      </li><li>
        <a href='/tags/deb/' style='font-size:1.0816326530612246em'>Deb</a>
      </li><li>
        <a href='/tags/docker/' style='font-size:1em'>Docker</a>
      </li><li>
        <a href='/tags/dsp/' style='font-size:1.1224489795918366em'>dsp</a>
      </li><li>
        <a href='/tags/eclipse/' style='font-size:1em'>Eclipse</a>
      </li><li>
        <a href='/tags/embedded/' style='font-size:1.163265306122449em'>embedded</a>
      </li><li>
        <a href='/tags/esp-idf/' style='font-size:1.0408163265306123em'>Esp-Idf</a>
      </li><li>
        <a href='/tags/esp32/' style='font-size:1.2040816326530612em'>Esp32</a>
      </li><li>
        <a href='/tags/flot/' style='font-size:1em'>Flot</a>
      </li><li>
        <a href='/tags/fsk/' style='font-size:1.0816326530612246em'>fsk</a>
      </li><li>
        <a href='/tags/gc/' style='font-size:1em'>Gc</a>
      </li><li>
        <a href='/tags/gdal/' style='font-size:1.0408163265306123em'>gdal</a>
      </li><li>
        <a href='/tags/georeferencing/' style='font-size:1.0612244897959184em'>georeferencing</a>
      </li><li>
        <a href='/tags/geotiff/' style='font-size:1.0612244897959184em'>geotiff</a>
      </li><li>
        <a href='/tags/gnuradio/' style='font-size:1.0612244897959184em'>gnuradio</a>
      </li><li>
        <a href='/tags/hibernate/' style='font-size:1em'>Hibernate</a>
      </li><li>
        <a href='/tags/hugo/' style='font-size:1.0204081632653061em'>Hugo</a>
      </li><li>
        <a href='/tags/j2ee/' style='font-size:1.0204081632653061em'>j2ee</a>
      </li><li>
        <a href='/tags/java/' style='font-size:2em'>Java</a>
      </li><li>
        <a href='/tags/javafx/' style='font-size:1em'>javafx</a>
      </li><li>
        <a href='/tags/javascript/' style='font-size:1.0816326530612246em'>javascript</a>
      </li><li>
        <a href='/tags/jetty/' style='font-size:1.0408163265306123em'>jetty</a>
      </li><li>
        <a href='/tags/jmeter/' style='font-size:1em'>Jmeter</a>
      </li><li>
        <a href='/tags/jpeg/' style='font-size:1.1020408163265305em'>jpeg</a>
      </li><li>
        <a href='/tags/jpoint/' style='font-size:1em'>jpoint</a>
      </li><li>
        <a href='/tags/jquery/' style='font-size:1em'>Jquery</a>
      </li><li>
        <a href='/tags/jsp/' style='font-size:1.0612244897959184em'>jsp</a>
      </li><li>
        <a href='/tags/jstl/' style='font-size:1.0408163265306123em'>jstl</a>
      </li><li>
        <a href='/tags/junit/' style='font-size:1.0408163265306123em'>Junit</a>
      </li><li>
        <a href='/tags/letsencrypt/' style='font-size:1em'>Letsencrypt</a>
      </li><li>
        <a href='/tags/log4j/' style='font-size:1em'>log4j</a>
      </li><li>
        <a href='/tags/lora/' style='font-size:1.163265306122449em'>Lora</a>
      </li><li>
        <a href='/tags/lora-at/' style='font-size:1.0816326530612246em'>Lora-At</a>
      </li><li>
        <a href='/tags/lrpt/' style='font-size:1.0408163265306123em'>lrpt</a>
      </li><li>
        <a href='/tags/matlab/' style='font-size:1.0204081632653061em'>Matlab</a>
      </li><li>
        <a href='/tags/maven/' style='font-size:1.1020408163265305em'>maven</a>
      </li><li>
        <a href='/tags/memory/' style='font-size:1.0204081632653061em'>memory</a>
      </li><li>
        <a href='/tags/meteor-m/' style='font-size:1.0816326530612246em'>meteor-m</a>
      </li><li>
        <a href='/tags/mobitex/' style='font-size:1em'>mobitex</a>
      </li><li>
        <a href='/tags/monitoring/' style='font-size:1.1020408163265305em'>monitoring</a>
      </li><li>
        <a href='/tags/open-source/' style='font-size:1.0408163265306123em'>Open Source</a>
      </li><li>
        <a href='/tags/openapi/' style='font-size:1.0204081632653061em'>openapi</a>
      </li><li>
        <a href='/tags/opencl/' style='font-size:1.0408163265306123em'>Opencl</a>
      </li><li>
        <a href='/tags/openstack/' style='font-size:1em'>Openstack</a>
      </li><li>
        <a href='/tags/openstack-swift/' style='font-size:1em'>Openstack Swift</a>
      </li><li>
        <a href='/tags/orekit/' style='font-size:1.0204081632653061em'>orekit</a>
      </li><li>
        <a href='/tags/pipe/' style='font-size:1em'>Pipe</a>
      </li><li>
        <a href='/tags/plutosdr/' style='font-size:1.0204081632653061em'>Plutosdr</a>
      </li><li>
        <a href='/tags/prometheus/' style='font-size:1.0204081632653061em'>prometheus</a>
      </li><li>
        <a href='/tags/r2cloud/' style='font-size:1.0816326530612246em'>r2cloud</a>
      </li><li>
        <a href='/tags/r2lora/' style='font-size:1.0612244897959184em'>R2lora</a>
      </li><li>
        <a href='/tags/r2weather/' style='font-size:1.0408163265306123em'>R2weather</a>
      </li><li>
        <a href='/tags/radio/' style='font-size:1.2448979591836735em'>Радио</a>
      </li><li>
        <a href='/tags/raspberrypi/' style='font-size:1.4489795918367347em'>raspberrypi</a>
      </li><li>
        <a href='/tags/refactoring/' style='font-size:1em'>Refactoring</a>
      </li><li>
        <a href='/tags/rest/' style='font-size:1.0204081632653061em'>Rest</a>
      </li><li>
        <a href='/tags/rrd/' style='font-size:1.0204081632653061em'>rrd</a>
      </li><li>
        <a href='/tags/rtl_power/' style='font-size:1.0204081632653061em'>rtl_power</a>
      </li><li>
        <a href='/tags/rtlsdr/' style='font-size:1.2448979591836735em'>rtlsdr</a>
      </li><li>
        <a href='/tags/rtlspectrum/' style='font-size:1.0408163265306123em'>rtlSpectrum</a>
      </li><li>
        <a href='/tags/s3/' style='font-size:1em'>S3</a>
      </li><li>
        <a href='/tags/satnogs/' style='font-size:1.0408163265306123em'>Satnogs</a>
      </li><li>
        <a href='/tags/sdr-modem/' style='font-size:1.0612244897959184em'>Sdr-Modem</a>
      </li><li>
        <a href='/tags/sdr-server/' style='font-size:1em'>Sdr-Server</a>
      </li><li>
        <a href='/tags/security/' style='font-size:1.0204081632653061em'>Security</a>
      </li><li>
        <a href='/tags/selectel/' style='font-size:1em'>Selectel</a>
      </li><li>
        <a href='/tags/simd/' style='font-size:1.1020408163265305em'>SIMD</a>
      </li><li>
        <a href='/tags/sonarcube/' style='font-size:1.0408163265306123em'>Sonarcube</a>
      </li><li>
        <a href='/tags/spring/' style='font-size:1.0408163265306123em'>Spring</a>
      </li><li>
        <a href='/tags/sqnr/' style='font-size:1em'>Sqnr</a>
      </li><li>
        <a href='/tags/ssdv/' style='font-size:1.0204081632653061em'>Ssdv</a>
      </li><li>
        <a href='/tags/string/' style='font-size:1.0204081632653061em'>String</a>
      </li><li>
        <a href='/tags/sx127x/' style='font-size:1.1428571428571428em'>Sx127x</a>
      </li><li>
        <a href='/tags/systemd/' style='font-size:1em'>Systemd</a>
      </li><li>
        <a href='/tags/testing/' style='font-size:1.0408163265306123em'>Testing</a>
      </li><li>
        <a href='/tags/travis-ci/' style='font-size:1.0204081632653061em'>Travis-Ci</a>
      </li><li>
        <a href='/tags/ubuntu/' style='font-size:1.0816326530612246em'>ubuntu</a>
      </li><li>
        <a href='/tags/valgrind/' style='font-size:1.0408163265306123em'>Valgrind</a>
      </li><li>
        <a href='/tags/validator/' style='font-size:1em'>Validator</a>
      </li><li>
        <a href='/tags/vuejs/' style='font-size:1.0408163265306123em'>vuejs</a>
      </li><li>
        <a href='/tags/yourkit/' style='font-size:1em'>Yourkit</a>
      </li><li>
        <a href='/tags/%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/' style='font-size:1.3265306122448979em'>администрирование</a>
      </li><li>
        <a href='/tags/%D0%B4%D0%B7%D0%B7/' style='font-size:1.0816326530612246em'>ДЗЗ</a>
      </li><li>
        <a href='/tags/%D0%B4%D0%B8%D0%B7%D0%B0%D0%B9%D0%BD/' style='font-size:1.0816326530612246em'>дизайн</a>
      </li><li>
        <a href='/tags/%D0%B8%D0%B4%D0%B5%D0%B8/' style='font-size:1em'>Идеи</a>
      </li><li>
        <a href='/tags/%D0%BA%D0%BE%D1%81%D0%BC%D0%BE%D0%BD%D0%B0%D0%B2%D1%82%D0%B8%D0%BA%D0%B0/' style='font-size:1.0408163265306123em'>космонавтика</a>
      </li><li>
        <a href='/tags/%D0%BA%D1%83%D0%B1%D1%81%D0%B0%D1%82/' style='font-size:1.0408163265306123em'>кубсат</a>
      </li><li>
        <a href='/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4/' style='font-size:1.0204081632653061em'>перевод</a>
      </li><li>
        <a href='/tags/%D0%BF%D0%BE%D0%B2%D0%BE%D1%80%D0%BE%D1%82%D0%BD%D0%BE%D0%B5-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE/' style='font-size:1.1020408163265305em'>поворотное устройство</a>
      </li><li>
        <a href='/tags/%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C/' style='font-size:1.346938775510204em'>производительность</a>
      </li><li>
        <a href='/tags/%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/' style='font-size:1.0612244897959184em'>Разработка</a>
      </li><li>
        <a href='/tags/%D1%81%D0%BF%D0%B5%D1%86%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F/' style='font-size:1em'>Спецификация</a>
      </li><li>
        <a href='/tags/%D1%81%D0%BF%D1%83%D1%82%D0%BD%D0%B8%D0%BA%D0%B8/' style='font-size:1.4285714285714286em'>спутники</a>
      </li><li>
        <a href='/tags/%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/' style='font-size:1.2653061224489797em'>Тестирование</a>
      </li><li>
        <a href='/tags/%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D1%8B/' style='font-size:1.0408163265306123em'>фильтры</a>
      </li></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><nav id='main-menu' class='menu main-menu' aria-label=''>
  <div class='container'>
    <a class='screen-reader-text' href='#content'></a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'></span>
  <span class='open'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><line x1="3" y1="12" x2="21" y2="12" />
<line x1="3" y1="6" x2="21" y2="6" />
<line x1="3" y1="18" x2="21" y2="18" />
</svg>
</span>
  <span class='close'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><line x1="18" y1="6" x2="6" y2="18" />
<line x1="6" y1="6" x2="18" y2="18" />
</svg>
</span>
</button>
    <ul><li class='item current'>
        <a aria-current='page' href='/posts/'>Все записи</a>
      </li><li class='item'>
        <a href='/products/'>Гаджеты</a>
      </li><li class='item'>
        <a href='/%D0%BE%D0%B1-%D0%B0%D0%B2%D1%82%D0%BE%D1%80%D0%B5/'>Об авторе</a>
      </li><li class='item'>
        <a href='/%D0%BF%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D1%82%D1%8C/'>Поддержать</a>
      </li></ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>dernasherbrezon</p><p class='desc site-desc'>Блог о программировании на Java</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='ru' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Тестирование потребления энергии в lora-at</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
<line x1="16" y1="2" x2="16" y2="6" />
<line x1="8" y1="2" x2="8" y2="6" />
<line x1="3" y1="10" x2="21" y2="10" />
</svg>
<span class='screen-reader-text'> </span>
  <time class='entry-date' datetime='2023-11-25T23:28:18&#43;01:00'>25 Nov 2023</time>
</span>

  
  

</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p>Как следует разобравшись с тем, <a href="https://dernasherbrezon.com/posts/power-profiler-kit2/">как работает Power Profiler Kit 2 (PPK2)</a>, я решил протестировать разные режимы работы. На самом деле <a href="https://github.com/dernasherbrezon/lora-at">lora-at</a> - не такое уж и простое приложение. В нём есть работа с bluetooth и чипом sx127x, обработка команд с UART шины и режим глубокого сна. Есть, где развернуться.</p>
<h2 id="методология-измерений">Методология измерений</h2>
<p>Перед тем как начинать что-то измерять, необходимо определиться с тем, как это будет измеряться.</p>
<p><strong>Во-первых</strong>, я собираюсь <a href="https://dernasherbrezon.com/products/ppk2/">использовать PPK2</a> по-максимуму. Некоторые тесты требует десятки измерений и делать их вручную не имеет смысла. Я написал небольшой скрипт, который позволял отправлять разные AT команды на устройство, а потом выбирать данные из .CSV файла и группировать нужным образом. Так вот, чтобы понять когда началось измерение, а когда закончилось, я использовал встроенный логический анализатор.</p>
<p><strong>Во-вторых</strong>, некоторые процессы протекают быстро и потребляют много энергии, а некоторые - медленно и потребляют мало энергии. Сравнивать среднее потребление тока в таком случае некорректно. Там, где имеет смысл сравнивать такие процессы, я сравнивал величину заряда. Она измеряется в кулонах. Кулон (Кл) — это величина заряда, прошедшего через сечение проводника при силе тока 1 А за время 1 с. PPK2 интегрирует график по времени и может очень быстро отображать потраченный заряд за выбранный интервал. Прям чувствуется атмосфера лабы по физике.</p>
<p><strong>В-третьих</strong>, параметров, которые могут влиять на потребление энергии, очень много. Для этого я фиксировал одни и менял другие. Такой подход позволил хоть как-то сравнивать и анализировать результаты. Например, для всех тестов я использовал <a href="https://dernasherbrezon.com/products/heltec-lora32-v2/">Heltec LoRa 32 v2</a>, который работал на частоте 80Мгц.</p>
<p><strong>В-четвёртых</strong>, PPK2 сэмплирует со скоростью 100Кгц, что генерирует достаточно большое количество данных. Все эти точки невозможно отобразить на графике, поэтому я брал среднее за некоторый интервал. Это не влияет на результирующее значение потраченного заряда, но немного сглаживает сам график.</p>
<p><strong>В-пятых</strong>, измеряется потребление энергии всей платы, а не конкретных компонент.</p>
<h2 id="sx127x">sx127x</h2>
<p>Начать, пожалуй, лучше всего с самого основного - чипа sx127x. Он поддерживает разные типы модуляции, приём и передачу данных, их скорость, усилители мощности и многое другое. Я решил померить лишь те, которые теоретически могут повлиять на потребление энергии. И даже после этого, тестов оказалось приличное количество.</p>
<h4 id="получение-данных">Получение данных</h4>
<p>Для тестирования приёмника, я настроил второй модуль, который отправляет короткое сообщение:</p>
<pre tabindex="0"><code>AT+LORATX=CAFE,433200012,125000,9,5,18,10,8,4,0,0,1,0
</code></pre><p>А измеряемый модуль принимает:</p>
<pre tabindex="0"><code>AT+LORARX=433200012,125000,9,5,18,10,8,4,0,0,1,0
</code></pre><p>После чего, то же самое для FSK модуляции:</p>
<pre tabindex="0"><code>AT+FSKTX=CAFE,433200012,4800,5000,4,12AD,0,2,1,4,0,0
</code></pre><p>И приём:</p>
<pre tabindex="0"><code>AT+FSKRX=433200012,4800,5000,4,12AD,0,2,1,4,5000,20000
</code></pre><p>В итоге получился следующий график:</p>
































<canvas id="fskVsLora" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="fskVsLora" download="fskVsLora.png" href="" title="Сравнение FSK и LoRa">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var fskVsLoraData = [{"fsk2bytes":37.23,"lora2bytes":36.62,"time":0},{"fsk2bytes":39.22,"lora2bytes":38.18,"time":0.05},{"fsk2bytes":41.02,"lora2bytes":39.54,"time":0.12},{"fsk2bytes":42.27,"lora2bytes":40.57,"time":0.17},{"fsk2bytes":43.45,"lora2bytes":41.49,"time":0.23},{"fsk2bytes":44.67,"lora2bytes":42.38,"time":0.3},{"fsk2bytes":45.28,"lora2bytes":42.77,"time":0.35},{"fsk2bytes":46.26,"lora2bytes":43.22,"time":0.42},{"fsk2bytes":48.13,"lora2bytes":43.45,"time":0.48},{"fsk2bytes":48.77,"lora2bytes":43.62,"time":0.53},{"fsk2bytes":49.34,"lora2bytes":43.72,"time":0.6},{"fsk2bytes":48.52,"lora2bytes":43.82,"time":0.66},{"fsk2bytes":48.53,"lora2bytes":43.73,"time":0.71},{"fsk2bytes":48.71,"lora2bytes":43.89,"time":0.78},{"fsk2bytes":47.92,"lora2bytes":43.98,"time":0.83},{"fsk2bytes":47.79,"lora2bytes":44,"time":0.89},{"fsk2bytes":48.27,"lora2bytes":44.2,"time":0.96},{"fsk2bytes":48.17,"lora2bytes":44.56,"time":1.01},{"fsk2bytes":46.86,"lora2bytes":44.62,"time":1.08},{"fsk2bytes":45.66,"lora2bytes":44.57,"time":1.14},{"fsk2bytes":45.04,"lora2bytes":44.67,"time":1.19},{"fsk2bytes":43.94,"lora2bytes":44.89,"time":1.26},{"fsk2bytes":44.02,"lora2bytes":45.91,"time":1.32},{"fsk2bytes":44.23,"lora2bytes":46.64,"time":1.37},{"fsk2bytes":44.53,"lora2bytes":47.19,"time":1.44},{"fsk2bytes":45.26,"lora2bytes":48.03,"time":1.5},{"fsk2bytes":46.63,"lora2bytes":47.11,"time":1.55},{"fsk2bytes":45.68,"lora2bytes":46.72,"time":1.62},{"fsk2bytes":43.71,"lora2bytes":46.61,"time":1.67},{"fsk2bytes":43.96,"lora2bytes":46.9,"time":1.73},{"fsk2bytes":44.37,"lora2bytes":46.43,"time":1.8},{"fsk2bytes":44.15,"lora2bytes":44.05,"time":1.85},{"fsk2bytes":44.72,"lora2bytes":42.35,"time":1.92},{"fsk2bytes":45.3,"lora2bytes":41.63,"time":1.98},{"fsk2bytes":44.59,"lora2bytes":41.25,"time":2.03},{"fsk2bytes":44.98,"lora2bytes":40.54,"time":2.1},{"fsk2bytes":46.03,"lora2bytes":39.43,"time":2.16},{"fsk2bytes":44.97,"lora2bytes":38.26,"time":2.21},{"fsk2bytes":43.84,"lora2bytes":36.99,"time":2.28},{"fsk2bytes":44.79,"lora2bytes":36.45,"time":2.33},{"fsk2bytes":45.26,"lora2bytes":36.3,"time":2.39},{"fsk2bytes":45.08,"lora2bytes":36.17,"time":2.46},{"fsk2bytes":44.61,"lora2bytes":35.47,"time":2.51},{"fsk2bytes":45.88,"lora2bytes":35.88,"time":2.58},{"fsk2bytes":46.32,"lora2bytes":35.85,"time":2.64},{"fsk2bytes":44.86,"lora2bytes":36.11,"time":2.69},{"fsk2bytes":45.45,"lora2bytes":37.12,"time":2.76},{"fsk2bytes":46.06,"lora2bytes":37.58,"time":2.82},{"fsk2bytes":45.08,"lora2bytes":36.92,"time":2.87},{"fsk2bytes":44.96,"lora2bytes":35.71,"time":2.94},{"fsk2bytes":44.73,"lora2bytes":34.84,"time":3},{"fsk2bytes":46.17,"lora2bytes":35.11,"time":3.05},{"fsk2bytes":45.56,"lora2bytes":35.56,"time":3.12},{"fsk2bytes":44.35,"lora2bytes":35.72,"time":3.17},{"fsk2bytes":43.82,"lora2bytes":35.85,"time":3.23},{"fsk2bytes":44.04,"lora2bytes":36.59,"time":3.3},{"fsk2bytes":44.09,"lora2bytes":36.7,"time":3.35},{"fsk2bytes":45.43,"lora2bytes":36.19,"time":3.42},{"fsk2bytes":46.1,"lora2bytes":35.96,"time":3.48},{"fsk2bytes":45.75,"lora2bytes":36.61,"time":3.53},{"fsk2bytes":45.79,"lora2bytes":37.64,"time":3.6},{"fsk2bytes":45.81,"lora2bytes":37.55,"time":3.66},{"fsk2bytes":44.83,"lora2bytes":36.74,"time":3.71},{"fsk2bytes":45.26,"lora2bytes":36.26,"time":3.78},{"fsk2bytes":45.71,"lora2bytes":36.22,"time":3.83},{"fsk2bytes":45.47,"lora2bytes":36.1,"time":3.89},{"fsk2bytes":43.8,"lora2bytes":36.04,"time":3.96},{"fsk2bytes":43.81,"lora2bytes":36.2,"time":4.01},{"fsk2bytes":43.67,"lora2bytes":35.95,"time":4.08},{"fsk2bytes":44.74,"lora2bytes":35.35,"time":4.14},{"fsk2bytes":44.22,"lora2bytes":36,"time":4.19},{"fsk2bytes":44.2,"lora2bytes":36.83,"time":4.26},{"fsk2bytes":44.44,"lora2bytes":37.25,"time":4.32},{"fsk2bytes":44.7,"lora2bytes":38.36,"time":4.37},{"fsk2bytes":44.99,"lora2bytes":37.61,"time":4.44},{"fsk2bytes":45.3,"lora2bytes":37.34,"time":4.5},{"fsk2bytes":46.17,"lora2bytes":36.53,"time":4.55},{"fsk2bytes":45.73,"lora2bytes":36.96,"time":4.62},{"fsk2bytes":44.93,"lora2bytes":36.38,"time":4.67},{"fsk2bytes":46.03,"lora2bytes":35.87,"time":4.73},{"fsk2bytes":45.23,"lora2bytes":36.01,"time":4.8},{"fsk2bytes":44.6,"lora2bytes":35.99,"time":4.85},{"fsk2bytes":45.62,"lora2bytes":37.29,"time":4.92},{"fsk2bytes":45.58,"lora2bytes":38.53,"time":4.98},{"fsk2bytes":45.08,"lora2bytes":38.27,"time":5.03},{"fsk2bytes":44.99,"lora2bytes":38.55,"time":5.1},{"fsk2bytes":45.26,"lora2bytes":38.67,"time":5.16},{"fsk2bytes":44.24,"lora2bytes":38.01,"time":5.21},{"fsk2bytes":44.58,"lora2bytes":37.02,"time":5.28},{"fsk2bytes":45.18,"lora2bytes":35.64,"time":5.33},{"fsk2bytes":44.07,"lora2bytes":35.54,"time":5.39},{"fsk2bytes":42.64,"lora2bytes":35.65,"time":5.46},{"fsk2bytes":42.53,"lora2bytes":35.56,"time":5.51},{"fsk2bytes":41.66,"lora2bytes":35.49,"time":5.58},{"fsk2bytes":39.64,"lora2bytes":36.97,"time":5.64},{"fsk2bytes":38.45,"lora2bytes":37.49,"time":5.69},{"fsk2bytes":37.79,"lora2bytes":36.79,"time":5.76},{"fsk2bytes":37.2,"lora2bytes":36.71,"time":5.82},{"fsk2bytes":36.81,"lora2bytes":36.67,"time":5.87},{"fsk2bytes":37.16,"lora2bytes":37.14,"time":5.94},{"fsk2bytes":37.64,"lora2bytes":38,"time":6},{"fsk2bytes":38.21,"lora2bytes":37.43,"time":6.05},{"fsk2bytes":39.64,"lora2bytes":36.32,"time":6.12},{"fsk2bytes":38.59,"lora2bytes":35.49,"time":6.17},{"fsk2bytes":36.76,"lora2bytes":35.57,"time":6.23},{"fsk2bytes":37.06,"lora2bytes":35.31,"time":6.3},{"fsk2bytes":37.6,"lora2bytes":35.21,"time":6.35},{"fsk2bytes":37.59,"lora2bytes":36.67,"time":6.42},{"fsk2bytes":38.35,"lora2bytes":37.28,"time":6.48},{"fsk2bytes":38.63,"lora2bytes":36.92,"time":6.53},{"fsk2bytes":38.1,"lora2bytes":37.08,"time":6.6},{"fsk2bytes":38.23,"lora2bytes":36.85,"time":6.66},{"fsk2bytes":39.39,"lora2bytes":36.25,"time":6.71},{"fsk2bytes":38.48,"lora2bytes":37.08,"time":6.78},{"fsk2bytes":37.96,"lora2bytes":37.3,"time":6.83},{"fsk2bytes":37.76,"lora2bytes":37.21,"time":6.89},{"fsk2bytes":37.65,"lora2bytes":37.74,"time":6.96},{"fsk2bytes":37.67,"lora2bytes":37.48,"time":7.01},{"fsk2bytes":37.16,"lora2bytes":37.22,"time":7.08},{"fsk2bytes":37.27,"lora2bytes":37.19,"time":7.14},{"fsk2bytes":37.98,"lora2bytes":37.23,"time":7.19},{"fsk2bytes":38.88,"lora2bytes":37.12,"time":7.26},{"fsk2bytes":39.43,"lora2bytes":37.47,"time":7.32},{"fsk2bytes":38.8,"lora2bytes":36.69,"time":7.37},{"fsk2bytes":37.99,"lora2bytes":36.21,"time":7.44},{"fsk2bytes":38.36,"lora2bytes":35.43,"time":7.5},{"fsk2bytes":38.04,"lora2bytes":35.56,"time":7.55},{"fsk2bytes":38.09,"lora2bytes":35.35,"time":7.62},{"fsk2bytes":37.76,"lora2bytes":35.16,"time":7.67},{"fsk2bytes":39.44,"lora2bytes":33.82,"time":7.73},{"fsk2bytes":39.19,"lora2bytes":34.55,"time":7.8},{"fsk2bytes":39.95,"lora2bytes":35.24,"time":7.85},{"fsk2bytes":39.61,"lora2bytes":35.61,"time":7.92},{"fsk2bytes":37.74,"lora2bytes":35.94,"time":7.98},{"fsk2bytes":36.94,"lora2bytes":35.88,"time":8.03},{"fsk2bytes":36.62,"lora2bytes":34.79,"time":8.1},{"fsk2bytes":36.98,"lora2bytes":35.86,"time":8.16},{"fsk2bytes":37.36,"lora2bytes":36.02,"time":8.21},{"fsk2bytes":38.72,"lora2bytes":35.98,"time":8.28},{"fsk2bytes":38.61,"lora2bytes":37.78,"time":8.33},{"fsk2bytes":38.7,"lora2bytes":37.88,"time":8.39},{"fsk2bytes":38.08,"lora2bytes":37.27,"time":8.46},{"fsk2bytes":37.86,"lora2bytes":37.08,"time":8.51},{"fsk2bytes":39.16,"lora2bytes":36.95,"time":8.58},{"fsk2bytes":38.41,"lora2bytes":36.75,"time":8.64},{"fsk2bytes":37.36,"lora2bytes":36.33,"time":8.69},{"fsk2bytes":37.25,"lora2bytes":36.37,"time":8.76},{"fsk2bytes":37.15,"lora2bytes":36.15,"time":8.82},{"fsk2bytes":38.13,"lora2bytes":37.21,"time":8.87},{"fsk2bytes":38.69,"lora2bytes":36.83,"time":8.94},{"fsk2bytes":38.51,"lora2bytes":36.31,"time":9},{"fsk2bytes":38.5,"lora2bytes":36.64,"time":9.05},{"fsk2bytes":38,"lora2bytes":37.33,"time":9.12},{"fsk2bytes":37.8,"lora2bytes":37.46,"time":9.17},{"fsk2bytes":37.71,"lora2bytes":37.08,"time":9.23},{"fsk2bytes":38.71,"lora2bytes":36.44,"time":9.3},{"fsk2bytes":39.22,"lora2bytes":36.8,"time":9.35},{"fsk2bytes":39.23,"lora2bytes":37.28,"time":9.42},{"fsk2bytes":39.46,"lora2bytes":36.13,"time":9.48},{"fsk2bytes":39.34,"lora2bytes":35.93,"time":9.53},{"fsk2bytes":39.19,"lora2bytes":36.39,"time":9.6},{"fsk2bytes":39.06,"lora2bytes":36.71,"time":9.66},{"fsk2bytes":38.98,"lora2bytes":36.32,"time":9.71},{"fsk2bytes":37.74,"lora2bytes":35.89,"time":9.78},{"fsk2bytes":36.9,"lora2bytes":36.69,"time":9.83},{"fsk2bytes":36.67,"lora2bytes":38.02,"time":9.89},{"fsk2bytes":36.64,"lora2bytes":38.21,"time":9.96},{"fsk2bytes":35.41,"lora2bytes":38.61,"time":10.01},{"fsk2bytes":36.18,"lora2bytes":38.61,"time":10.08},{"fsk2bytes":36.84,"lora2bytes":37.96,"time":10.14},{"fsk2bytes":37.37,"lora2bytes":36.78,"time":10.19},{"fsk2bytes":36.77,"lora2bytes":36.56,"time":10.26},{"fsk2bytes":37.18,"lora2bytes":36.88,"time":10.32},{"fsk2bytes":37.53,"lora2bytes":36.38,"time":10.37},{"fsk2bytes":38.43,"lora2bytes":36.08,"time":10.44},{"fsk2bytes":40.02,"lora2bytes":36.21,"time":10.5},{"fsk2bytes":39.64,"lora2bytes":36.28,"time":10.55},{"fsk2bytes":38.76,"lora2bytes":36.45,"time":10.62},{"fsk2bytes":37.96,"lora2bytes":37.49,"time":10.67},{"fsk2bytes":38.89,"lora2bytes":37.75,"time":10.73},{"fsk2bytes":37.75,"lora2bytes":36.62,"time":10.8},{"fsk2bytes":37.83,"lora2bytes":34.78,"time":10.85},{"fsk2bytes":38.71,"lora2bytes":34.83,"time":10.92},{"fsk2bytes":38.32,"lora2bytes":34.93,"time":10.98},{"fsk2bytes":37.85,"lora2bytes":35.81,"time":11.03},{"fsk2bytes":38.21,"lora2bytes":35.57,"time":11.1},{"fsk2bytes":38.41,"lora2bytes":35.79,"time":11.16},{"fsk2bytes":38.19,"lora2bytes":36.77,"time":11.21},{"fsk2bytes":38.24,"lora2bytes":36.92,"time":11.28},{"fsk2bytes":38.28,"lora2bytes":36.2,"time":11.33},{"fsk2bytes":37.62,"lora2bytes":35.74,"time":11.39},{"fsk2bytes":38.33,"lora2bytes":37.28,"time":11.46},{"fsk2bytes":39.76,"lora2bytes":37.43,"time":11.51},{"fsk2bytes":39.81,"lora2bytes":36.6,"time":11.58},{"fsk2bytes":38.61,"lora2bytes":35.21,"time":11.64},{"fsk2bytes":38.11,"lora2bytes":35.69,"time":11.69},{"fsk2bytes":37.6,"lora2bytes":36.12,"time":11.76},{"fsk2bytes":36.77,"lora2bytes":36.15,"time":11.82},{"fsk2bytes":37.07,"lora2bytes":36.97,"time":11.87},{"fsk2bytes":37.78,"lora2bytes":37.86,"time":11.94},{"fsk2bytes":37.96,"lora2bytes":37.4,"time":12},{"fsk2bytes":38.63,"lora2bytes":36.73,"time":12.05},{"fsk2bytes":39.98,"lora2bytes":36.28,"time":12.12},{"fsk2bytes":38.49,"lora2bytes":37.55,"time":12.17},{"fsk2bytes":37.04,"lora2bytes":38.26,"time":12.23},{"fsk2bytes":37.19,"lora2bytes":37.44,"time":12.3},{"fsk2bytes":37.8,"lora2bytes":36.88,"time":12.35},{"fsk2bytes":37.51,"lora2bytes":36.05,"time":12.42},{"fsk2bytes":38.26,"lora2bytes":36.45,"time":12.48},{"fsk2bytes":38.47,"lora2bytes":36.69,"time":12.53},{"fsk2bytes":37.92,"lora2bytes":36.14,"time":12.6},{"fsk2bytes":38.48,"lora2bytes":35.57,"time":12.66},{"fsk2bytes":39.01,"lora2bytes":36.53,"time":12.71},{"fsk2bytes":37.56,"lora2bytes":37.13,"time":12.78},{"fsk2bytes":36.9,"lora2bytes":36.02,"time":12.83},{"fsk2bytes":37.68,"lora2bytes":33.77,"time":12.89},{"fsk2bytes":37.93,"lora2bytes":32.74,"time":12.96},{"fsk2bytes":39.4,"lora2bytes":32.21,"time":13.01},{"fsk2bytes":38.89,"lora2bytes":32.22,"time":13.08},{"fsk2bytes":37.38,"lora2bytes":32.68,"time":13.14},{"fsk2bytes":38.61,"lora2bytes":33.26,"time":13.19},{"fsk2bytes":39.43,"lora2bytes":33.95,"time":13.26},{"fsk2bytes":38.5,"lora2bytes":34.33,"time":13.32},{"fsk2bytes":37.8,"lora2bytes":34.6,"time":13.37},{"fsk2bytes":37.98,"lora2bytes":35.25,"time":13.44},{"fsk2bytes":38.05,"lora2bytes":35.54,"time":13.5},{"fsk2bytes":37.03,"lora2bytes":35.81,"time":13.55}]
	


var xAxisKey = 'time';
fskVsLoraData.forEach(function(e, index) {
	e.time = '' + e.time;
});var fskVsLoraCtx = document.getElementById('fskVsLora').getContext('2d');
const fskVsLoraChart = new Chart(fskVsLoraCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'LoRa',
            data: fskVsLoraData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'lora2bytes'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
            label: 'FSK',
            data: fskVsLoraData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'fsk2bytes'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' мс';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Сравнение FSK и LoRa',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' мс';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/fskVsLora.png">
</noscript>
<p>На нём видно, что:</p>
<ul>
<li>LoRa гораздо быстрее обрабатывает сообщение: <strong>13.6</strong>мс против <strong>19</strong>мс</li>
<li>Более энергоэффектиное. За счёт скорости обработки общее потребление <strong>511</strong>мкКл против <strong>775</strong>мкКл</li>
<li>Пиковое потребление чуть ниже</li>
</ul>
<p>На самом деле такое сравнение некорректно. Потребление энергии напрямую зависит от скорости передачи данных. Чем выше скорость, тем быстрее обрабатывается сообщение и меньше тратится энергии.</p>
<h4 id="cad-режим">CAD режим</h4>
<p>В sx127x есть специальный режим, который называется CAD (Channel Activity Detection). Он используется для оптимизации энергопотребления приёмника. Идея заключается в следующем:</p>
<ul>
<li>приёмник включается на полную мощность на определённое время</li>
<li>после чего переходит в режим пониженного энергопотребления и пытается проанализировать полученный сигнал</li>
<li>если обнаружена преамбула пакета, то чип генерирует прерывание и можно переключаться в обычным режим приёма</li>
<li>если преамбула не обнаружена, то чип выжидает некоторое время в режиме низкого энергопотребления и возвращается к шагу 1</li>
</ul>
<p>Диаграмма выглядит следующим образом:</p>
<div>


	<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-0.5 -0.5 460 202"><defs/><g><path d="M 40 40 L 80 40 L 80 0 L 400 0" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 120 L 360 120 L 360 80 L 400 80" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 200 L 80 200 L 80 160 L 200 160 L 200 180 L 360 180 L 360 200 L 400 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 360 180 L 400 180" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="2 6" pointer-events="stroke"/><path d="M 200 160 L 400 160" fill="none" stroke="rgb(0, 0, 0)" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="2 6" pointer-events="stroke"/><rect x="0" y="160" width="80" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 180px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 10px;">Consumption</font></div></div></div></foreignObject><text x="40" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">Consumption</text></switch></g><rect x="0" y="80" width="80" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 100px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 10px;">CadDone</font></div></div></div></foreignObject><text x="40" y="104" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">CadDone</text></switch></g><rect x="0" y="0" width="80" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 20px; margin-left: 1px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 10px;">NSS</font></div></div></div></foreignObject><text x="40" y="24" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">NSS</text></switch></g><path d="M 86.37 80 L 353.63 80" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 81.12 80 L 88.12 76.5 L 86.37 80 L 88.12 83.5 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/><path d="M 358.88 80 L 351.88 83.5 L 353.63 80 L 351.88 76.5 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/><rect x="80" y="60" width="280" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 70px; margin-left: 81px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 10px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">CAD duration</div></div></div></foreignObject><text x="220" y="73" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="10px" text-anchor="middle">CAD duration</text></switch></g><path d="M 86.37 180 L 193.63 180" fill="none" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 81.12 180 L 88.12 176.5 L 86.37 180 L 88.12 183.5 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/><path d="M 198.88 180 L 191.88 183.5 L 193.63 180 L 191.88 176.5 Z" fill="#6c8ebf" stroke="#6c8ebf" stroke-miterlimit="10" pointer-events="all"/><rect x="90" y="166" width="100" height="10" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 171px; margin-left: 91px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 10px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Time in RX mode</div></div></div></foreignObject><text x="140" y="174" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="10px" text-anchor="middle">Time in RX mode</text></switch></g><rect x="400" y="172.5" width="60" height="15" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 180px; margin-left: 401px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 10px;">IDDC_L</font></div></div></div></foreignObject><text x="430" y="184" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">IDDC_L</text></switch></g><rect x="400" y="151" width="60" height="15" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 159px; margin-left: 401px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><font style="font-size: 10px;">IDDR_L</font></div></div></div></foreignObject><text x="430" y="162" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px" text-anchor="middle">IDDR_L</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>

</div>
<p>При этом, согласно спецификации, потребление может уменьшаться чуть ли не в два раза:</p>
<table>
<thead>
  <tr>
    <th>Bandwidth (kHz)</th>
    <th>Full Rx, IDDR_L (mA)</th>
    <th>Processing, IDDC_L (mA)</th>
  </tr>	
</thead>
<tbody>
  <tr>
    <td>7.8 to 41.7</td>
    <td>11</td>
    <td>5.2</td>
  </tr>	
  <tr>
    <td>62.5</td>
    <td>11</td>
    <td>5.6</td>
  </tr>	
  <tr>
    <td>125</td>
    <td>11.5</td>
    <td>6</td>
  </tr>	
  <tr>
    <td>250</td>
    <td>12.4</td>
    <td>6.8</td>
  </tr>	
  <tr>
    <td>500</td>
    <td>13.8</td>
    <td>8.3</td>
  </tr>	
</tbody>
</table>
<p>Запустить приём в CAD режиме можно следующей командой:</p>
<pre tabindex="0"><code>AT+LORACADRX=433200012,125000,9,5,18,10,8,4,0,0,1,0
</code></pre><p>В итоге мне удалось получить:</p>
































<canvas id="cad" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="cad" download="cad.png" href="" title="Сравнение обычного и CAD режимов">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var cadData = [{"cad":39.22,"normal":37.76,"time":0},{"cad":39.34,"normal":37.68,"time":0.14},{"cad":39.33,"normal":37.6,"time":0.29},{"cad":39.17,"normal":37.59,"time":0.44},{"cad":39.23,"normal":37.7,"time":0.59},{"cad":39.12,"normal":37.64,"time":0.75},{"cad":39.2,"normal":37.61,"time":0.89},{"cad":39.1,"normal":37.68,"time":1.04},{"cad":39.12,"normal":37.64,"time":1.19},{"cad":39.15,"normal":37.99,"time":1.34},{"cad":39.15,"normal":38,"time":1.5},{"cad":39.17,"normal":37.91,"time":1.64},{"cad":39.02,"normal":37.71,"time":1.79},{"cad":38.98,"normal":37.8,"time":1.94},{"cad":39.24,"normal":37.86,"time":2.09},{"cad":39.18,"normal":37.96,"time":2.25},{"cad":39.09,"normal":37.8,"time":2.39},{"cad":39.09,"normal":37.84,"time":2.54},{"cad":39.28,"normal":37.9,"time":2.69},{"cad":39.2,"normal":37.86,"time":2.84},{"cad":39.19,"normal":38.15,"time":3},{"cad":39.1,"normal":38.61,"time":3.14},{"cad":39.17,"normal":38.28,"time":3.29},{"cad":39.14,"normal":38.1,"time":3.44},{"cad":39.1,"normal":37.92,"time":3.59},{"cad":39.18,"normal":37.84,"time":3.75},{"cad":38.54,"normal":37.81,"time":3.89},{"cad":36.1,"normal":37.8,"time":4.04},{"cad":35.58,"normal":37.65,"time":4.19},{"cad":34.37,"normal":37.36,"time":4.34},{"cad":33.95,"normal":37.56,"time":4.5},{"cad":33.83,"normal":37.65,"time":4.64},{"cad":33.9,"normal":37.66,"time":4.79},{"cad":33.96,"normal":37.69,"time":4.94},{"cad":33.98,"normal":37.64,"time":5.09},{"cad":34.05,"normal":37.65,"time":5.25},{"cad":33.95,"normal":37.72,"time":5.39},{"cad":33.93,"normal":37.83,"time":5.54},{"cad":33.97,"normal":37.88,"time":5.69},{"cad":33.95,"normal":37.82,"time":5.84},{"cad":33.96,"normal":37.89,"time":6},{"cad":33.86,"normal":37.82,"time":6.14},{"cad":34.02,"normal":37.89,"time":6.29},{"cad":34.05,"normal":38.02,"time":6.44},{"cad":33.75,"normal":37.83,"time":6.59},{"cad":31.92,"normal":37.7,"time":6.75},{"cad":30.52,"normal":37.72,"time":6.89},{"cad":29.98,"normal":37.74,"time":7.04},{"cad":29.82,"normal":37.82,"time":7.19},{"cad":29.91,"normal":37.92,"time":7.34},{"cad":29.79,"normal":37.77,"time":7.5},{"cad":29.91,"normal":37.81,"time":7.64},{"cad":30.11,"normal":37.89,"time":7.79},{"cad":29.99,"normal":38.33,"time":7.94},{"cad":29.91,"normal":38.3,"time":8.09},{"cad":30.04,"normal":37.95,"time":8.25},{"cad":29.8,"normal":37.74,"time":8.39},{"cad":29.92,"normal":37.61,"time":8.54},{"cad":29.9,"normal":37.69,"time":8.69},{"cad":29.87,"normal":37.77,"time":8.84},{"cad":29.98,"normal":37.67,"time":9},{"cad":29.86,"normal":37.66,"time":9.14},{"cad":31.46,"normal":37.48,"time":9.29},{"cad":34.34,"normal":37.74,"time":9.44},{"cad":37.05,"normal":37.75,"time":9.59},{"cad":38.66,"normal":37.83,"time":9.75},{"cad":39.22,"normal":37.93,"time":9.89},{"cad":39.25,"normal":37.9,"time":10.04},{"cad":39.35,"normal":37.94,"time":10.19},{"cad":39.31,"normal":37.83,"time":10.34},{"cad":39.07,"normal":37.83,"time":10.5},{"cad":39.12,"normal":37.88,"time":10.64},{"cad":39.19,"normal":37.94,"time":10.79},{"cad":39.07,"normal":37.81,"time":10.94},{"cad":39.15,"normal":37.86,"time":11.09},{"cad":39.15,"normal":37.78,"time":11.25},{"cad":39.1,"normal":38.09,"time":11.39},{"cad":39.11,"normal":38,"time":11.54},{"cad":39.19,"normal":37.83,"time":11.69},{"cad":38.99,"normal":37.78,"time":11.84},{"cad":38.99,"normal":37.79,"time":12},{"cad":39.11,"normal":37.72,"time":12.14},{"cad":39.16,"normal":37.67,"time":12.29},{"cad":39.07,"normal":37.66,"time":12.44},{"cad":39.06,"normal":37.67,"time":12.59},{"cad":39.37,"normal":37.64,"time":12.75},{"cad":39.3,"normal":37.61,"time":12.89},{"cad":39.17,"normal":38.21,"time":13.04},{"cad":39.13,"normal":38.42,"time":13.19},{"cad":39.13,"normal":37.99,"time":13.34},{"cad":39.25,"normal":37.86,"time":13.5},{"cad":39.19,"normal":37.8,"time":13.64},{"cad":39.1,"normal":37.88,"time":13.79},{"cad":37.75,"normal":38.11,"time":13.94},{"cad":35.85,"normal":37.92,"time":14.09},{"cad":35.14,"normal":37.76,"time":14.25},{"cad":34.19,"normal":37.73,"time":14.39},{"cad":33.99,"normal":37.84,"time":14.54},{"cad":33.9,"normal":37.83,"time":14.69},{"cad":33.79,"normal":37.93,"time":14.84},{"cad":33.94,"normal":37.91,"time":15},{"cad":33.95,"normal":37.84,"time":15.14},{"cad":34.06,"normal":37.88,"time":15.29},{"cad":34.11,"normal":38.04,"time":15.44},{"cad":33.92,"normal":37.86,"time":15.59},{"cad":33.92,"normal":37.95,"time":15.75},{"cad":33.88,"normal":37.88,"time":15.89},{"cad":33.9,"normal":37.84,"time":16.04},{"cad":33.96,"normal":37.8,"time":16.19},{"cad":34.06,"normal":37.79,"time":16.34},{"cad":34,"normal":37.74,"time":16.5},{"cad":33.31,"normal":37.76,"time":16.64},{"cad":31.33,"normal":37.47,"time":16.79},{"cad":30.23,"normal":37.52,"time":16.94},{"cad":29.98,"normal":37.67,"time":17.09},{"cad":29.86,"normal":37.74,"time":17.25},{"cad":29.81,"normal":37.64,"time":17.39},{"cad":29.9,"normal":37.71,"time":17.54},{"cad":29.99,"normal":37.83,"time":17.69},{"cad":30.05,"normal":37.99,"time":17.84},{"cad":29.93,"normal":38.71,"time":18},{"cad":29.97,"normal":38.29,"time":18.14},{"cad":29.94,"normal":38.09,"time":18.29},{"cad":29.99,"normal":37.97,"time":18.44},{"cad":29.86,"normal":37.88,"time":18.59},{"cad":29.96,"normal":37.99,"time":18.75},{"cad":29.97,"normal":38,"time":18.89},{"cad":29.95,"normal":37.85,"time":19.04},{"cad":30.13,"normal":37.95,"time":19.19},{"cad":32.47,"normal":37.66,"time":19.34},{"cad":35.36,"normal":37.83,"time":19.5},{"cad":37.79,"normal":37.83,"time":19.64},{"cad":38.81,"normal":37.81,"time":19.79},{"cad":39.21,"normal":37.93,"time":19.94},{"cad":39.23,"normal":37.83,"time":20.09},{"cad":39.44,"normal":37.88,"time":20.25},{"cad":39.36,"normal":37.67,"time":20.39},{"cad":39.1,"normal":37.73,"time":20.54},{"cad":39.25,"normal":37.64,"time":20.69},{"cad":39.15,"normal":37.58,"time":20.84},{"cad":39.17,"normal":37.64,"time":21},{"cad":39.12,"normal":37.79,"time":21.14},{"cad":39.07,"normal":37.76,"time":21.29},{"cad":39.15,"normal":37.68,"time":21.44},{"cad":39,"normal":37.73,"time":21.59},{"cad":39.1,"normal":37.7,"time":21.75},{"cad":38.97,"normal":37.79,"time":21.89},{"cad":39.1,"normal":37.83,"time":22.04},{"cad":39.15,"normal":37.8,"time":22.19},{"cad":39.15,"normal":37.98,"time":22.34},{"cad":39.13,"normal":37.87,"time":22.5},{"cad":39.15,"normal":37.83,"time":22.64},{"cad":39.24,"normal":37.82,"time":22.79},{"cad":39.18,"normal":37.88,"time":22.94},{"cad":39.12,"normal":38.74,"time":23.09},{"cad":39.12,"normal":38.34,"time":23.25},{"cad":39.08,"normal":38.13,"time":23.39},{"cad":39.22,"normal":37.99,"time":23.54},{"cad":39.1,"normal":37.86,"time":23.69},{"cad":39.02,"normal":38.15,"time":23.84},{"cad":36.87,"normal":37.98,"time":24},{"cad":35.68,"normal":37.84,"time":24.14},{"cad":34.64,"normal":37.72,"time":24.29},{"cad":34.11,"normal":37.69,"time":24.44},{"cad":33.91,"normal":37.65,"time":24.59},{"cad":33.91,"normal":37.68,"time":24.75},{"cad":33.88,"normal":37.73,"time":24.89},{"cad":33.92,"normal":37.61,"time":25.04},{"cad":34.1,"normal":37.7,"time":25.19},{"cad":34,"normal":37.66,"time":25.34},{"cad":34.05,"normal":37.64,"time":25.5},{"cad":33.91,"normal":37.56,"time":25.64},{"cad":33.9,"normal":37.76,"time":25.79},{"cad":34.02,"normal":37.9,"time":25.94},{"cad":33.9,"normal":37.92,"time":26.09},{"cad":33.89,"normal":38.15,"time":26.25},{"cad":33.89,"normal":37.94,"time":26.39},{"cad":34.02,"normal":37.97,"time":26.54},{"cad":32.61,"normal":38.11,"time":26.69},{"cad":30.85,"normal":37.73,"time":26.84},{"cad":30.08,"normal":37.84,"time":27},{"cad":29.94,"normal":37.83,"time":27.14},{"cad":29.93,"normal":37.8,"time":27.29},{"cad":29.85,"normal":37.89,"time":27.44},{"cad":29.88,"normal":37.88,"time":27.59},{"cad":29.98,"normal":37.99,"time":27.75},{"cad":29.96,"normal":38.19,"time":27.89},{"cad":29.94,"normal":38.58,"time":28.04},{"cad":29.93,"normal":38.28,"time":28.19},{"cad":29.93,"normal":38,"time":28.34},{"cad":30.03,"normal":37.84,"time":28.5},{"cad":29.86,"normal":37.76,"time":28.64},{"cad":29.94,"normal":37.81,"time":28.79},{"cad":29.85,"normal":37.79,"time":28.94},{"cad":30,"normal":37.66,"time":29.09},{"cad":30.56,"normal":37.54,"time":29.25},{"cad":33.57,"normal":37.7,"time":29.39},{"cad":36.46,"normal":37.57,"time":29.54},{"cad":38.28,"normal":37.68,"time":29.69},{"cad":39.03,"normal":37.67,"time":29.84},{"cad":39.12,"normal":37.8,"time":30},{"cad":39.33,"normal":37.96,"time":30.14},{"cad":39.33,"normal":37.91,"time":30.29},{"cad":39.26,"normal":37.83,"time":30.44},{"cad":39.22,"normal":37.86,"time":30.59},{"cad":39.03,"normal":37.81,"time":30.75},{"cad":39.12,"normal":37.82,"time":30.89},{"cad":39.21,"normal":37.92,"time":31.04},{"cad":39.01,"normal":37.84,"time":31.19},{"cad":39.16,"normal":38.06,"time":31.34},{"cad":39.16,"normal":37.96,"time":31.5},{"cad":39.11,"normal":37.8,"time":31.64},{"cad":39.11,"normal":37.75,"time":31.79},{"cad":38.98,"normal":37.82,"time":31.94},{"cad":39.11,"normal":37.81,"time":32.09},{"cad":39.16,"normal":37.78,"time":32.25},{"cad":39.13,"normal":37.98,"time":32.39},{"cad":39.05,"normal":37.87,"time":32.54},{"cad":39.23,"normal":37.78,"time":32.69},{"cad":39.25,"normal":37.72,"time":32.84},{"cad":39.19,"normal":37.81,"time":33},{"cad":39.06,"normal":38.42,"time":33.14},{"cad":39.09,"normal":37.99,"time":33.29},{"cad":39.15,"normal":37.8,"time":33.44},{"cad":39.22,"normal":37.66,"time":33.59},{"cad":39.1,"normal":37.75,"time":33.75},{"cad":38.62,"normal":37.83,"time":33.89},{"cad":36.17,"normal":37.79,"time":34.04},{"cad":35.54,"normal":37.84,"time":34.19},{"cad":34.36,"normal":37.8,"time":34.34},{"cad":33.92,"normal":37.84,"time":34.5},{"cad":33.88,"normal":37.83,"time":34.64},{"cad":33.86,"normal":37.95,"time":34.79},{"cad":33.88,"normal":37.92,"time":34.94},{"cad":33.95,"normal":37.86,"time":35.09},{"cad":33.98,"normal":37.87,"time":35.25},{"cad":34.05,"normal":37.93,"time":35.39},{"cad":34.01,"normal":37.88,"time":35.54},{"cad":33.94,"normal":37.84,"time":35.69},{"cad":33.93,"normal":37.93,"time":35.84},{"cad":33.91,"normal":37.99,"time":36},{"cad":33.95,"normal":37.83,"time":36.14},{"cad":34.01,"normal":38.04,"time":36.29},{"cad":33.93,"normal":37.88,"time":36.44},{"cad":33.7,"normal":37.83,"time":36.59},{"cad":31.83,"normal":37.74,"time":36.75},{"cad":30.6,"normal":37.59,"time":36.89},{"cad":30.01,"normal":37.58,"time":37.04},{"cad":29.86,"normal":37.76,"time":37.19},{"cad":29.91,"normal":37.55,"time":37.34},{"cad":29.92,"normal":37.64,"time":37.5},{"cad":29.86,"normal":37.67,"time":37.64},{"cad":30.04,"normal":37.71,"time":37.79},{"cad":30.03,"normal":38.32,"time":37.94},{"cad":29.93,"normal":38.29,"time":38.09},{"cad":29.95,"normal":38.07,"time":38.25},{"cad":29.87,"normal":37.94,"time":38.39},{"cad":29.95,"normal":37.98,"time":38.54},{"cad":29.9,"normal":37.89,"time":38.69},{"cad":30.04,"normal":37.99,"time":38.84},{"cad":29.9,"normal":37.94,"time":39},{"cad":29.87,"normal":37.91,"time":39.14},{"cad":31.55,"normal":37.77,"time":39.29},{"cad":34.39,"normal":37.83,"time":39.44},{"cad":37.13,"normal":37.92,"time":39.59},{"cad":38.61,"normal":37.84,"time":39.75}]
	


var xAxisKey = 'time';
cadData.forEach(function(e, index) {
	e.time = '' + e.time;
});var cadCtx = document.getElementById('cad').getContext('2d');
const cadChart = new Chart(cadCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'Обычный режим',
            data: cadData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'normal'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
            label: 'CAD режим',
            data: cadData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'cad'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' мс';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Сравнение обычного и CAD режимов',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' мс';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/cad.png">
</noscript>
<p>Тут сходу видно несколько интересных вещей:</p>
<ul>
<li>Почему-то потребление тока в режиме поиска преамбулы чуть больше, чем в обычном режиме</li>
<li>Разница между активным режимом и пассивным <strong>~6</strong>мА, что действительно похоже на правду при <strong>125</strong>кГц</li>
<li>После выхода из CAD режима и перед переходом обратно проходит примерно <strong>2</strong>мс. Это время нужно ESP32, чтобы обработать прерывание и опять перейти в CAD режим. Поскольку CAD режим заканчивается тем, что переходит в STANDBY режим, потребление энергии существенно ниже. 2мс на обработку прерывания - это очень много. Если в это время начнётся передача сообщения, то приёмник может пропустить его начало. Контрольная сумма не совпадёт и всё сообщение не будет принято. С другой стороны, на практике всё работает отлично.</li>
</ul>
<p>Если сравнивать энергопотребление, то CAD режим всё-таки более эффективный:</p>
<ul>
<li>Потраченый заряд <strong>1.41</strong>мКл против <strong>1.52</strong>мКл за <strong>40</strong>мс</li>
<li>Средний ток <strong>35.27</strong>мА против <strong>37.85</strong>мА</li>
</ul>
<h4 id="отправка-данных">Отправка данных</h4>
<p>Потребление тока при отправке данных зависит от:</p>
<ul>
<li>скорости передачи</li>
<li>типа модуляции</li>
<li>мощности передатчика</li>
<li>длины сообщения</li>
</ul>
<p>Чтобы упростить тестирование, я отправлял сообщение длиной 255 байт мощностью 4dbm. При этом менял скорость передачи и тип модуляции. Вот пример команды для тестирования FSK:</p>
<pre tabindex="0"><code>AT+FSKTX=000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfe,433200012,1200,5000,4,12AD,0,2,1,4,240,0
</code></pre>































<canvas id="fskBaud" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="fskBaud" download="fskBaud.png" href="" title="Зависимость потребления энергии от скорости передачи (FSK)">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var fskBaudData = [{"baud":1200,"chargemC":88.64,"latencyMs":1759},{"baud":2400,"chargemC":43.71,"latencyMs":880},{"baud":4800,"chargemC":21.71,"latencyMs":439.3},{"baud":9600,"chargemC":10.78,"latencyMs":216},{"baud":19200,"chargemC":5.35,"latencyMs":109},{"baud":38400,"chargemC":2.86,"latencyMs":57.47},{"baud":76800,"chargemC":1.88,"latencyMs":36.13},{"baud":153600,"chargemC":0.76131,"latencyMs":15.36},{"baud":200000,"chargemC":0.68371,"latencyMs":13.77},{"baud":250000,"chargemC":0.54466,"latencyMs":11.07},{"baud":300000,"chargemC":0.45491,"latencyMs":9.2}]
	


var xAxisKey = 'baud';
fskBaudData.forEach(function(e, index) {
	e.baud = '' + e.baud;
});var fskBaudCtx = document.getElementById('fskBaud').getContext('2d');
const fskBaudChart = new Chart(fskBaudCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'Потраченный заряд',
            data: fskBaudData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'chargemC'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,yAxisID: 'myScale',tension: 0.2
        },{
            label: 'Время',
            data: fskBaudData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'latencyMs'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Бод'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',type: 'logarithmic',title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мс';
                    }}
            },
        	myScale: {
                display: true,
                axis: 'y',
                position: 'right',type: 'logarithmic',title: {
                    display: true,
                    text: 'Заряд'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мКл';
                    }},
                grid: {
                	drawOnChartArea: false
                }
            }},
        plugins: {
            title: {
                display: true,
                text: 'Зависимость потребления энергии от скорости передачи (FSK)',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мс";if( context.datasetIndex == 0 ) {
                        	unit = "мКл";
                        }if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/fskBaud.png">
</noscript>
<p>На графике видна однозначная зависимость. Чем больше скорость передачи, тем меньше тратится энергии. Кстати, график к районе 76800 бод не всегда был такой. Когда я впервые замерил скорость, оказалось, что она в два раза меньше, чем при 38400 бод. И её увеличение вообще никак не влияло на потребление. Немного повозившись, я нашёл багу в коде. При чтении из UART происходило переполнение uint16_t и устанавливалась гораздо меньшая скорость. Упс!</p>
<p>С отправкой данных в режиме LoRa всё гораздо сложнее. На скорость могут влиять: bandwidth, spreading factor и coding rate. Например, последний контролирует сколько бит используется для кодов коррекции ошибок. Чем больше, тем надёжнее передача, но при этом дольше передаются данные.</p>
<p>Я зафиксировал <code>coding rate=4</code> и менял лишь bandwidth и spreading factor:</p>
<pre tabindex="0"><code>AT+LORATX=000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfe,433200012,500000,6,5,18,8,0,1,0,255,4,240,0
</code></pre>































<canvas id="loraBandwidthSf" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="loraBandwidthSf" download="loraBandwidthSf.png" href="" title="Зависимость потребления энергии от скорости передачи (LoRa)">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var loraBandwidthSfData = [{"bandwidth":7800,"sf10":1920.77,"sf11":3440.79,"sf12":6210.81,"sf6":156.48,"sf7":272.98,"sf8":630.48,"sf9":1098.42},{"bandwidth":10400,"sf10":1438.85,"sf11":2578.15,"sf12":4647.99,"sf6":117.52,"sf7":205.24,"sf8":475.24,"sf9":824.43},{"bandwidth":15600,"sf10":958.07,"sf11":1716.87,"sf12":3095.53,"sf6":78.35,"sf7":136.9,"sf8":316.69,"sf9":549.16},{"bandwidth":20800,"sf10":719.38,"sf11":1288.53,"sf12":2325.09,"sf6":58.84,"sf7":102.78,"sf8":237.75,"sf9":411.99},{"bandwidth":31250,"sf10":479.6,"sf11":859.32,"sf12":1548.64,"sf6":39.24,"sf7":68.54,"sf8":158.57,"sf9":274.56},{"bandwidth":41700,"sf10":360.14,"sf11":645.03,"sf12":1162.86,"sf6":29.45,"sf7":51.43,"sf8":119.05,"sf9":206.17},{"bandwidth":62500,"sf10":240.14,"sf11":430.5,"sf12":775.39,"sf6":19.63,"sf7":34.29,"sf8":79.39,"sf9":137.51},{"bandwidth":125000,"sf10":120.51,"sf11":216.01,"sf12":389.33,"sf6":9.86,"sf7":17.2,"sf8":39.84,"sf9":69.01},{"bandwidth":250000,"sf10":60.67,"sf11":108.79,"sf12":196.21,"sf6":4.96,"sf7":8.66,"sf8":20.05,"sf9":34.72},{"bandwidth":500000,"sf10":30.74,"sf11":55.18,"sf12":99.44,"sf6":2.52,"sf7":4.39,"sf8":10.16,"sf9":17.6}]
	


var xAxisKey = 'bandwidth';
loraBandwidthSfData.forEach(function(e, index) {
	e.bandwidth = '' + e.bandwidth;
});var loraBandwidthSfCtx = document.getElementById('loraBandwidthSf').getContext('2d');
const loraBandwidthSfChart = new Chart(loraBandwidthSfCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'sf6',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf6'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
        	label: 'sf7',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf7'
            },
            borderColor: '#4161CC',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#4161CC',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
        	label: 'sf8',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf8'
            },
            borderColor: '#5DD9BE',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#5DD9BE',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
        	label: 'sf9',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf9'
            },
            borderColor: '#CF8659',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#CF8659',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
        	label: 'sf10',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf10'
            },
            borderColor: '#800080',
            backgroundColor: 'rgba(229,204,229, 0.1)',
            pointBackgroundColor: '#800080',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
        	label: 'sf11',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf11'
            },
            borderColor: '#FFC0CB',
            backgroundColor: 'rgba(255,229,234, 0.1)',
            pointBackgroundColor: '#FFC0CB',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
            label: 'sf12',
            data: loraBandwidthSfData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'sf12'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Bandwidth'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' Гц';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Заряд'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мКл';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Зависимость потребления энергии от скорости передачи (LoRa)',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' Гц';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мКл";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/loraBandwidthSf.png">
</noscript>
<p>Небольшой анализ результатов:</p>
<ul>
<li>Чем больше spreading factor, тем дольше передаётся сообщение и тем больше тратится энергии</li>
<li>Самая быстрая передача данных в LoRa (коэффициент 6 и ширина канала 500Кгц) тратит энергии больше, чем самая быстрая передача FSK (скорость 300Кбод)</li>
</ul>
<p>В следующем тесте я сделал наоборот: зафиксировал скорость передачи данных и менял выходную мощность от -4 до 20.</p>
<pre tabindex="0"><code>AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,-4,240,0
AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,-3,240,0
...
AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,17,240,1
AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,20,240,1
</code></pre>































<canvas id="loraPower" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="loraPower" download="loraPower.png" href="" title="Зависимость потребления энергии от уровня мощности">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var loraPowerData = [{"avgCurrent":38.42,"charge":3.69,"level":-4},{"avgCurrent":38.74,"charge":3.72,"level":-3},{"avgCurrent":39.09,"charge":3.75,"level":-2},{"avgCurrent":39.52,"charge":3.8,"level":-1},{"avgCurrent":40.69,"charge":3.91,"level":0},{"avgCurrent":42.2,"charge":4.05,"level":1},{"avgCurrent":42.19,"charge":4.05,"level":2},{"avgCurrent":42.97,"charge":4.13,"level":3},{"avgCurrent":43.87,"charge":4.21,"level":4},{"avgCurrent":44.9,"charge":4.31,"level":5},{"avgCurrent":46.17,"charge":4.43,"level":6},{"avgCurrent":47.59,"charge":4.57,"level":7},{"avgCurrent":49.16,"charge":4.72,"level":8},{"avgCurrent":51.08,"charge":4.9,"level":9},{"avgCurrent":52.7,"charge":5.06,"level":10},{"avgCurrent":54.73,"charge":5.25,"level":11},{"avgCurrent":57.92,"charge":5.56,"level":12},{"avgCurrent":62.22,"charge":5.98,"level":13},{"avgCurrent":68.42,"charge":6.57,"level":14},{"avgCurrent":69.73,"charge":6.69,"level":15},{"avgCurrent":74.52,"charge":7.16,"level":16},{"avgCurrent":81.22,"charge":7.8,"level":17},{"avgCurrent":124.76,"charge":11.98,"level":20}]
	


var xAxisKey = 'level';
loraPowerData.forEach(function(e, index) {
	e.level = '' + e.level;
});var loraPowerCtx = document.getElementById('loraPower').getContext('2d');
const loraPowerChart = new Chart(loraPowerCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'Потраченный заряд',
            data: loraPowerData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'charge'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,yAxisID: 'myScale',tension: 0.2
        },{
            label: 'Средний ток',
            data: loraPowerData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'avgCurrent'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Уровень'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Средний ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мА';
                    }}
            },
        	myScale: {
                display: true,
                axis: 'y',
                position: 'right',title: {
                    display: true,
                    text: 'Заряд'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мКл';
                    }},
                grid: {
                	drawOnChartArea: false
                }
            }},
        plugins: {
            title: {
                display: true,
                text: 'Зависимость потребления энергии от уровня мощности',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мА";if( context.datasetIndex == 0 ) {
                        	unit = "мКл";
                        }if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/loraPower.png">
</noscript>
<p>Интересно, почему при более высоком уровне мощности графики начинают пересекаться? Я передавал абсолютно одинаковое сообщение с одинаковыми параметрами. Время на передачу было одного и то же. Значит потраченный заряд должен линейно зависить от тока. Но вместо этого зависимость нелинейная.</p>
<p>Кстати, при 7dbm потребление тока достаточно ровное. А вот при 10dbm уже нет. Шумит внутренний усилитель мощности?</p>
































<canvas id="txNoise" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="txNoise" download="txNoise.png" href="" title="7dbm и 10dbm">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var txNoiseData = [{"10dbm":53.87,"7dbm":47.59,"time":0},{"10dbm":52.38,"7dbm":47.8,"time":0.02},{"10dbm":52.38,"7dbm":47.53,"time":0.05},{"10dbm":53.12,"7dbm":47.64,"time":0.08},{"10dbm":52.01,"7dbm":47.56,"time":0.11},{"10dbm":52.75,"7dbm":47.8,"time":0.14},{"10dbm":53.87,"7dbm":47.59,"time":0.17},{"10dbm":52.38,"7dbm":47.86,"time":0.2},{"10dbm":53.5,"7dbm":47.78,"time":0.23},{"10dbm":51.63,"7dbm":47.75,"time":0.26},{"10dbm":52.01,"7dbm":47.97,"time":0.29},{"10dbm":53.87,"7dbm":47.61,"time":0.32},{"10dbm":52.75,"7dbm":47.61,"time":0.35},{"10dbm":53.12,"7dbm":47.7,"time":0.38},{"10dbm":52.75,"7dbm":47.5,"time":0.41},{"10dbm":53.12,"7dbm":47.78,"time":0.44},{"10dbm":52.38,"7dbm":47.91,"time":0.47},{"10dbm":52.38,"7dbm":47.89,"time":0.5},{"10dbm":52.38,"7dbm":47.56,"time":0.53},{"10dbm":50.89,"7dbm":47.59,"time":0.56},{"10dbm":53.12,"7dbm":47.48,"time":0.59},{"10dbm":53.87,"7dbm":47.64,"time":0.62},{"10dbm":52.75,"7dbm":47.67,"time":0.65},{"10dbm":52.38,"7dbm":47.72,"time":0.68},{"10dbm":53.12,"7dbm":47.45,"time":0.71},{"10dbm":52.75,"7dbm":47.75,"time":0.75},{"10dbm":52.75,"7dbm":47.67,"time":0.77},{"10dbm":52.38,"7dbm":47.48,"time":0.8},{"10dbm":52.75,"7dbm":47.37,"time":0.83},{"10dbm":52.38,"7dbm":47.7,"time":0.86},{"10dbm":51.63,"7dbm":47.78,"time":0.89},{"10dbm":52.38,"7dbm":47.56,"time":0.92},{"10dbm":51.26,"7dbm":47.59,"time":0.95},{"10dbm":52.38,"7dbm":47.91,"time":0.98},{"10dbm":51.63,"7dbm":47.64,"time":1.01},{"10dbm":51.26,"7dbm":47.59,"time":1.04},{"10dbm":55.73,"7dbm":47.61,"time":1.07},{"10dbm":53.87,"7dbm":47.5,"time":1.1},{"10dbm":52.75,"7dbm":47.64,"time":1.13},{"10dbm":53.87,"7dbm":47.61,"time":1.16},{"10dbm":53.12,"7dbm":47.56,"time":1.19},{"10dbm":54.99,"7dbm":47.72,"time":1.22},{"10dbm":53.12,"7dbm":47.75,"time":1.25},{"10dbm":52.01,"7dbm":47.7,"time":1.28},{"10dbm":52.01,"7dbm":47.56,"time":1.31},{"10dbm":53.87,"7dbm":47.91,"time":1.34},{"10dbm":53.12,"7dbm":47.83,"time":1.37},{"10dbm":52.01,"7dbm":47.78,"time":1.4},{"10dbm":53.12,"7dbm":47.7,"time":1.43},{"10dbm":52.38,"7dbm":47.67,"time":1.46},{"10dbm":52.75,"7dbm":47.72,"time":1.5},{"10dbm":52.38,"7dbm":47.64,"time":1.52},{"10dbm":53.12,"7dbm":47.29,"time":1.55},{"10dbm":51.63,"7dbm":46.93,"time":1.58},{"10dbm":52.75,"7dbm":47.45,"time":1.61},{"10dbm":51.63,"7dbm":47.37,"time":1.64},{"10dbm":52.01,"7dbm":47.45,"time":1.67},{"10dbm":53.12,"7dbm":47.31,"time":1.7},{"10dbm":51.63,"7dbm":47.61,"time":1.73},{"10dbm":52.75,"7dbm":47.37,"time":1.76},{"10dbm":53.12,"7dbm":47.59,"time":1.79},{"10dbm":50.89,"7dbm":47.59,"time":1.82},{"10dbm":52.38,"7dbm":47.64,"time":1.85},{"10dbm":53.87,"7dbm":47.78,"time":1.88},{"10dbm":53.87,"7dbm":47.45,"time":1.91},{"10dbm":54.62,"7dbm":47.59,"time":1.94},{"10dbm":53.12,"7dbm":47.64,"time":1.97},{"10dbm":52.75,"7dbm":47.78,"time":2},{"10dbm":52.01,"7dbm":47.59,"time":2.03},{"10dbm":53.12,"7dbm":47.5,"time":2.06},{"10dbm":52.01,"7dbm":47.31,"time":2.09},{"10dbm":50.89,"7dbm":47.78,"time":2.12},{"10dbm":52.75,"7dbm":47.18,"time":2.15},{"10dbm":51.63,"7dbm":47.7,"time":2.18},{"10dbm":53.12,"7dbm":47.48,"time":2.21},{"10dbm":53.87,"7dbm":47.72,"time":2.25},{"10dbm":52.75,"7dbm":47.91,"time":2.27},{"10dbm":52.01,"7dbm":47.86,"time":2.3},{"10dbm":52.75,"7dbm":47.48,"time":2.33},{"10dbm":53.12,"7dbm":47.8,"time":2.36},{"10dbm":52.75,"7dbm":47.78,"time":2.39},{"10dbm":52.38,"7dbm":48.05,"time":2.42},{"10dbm":53.5,"7dbm":47.61,"time":2.45},{"10dbm":52.75,"7dbm":47.7,"time":2.48},{"10dbm":53.12,"7dbm":47.8,"time":2.51},{"10dbm":53.12,"7dbm":47.8,"time":2.54},{"10dbm":52.01,"7dbm":47.64,"time":2.57},{"10dbm":52.01,"7dbm":47.7,"time":2.6},{"10dbm":52.38,"7dbm":47.83,"time":2.63},{"10dbm":52.38,"7dbm":47.59,"time":2.66},{"10dbm":53.87,"7dbm":47.61,"time":2.69},{"10dbm":52.01,"7dbm":47.59,"time":2.72},{"10dbm":53.12,"7dbm":47.83,"time":2.75},{"10dbm":52.38,"7dbm":47.53,"time":2.78},{"10dbm":51.63,"7dbm":47.61,"time":2.81},{"10dbm":52.38,"7dbm":47.61,"time":2.84},{"10dbm":53.5,"7dbm":47.34,"time":2.87},{"10dbm":50.52,"7dbm":47.61,"time":2.9},{"10dbm":53.12,"7dbm":47.59,"time":2.93},{"10dbm":52.38,"7dbm":47.67,"time":2.96},{"10dbm":52.38,"7dbm":47.7,"time":3},{"10dbm":53.12,"7dbm":47.53,"time":3.02},{"10dbm":52.01,"7dbm":47.75,"time":3.05},{"10dbm":51.63,"7dbm":47.8,"time":3.08},{"10dbm":53.12,"7dbm":47.83,"time":3.11},{"10dbm":53.12,"7dbm":47.7,"time":3.14},{"10dbm":51.63,"7dbm":47.67,"time":3.17},{"10dbm":52.75,"7dbm":47.7,"time":3.2},{"10dbm":53.12,"7dbm":47.56,"time":3.23},{"10dbm":52.01,"7dbm":47.5,"time":3.26},{"10dbm":53.12,"7dbm":47.56,"time":3.29},{"10dbm":53.12,"7dbm":47.5,"time":3.32},{"10dbm":52.01,"7dbm":47.64,"time":3.35},{"10dbm":52.75,"7dbm":47.61,"time":3.38},{"10dbm":53.5,"7dbm":48.57,"time":3.41},{"10dbm":52.38,"7dbm":48.84,"time":3.44},{"10dbm":52.01,"7dbm":48.68,"time":3.47},{"10dbm":51.63,"7dbm":48.62,"time":3.5},{"10dbm":53.87,"7dbm":48.43,"time":3.53},{"10dbm":52.75,"7dbm":48.08,"time":3.56},{"10dbm":52.75,"7dbm":48.29,"time":3.59},{"10dbm":53.12,"7dbm":48.1,"time":3.62},{"10dbm":51.63,"7dbm":47.78,"time":3.65},{"10dbm":52.75,"7dbm":48.08,"time":3.68},{"10dbm":53.5,"7dbm":48.08,"time":3.71},{"10dbm":50.89,"7dbm":47.8,"time":3.75},{"10dbm":52.75,"7dbm":47.72,"time":3.77},{"10dbm":53.5,"7dbm":47.61,"time":3.8},{"10dbm":53.12,"7dbm":47.64,"time":3.83},{"10dbm":52.38,"7dbm":47.75,"time":3.86},{"10dbm":54.24,"7dbm":47.83,"time":3.89},{"10dbm":51.26,"7dbm":47.8,"time":3.92},{"10dbm":53.12,"7dbm":47.72,"time":3.95},{"10dbm":51.26,"7dbm":47.75,"time":3.98},{"10dbm":52.01,"7dbm":47.59,"time":4.01},{"10dbm":53.87,"7dbm":47.64,"time":4.04},{"10dbm":53.12,"7dbm":47.5,"time":4.07},{"10dbm":53.12,"7dbm":47.23,"time":4.1},{"10dbm":53.12,"7dbm":47.53,"time":4.13},{"10dbm":51.63,"7dbm":47.59,"time":4.16},{"10dbm":52.38,"7dbm":47.29,"time":4.19},{"10dbm":53.12,"7dbm":47.37,"time":4.22},{"10dbm":51.26,"7dbm":47.53,"time":4.25},{"10dbm":53.5,"7dbm":47.72,"time":4.28},{"10dbm":52.38,"7dbm":47.56,"time":4.31},{"10dbm":52.75,"7dbm":47.78,"time":4.34},{"10dbm":52.38,"7dbm":47.7,"time":4.37},{"10dbm":53.87,"7dbm":47.42,"time":4.4},{"10dbm":52.38,"7dbm":47.5,"time":4.43},{"10dbm":51.63,"7dbm":47.5,"time":4.46},{"10dbm":51.26,"7dbm":47.56,"time":4.5},{"10dbm":52.01,"7dbm":47.7,"time":4.52},{"10dbm":52.75,"7dbm":47.53,"time":4.55},{"10dbm":52.75,"7dbm":47.72,"time":4.58},{"10dbm":52.75,"7dbm":47.53,"time":4.61},{"10dbm":53.12,"7dbm":47.75,"time":4.64},{"10dbm":51.26,"7dbm":47.67,"time":4.67},{"10dbm":53.12,"7dbm":47.7,"time":4.7},{"10dbm":52.38,"7dbm":47.78,"time":4.73},{"10dbm":54.62,"7dbm":47.7,"time":4.76},{"10dbm":53.87,"7dbm":48.13,"time":4.79},{"10dbm":53.12,"7dbm":48.02,"time":4.82},{"10dbm":52.75,"7dbm":47.75,"time":4.85},{"10dbm":51.63,"7dbm":47.8,"time":4.88},{"10dbm":52.75,"7dbm":47.83,"time":4.91},{"10dbm":52.01,"7dbm":47.75,"time":4.94},{"10dbm":53.5,"7dbm":47.64,"time":4.97},{"10dbm":52.01,"7dbm":47.59,"time":5}]
	


var xAxisKey = 'time';
txNoiseData.forEach(function(e, index) {
	e.time = '' + e.time;
});var txNoiseCtx = document.getElementById('txNoise').getContext('2d');
const txNoiseChart = new Chart(txNoiseCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: '10dbm',
            data: txNoiseData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: '10dbm'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
            label: '7dbm',
            data: txNoiseData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: '7dbm'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: '7dbm и 10dbm',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/txNoise.png">
</noscript>
<p>Помимо разных уровней мощности, в чипе есть три разных физических пина, к которым может подключаться антенна: RFO_LF, RFO_HF и PA_BOOST. +20dbm может передаваться только по PA_BOOST. Но если передавать +7dbm, то есть ли разница какой пин использовать?</p>
<pre tabindex="0"><code>AT+LORATX=CA,168000012,125000,9,5,18,8,0,1,1,0,7,240,0
AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,7,240,0
AT+LORATX=CA,433200012,125000,9,5,18,8,0,1,1,0,7,240,1
</code></pre>































<canvas id="txpin" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="txpin" download="txpin.png" href="" title="Зависимость уровня потребления тока от пина">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var txpinData = [{"boost7dbm":39.89,"hf7dbm":38.01,"lf7dbm":41.51,"time":0},{"boost7dbm":59.06,"hf7dbm":54.94,"lf7dbm":67.3,"time":0.36},{"boost7dbm":56.15,"hf7dbm":52.56,"lf7dbm":60.12,"time":0.71},{"boost7dbm":53.55,"hf7dbm":49.87,"lf7dbm":58.2,"time":1.08},{"boost7dbm":51.07,"hf7dbm":48.1,"lf7dbm":57.02,"time":1.43},{"boost7dbm":51.84,"hf7dbm":48.51,"lf7dbm":57.81,"time":1.8},{"boost7dbm":50.96,"hf7dbm":47.32,"lf7dbm":57.15,"time":2.16},{"boost7dbm":51.93,"hf7dbm":48.4,"lf7dbm":58.41,"time":2.52},{"boost7dbm":51.61,"hf7dbm":48.16,"lf7dbm":57.09,"time":2.88},{"boost7dbm":50.79,"hf7dbm":47.3,"lf7dbm":57.05,"time":3.23},{"boost7dbm":51.44,"hf7dbm":48.3,"lf7dbm":58.24,"time":3.6},{"boost7dbm":53.32,"hf7dbm":49.92,"lf7dbm":58.77,"time":3.95},{"boost7dbm":51.07,"hf7dbm":47.58,"lf7dbm":56.85,"time":4.32},{"boost7dbm":51.67,"hf7dbm":48.22,"lf7dbm":57.96,"time":4.67},{"boost7dbm":52.34,"hf7dbm":48.35,"lf7dbm":58.52,"time":5.04},{"boost7dbm":52.68,"hf7dbm":49.12,"lf7dbm":57.73,"time":5.4},{"boost7dbm":50.89,"hf7dbm":47.49,"lf7dbm":56.79,"time":5.76},{"boost7dbm":49.4,"hf7dbm":46.07,"lf7dbm":55.11,"time":6.12},{"boost7dbm":48.45,"hf7dbm":44.68,"lf7dbm":55.02,"time":6.47},{"boost7dbm":50.92,"hf7dbm":47.3,"lf7dbm":56.32,"time":6.84},{"boost7dbm":51.36,"hf7dbm":47.71,"lf7dbm":56.6,"time":7.19},{"boost7dbm":51.25,"hf7dbm":47.62,"lf7dbm":56.32,"time":7.56},{"boost7dbm":51.41,"hf7dbm":47.59,"lf7dbm":57.26,"time":7.91},{"boost7dbm":51.4,"hf7dbm":47.86,"lf7dbm":56.75,"time":8.28},{"boost7dbm":51.32,"hf7dbm":47.94,"lf7dbm":56.32,"time":8.64},{"boost7dbm":51.35,"hf7dbm":47.64,"lf7dbm":56.45,"time":9},{"boost7dbm":51.37,"hf7dbm":47.67,"lf7dbm":56.62,"time":9.36},{"boost7dbm":51.74,"hf7dbm":47.72,"lf7dbm":56.62,"time":9.71},{"boost7dbm":51.52,"hf7dbm":47.65,"lf7dbm":56.75,"time":10.08},{"boost7dbm":51.4,"hf7dbm":47.64,"lf7dbm":56.47,"time":10.43},{"boost7dbm":51.24,"hf7dbm":47.61,"lf7dbm":56.3,"time":10.8},{"boost7dbm":51.32,"hf7dbm":47.44,"lf7dbm":57.13,"time":11.16},{"boost7dbm":51.31,"hf7dbm":47.72,"lf7dbm":56.51,"time":11.52},{"boost7dbm":51.34,"hf7dbm":47.71,"lf7dbm":56.79,"time":11.88},{"boost7dbm":51.31,"hf7dbm":47.7,"lf7dbm":56.83,"time":12.23},{"boost7dbm":51.32,"hf7dbm":47.6,"lf7dbm":56.64,"time":12.6},{"boost7dbm":51.44,"hf7dbm":47.62,"lf7dbm":57.09,"time":12.95},{"boost7dbm":51.27,"hf7dbm":47.66,"lf7dbm":56.64,"time":13.32},{"boost7dbm":51.36,"hf7dbm":48.12,"lf7dbm":56.6,"time":13.67},{"boost7dbm":51.33,"hf7dbm":47.7,"lf7dbm":56.64,"time":14.04},{"boost7dbm":51.3,"hf7dbm":47.63,"lf7dbm":56.81,"time":14.4},{"boost7dbm":51.48,"hf7dbm":47.64,"lf7dbm":56.77,"time":14.76},{"boost7dbm":51.76,"hf7dbm":47.59,"lf7dbm":56.79,"time":15.12},{"boost7dbm":51.42,"hf7dbm":47.62,"lf7dbm":56.68,"time":15.47},{"boost7dbm":51.34,"hf7dbm":47.6,"lf7dbm":56.94,"time":15.84},{"boost7dbm":51.3,"hf7dbm":47.51,"lf7dbm":56.96,"time":16.19},{"boost7dbm":51.34,"hf7dbm":47.7,"lf7dbm":56.66,"time":16.56},{"boost7dbm":51.32,"hf7dbm":47.77,"lf7dbm":57.07,"time":16.91},{"boost7dbm":51.29,"hf7dbm":47.68,"lf7dbm":56.79,"time":17.28},{"boost7dbm":51.3,"hf7dbm":47.66,"lf7dbm":57.22,"time":17.64},{"boost7dbm":51.42,"hf7dbm":47.62,"lf7dbm":58.28,"time":18},{"boost7dbm":51.28,"hf7dbm":48.06,"lf7dbm":56.7,"time":18.36},{"boost7dbm":51.31,"hf7dbm":47.74,"lf7dbm":56.68,"time":18.71},{"boost7dbm":51.32,"hf7dbm":47.54,"lf7dbm":56.51,"time":19.08},{"boost7dbm":51.29,"hf7dbm":47.73,"lf7dbm":56.92,"time":19.43},{"boost7dbm":51.87,"hf7dbm":47.67,"lf7dbm":56.92,"time":19.8},{"boost7dbm":51.44,"hf7dbm":47.62,"lf7dbm":57.34,"time":20.16},{"boost7dbm":51.48,"hf7dbm":47.58,"lf7dbm":56.6,"time":20.52},{"boost7dbm":51.31,"hf7dbm":47.65,"lf7dbm":56.43,"time":20.88},{"boost7dbm":51.26,"hf7dbm":47.57,"lf7dbm":56.87,"time":21.23},{"boost7dbm":51.35,"hf7dbm":47.68,"lf7dbm":56.77,"time":21.6},{"boost7dbm":51.23,"hf7dbm":47.8,"lf7dbm":56.49,"time":21.95},{"boost7dbm":51.25,"hf7dbm":47.59,"lf7dbm":56.81,"time":22.32},{"boost7dbm":51.35,"hf7dbm":47.54,"lf7dbm":57.05,"time":22.67},{"boost7dbm":51.34,"hf7dbm":47.59,"lf7dbm":57.66,"time":23.04},{"boost7dbm":51.35,"hf7dbm":47.85,"lf7dbm":56.73,"time":23.4},{"boost7dbm":51.31,"hf7dbm":47.99,"lf7dbm":57.02,"time":23.76},{"boost7dbm":51.35,"hf7dbm":47.58,"lf7dbm":56.79,"time":24.12},{"boost7dbm":51.32,"hf7dbm":47.78,"lf7dbm":56.77,"time":24.47},{"boost7dbm":51.66,"hf7dbm":47.68,"lf7dbm":57.02,"time":24.84},{"boost7dbm":51.71,"hf7dbm":47.64,"lf7dbm":56.85,"time":25.19},{"boost7dbm":51.35,"hf7dbm":47.66,"lf7dbm":56.85,"time":25.56},{"boost7dbm":51.36,"hf7dbm":47.59,"lf7dbm":56.6,"time":25.91},{"boost7dbm":51.23,"hf7dbm":47.55,"lf7dbm":56.53,"time":26.28},{"boost7dbm":51.35,"hf7dbm":47.57,"lf7dbm":56.87,"time":26.64},{"boost7dbm":51.32,"hf7dbm":47.73,"lf7dbm":57.05,"time":27},{"boost7dbm":51.21,"hf7dbm":47.62,"lf7dbm":56.68,"time":27.36},{"boost7dbm":51.42,"hf7dbm":47.66,"lf7dbm":57.19,"time":27.71},{"boost7dbm":51.4,"hf7dbm":47.66,"lf7dbm":57.32,"time":28.08},{"boost7dbm":51.32,"hf7dbm":48.09,"lf7dbm":57.26,"time":28.43},{"boost7dbm":51.29,"hf7dbm":47.72,"lf7dbm":56.94,"time":28.8},{"boost7dbm":51.38,"hf7dbm":47.68,"lf7dbm":56.81,"time":29.16},{"boost7dbm":51.32,"hf7dbm":47.66,"lf7dbm":57.47,"time":29.52},{"boost7dbm":51.88,"hf7dbm":47.73,"lf7dbm":56.75,"time":29.88},{"boost7dbm":51.52,"hf7dbm":47.56,"lf7dbm":56.96,"time":30.23},{"boost7dbm":51.33,"hf7dbm":47.6,"lf7dbm":56.62,"time":30.6},{"boost7dbm":51.28,"hf7dbm":47.54,"lf7dbm":56.81,"time":30.95},{"boost7dbm":51.33,"hf7dbm":47.61,"lf7dbm":57.05,"time":31.32},{"boost7dbm":51.32,"hf7dbm":47.61,"lf7dbm":56.68,"time":31.67},{"boost7dbm":51.3,"hf7dbm":47.75,"lf7dbm":57.19,"time":32.04},{"boost7dbm":51.28,"hf7dbm":47.62,"lf7dbm":56.53,"time":32.4},{"boost7dbm":51.48,"hf7dbm":47.64,"lf7dbm":57.22,"time":32.76},{"boost7dbm":51.35,"hf7dbm":47.64,"lf7dbm":57.47,"time":33.12},{"boost7dbm":51.29,"hf7dbm":48,"lf7dbm":57.26,"time":33.47},{"boost7dbm":51.41,"hf7dbm":47.9,"lf7dbm":56.58,"time":33.84},{"boost7dbm":51.34,"hf7dbm":47.64,"lf7dbm":56.26,"time":34.19},{"boost7dbm":51.29,"hf7dbm":47.69,"lf7dbm":56.87,"time":34.56},{"boost7dbm":51.81,"hf7dbm":47.63,"lf7dbm":56.9,"time":34.91},{"boost7dbm":51.58,"hf7dbm":47.6,"lf7dbm":56.81,"time":35.28},{"boost7dbm":51.33,"hf7dbm":47.67,"lf7dbm":56.6,"time":35.64},{"boost7dbm":51.32,"hf7dbm":47.53,"lf7dbm":56.68,"time":36},{"boost7dbm":51.35,"hf7dbm":47.57,"lf7dbm":56.49,"time":36.36},{"boost7dbm":51.39,"hf7dbm":47.64,"lf7dbm":56.51,"time":36.71},{"boost7dbm":51.38,"hf7dbm":47.77,"lf7dbm":56.98,"time":37.08},{"boost7dbm":51.16,"hf7dbm":47.73,"lf7dbm":56.62,"time":37.43},{"boost7dbm":51.55,"hf7dbm":47.65,"lf7dbm":56.96,"time":37.8},{"boost7dbm":51.37,"hf7dbm":47.63,"lf7dbm":56.96,"time":38.16},{"boost7dbm":51.28,"hf7dbm":48.1,"lf7dbm":56.56,"time":38.52},{"boost7dbm":51.35,"hf7dbm":47.65,"lf7dbm":56.58,"time":38.88},{"boost7dbm":51.32,"hf7dbm":47.56,"lf7dbm":56.49,"time":39.23},{"boost7dbm":51.48,"hf7dbm":47.7,"lf7dbm":56.9,"time":39.6},{"boost7dbm":51.77,"hf7dbm":47.68,"lf7dbm":56.68,"time":39.95},{"boost7dbm":51.42,"hf7dbm":47.63,"lf7dbm":56.79,"time":40.32},{"boost7dbm":51.36,"hf7dbm":47.6,"lf7dbm":56.73,"time":40.67},{"boost7dbm":51.34,"hf7dbm":47.54,"lf7dbm":56.73,"time":41.04},{"boost7dbm":51.4,"hf7dbm":47.56,"lf7dbm":57.02,"time":41.4},{"boost7dbm":51.32,"hf7dbm":47.68,"lf7dbm":56.77,"time":41.76},{"boost7dbm":51.43,"hf7dbm":47.75,"lf7dbm":56.7,"time":42.12},{"boost7dbm":51.24,"hf7dbm":47.65,"lf7dbm":56.7,"time":42.47},{"boost7dbm":51.42,"hf7dbm":47.63,"lf7dbm":57.05,"time":42.84},{"boost7dbm":51.29,"hf7dbm":47.63,"lf7dbm":57.47,"time":43.19},{"boost7dbm":51.28,"hf7dbm":48.12,"lf7dbm":55.92,"time":43.56},{"boost7dbm":51.31,"hf7dbm":47.74,"lf7dbm":56.68,"time":43.91},{"boost7dbm":51.32,"hf7dbm":47.6,"lf7dbm":56.56,"time":44.28},{"boost7dbm":51.43,"hf7dbm":47.74,"lf7dbm":57.02,"time":44.64},{"boost7dbm":51.89,"hf7dbm":47.68,"lf7dbm":56.51,"time":45},{"boost7dbm":51.52,"hf7dbm":47.61,"lf7dbm":56.92,"time":45.36},{"boost7dbm":51.34,"hf7dbm":47.67,"lf7dbm":56.24,"time":45.71},{"boost7dbm":51.33,"hf7dbm":47.49,"lf7dbm":56.15,"time":46.08},{"boost7dbm":51.38,"hf7dbm":47.62,"lf7dbm":56.79,"time":46.43},{"boost7dbm":51.33,"hf7dbm":47.62,"lf7dbm":56.79,"time":46.8},{"boost7dbm":51.36,"hf7dbm":47.71,"lf7dbm":56.66,"time":47.16},{"boost7dbm":51.22,"hf7dbm":47.49,"lf7dbm":56.75,"time":47.52},{"boost7dbm":51.46,"hf7dbm":47.59,"lf7dbm":57.19,"time":47.88},{"boost7dbm":51.31,"hf7dbm":47.83,"lf7dbm":56.94,"time":48.23},{"boost7dbm":51.39,"hf7dbm":48.04,"lf7dbm":56.66,"time":48.6},{"boost7dbm":51.4,"hf7dbm":47.68,"lf7dbm":56.9,"time":48.95},{"boost7dbm":51.28,"hf7dbm":47.57,"lf7dbm":56.66,"time":49.32},{"boost7dbm":51.66,"hf7dbm":47.74,"lf7dbm":56.58,"time":49.67},{"boost7dbm":51.58,"hf7dbm":47.57,"lf7dbm":57,"time":50.04},{"boost7dbm":51.42,"hf7dbm":47.64,"lf7dbm":56.96,"time":50.4},{"boost7dbm":51.32,"hf7dbm":47.59,"lf7dbm":56.75,"time":50.76},{"boost7dbm":51.38,"hf7dbm":47.48,"lf7dbm":56.43,"time":51.12},{"boost7dbm":51.36,"hf7dbm":47.68,"lf7dbm":57.15,"time":51.47},{"boost7dbm":51.29,"hf7dbm":47.64,"lf7dbm":57.28,"time":51.84},{"boost7dbm":51.34,"hf7dbm":47.72,"lf7dbm":56.6,"time":52.19},{"boost7dbm":51.33,"hf7dbm":47.63,"lf7dbm":56.9,"time":52.56},{"boost7dbm":51.36,"hf7dbm":47.64,"lf7dbm":57.11,"time":52.91},{"boost7dbm":51.35,"hf7dbm":47.63,"lf7dbm":56.62,"time":53.28},{"boost7dbm":51.33,"hf7dbm":48.15,"lf7dbm":56.47,"time":53.64},{"boost7dbm":51.32,"hf7dbm":47.65,"lf7dbm":56.87,"time":54},{"boost7dbm":51.32,"hf7dbm":47.63,"lf7dbm":56.81,"time":54.36},{"boost7dbm":51.45,"hf7dbm":47.61,"lf7dbm":56.58,"time":54.71},{"boost7dbm":51.83,"hf7dbm":47.56,"lf7dbm":57,"time":55.08},{"boost7dbm":51.4,"hf7dbm":47.69,"lf7dbm":56.9,"time":55.43},{"boost7dbm":51.28,"hf7dbm":47.6,"lf7dbm":56.66,"time":55.8},{"boost7dbm":51.42,"hf7dbm":47.53,"lf7dbm":57.19,"time":56.16},{"boost7dbm":51.32,"hf7dbm":47.62,"lf7dbm":56.96,"time":56.52},{"boost7dbm":51.31,"hf7dbm":47.61,"lf7dbm":56.79,"time":56.88},{"boost7dbm":51.29,"hf7dbm":47.71,"lf7dbm":56.81,"time":57.23},{"boost7dbm":51.4,"hf7dbm":47.64,"lf7dbm":56.77,"time":57.6},{"boost7dbm":51.31,"hf7dbm":47.62,"lf7dbm":57.49,"time":57.95},{"boost7dbm":51.32,"hf7dbm":47.95,"lf7dbm":56.51,"time":58.32},{"boost7dbm":51.37,"hf7dbm":47.8,"lf7dbm":57.11,"time":58.67},{"boost7dbm":51.39,"hf7dbm":47.57,"lf7dbm":56.9,"time":59.04},{"boost7dbm":51.26,"hf7dbm":47.71,"lf7dbm":56.92,"time":59.4},{"boost7dbm":51.68,"hf7dbm":47.63,"lf7dbm":57.32,"time":59.76},{"boost7dbm":51.54,"hf7dbm":47.57,"lf7dbm":57.13,"time":60.12},{"boost7dbm":51.33,"hf7dbm":47.63,"lf7dbm":56.68,"time":60.47},{"boost7dbm":51.31,"hf7dbm":47.57,"lf7dbm":57.24,"time":60.84},{"boost7dbm":51.31,"hf7dbm":47.57,"lf7dbm":56.87,"time":61.19},{"boost7dbm":51.29,"hf7dbm":47.54,"lf7dbm":56.66,"time":61.56},{"boost7dbm":51.3,"hf7dbm":47.73,"lf7dbm":56.77,"time":61.91},{"boost7dbm":51.31,"hf7dbm":47.63,"lf7dbm":56.96,"time":62.28},{"boost7dbm":51.33,"hf7dbm":47.65,"lf7dbm":56.9,"time":62.64},{"boost7dbm":51.39,"hf7dbm":47.61,"lf7dbm":57.02,"time":63},{"boost7dbm":51.36,"hf7dbm":47.82,"lf7dbm":57.07,"time":63.36},{"boost7dbm":51.3,"hf7dbm":48,"lf7dbm":56.49,"time":63.71},{"boost7dbm":51.33,"hf7dbm":47.59,"lf7dbm":56.81,"time":64.08},{"boost7dbm":51.31,"hf7dbm":47.64,"lf7dbm":56.68,"time":64.43},{"boost7dbm":51.54,"hf7dbm":47.57,"lf7dbm":56.75,"time":64.8},{"boost7dbm":51.7,"hf7dbm":47.59,"lf7dbm":57.45,"time":65.16},{"boost7dbm":51.35,"hf7dbm":47.59,"lf7dbm":57.45,"time":65.52},{"boost7dbm":51.35,"hf7dbm":47.54,"lf7dbm":56.73,"time":65.88},{"boost7dbm":51.34,"hf7dbm":47.51,"lf7dbm":57.07,"time":66.23},{"boost7dbm":51.36,"hf7dbm":47.62,"lf7dbm":57.28,"time":66.6},{"boost7dbm":51.35,"hf7dbm":47.7,"lf7dbm":56.6,"time":66.95},{"boost7dbm":51.22,"hf7dbm":47.66,"lf7dbm":56.96,"time":67.32},{"boost7dbm":51.37,"hf7dbm":47.53,"lf7dbm":56.9,"time":67.67},{"boost7dbm":51.28,"hf7dbm":47.62,"lf7dbm":57.37,"time":68.04},{"boost7dbm":51.36,"hf7dbm":48.07,"lf7dbm":57.49,"time":68.4},{"boost7dbm":51.37,"hf7dbm":47.64,"lf7dbm":56.79,"time":68.76},{"boost7dbm":51.34,"hf7dbm":47.61,"lf7dbm":56.85,"time":69.12},{"boost7dbm":51.37,"hf7dbm":47.66,"lf7dbm":56.62,"time":69.47},{"boost7dbm":51.8,"hf7dbm":47.67,"lf7dbm":57.17,"time":69.84},{"boost7dbm":51.54,"hf7dbm":47.63,"lf7dbm":56.68,"time":70.19},{"boost7dbm":51.37,"hf7dbm":47.59,"lf7dbm":56.51,"time":70.56},{"boost7dbm":51.23,"hf7dbm":47.62,"lf7dbm":56.43,"time":70.91},{"boost7dbm":51.44,"hf7dbm":47.53,"lf7dbm":56.94,"time":71.28},{"boost7dbm":51.29,"hf7dbm":47.55,"lf7dbm":56.73,"time":71.64},{"boost7dbm":51.3,"hf7dbm":47.65,"lf7dbm":56.21,"time":72},{"boost7dbm":51.22,"hf7dbm":47.59,"lf7dbm":56.73,"time":72.36},{"boost7dbm":51.4,"hf7dbm":47.58,"lf7dbm":57.15,"time":72.71},{"boost7dbm":51.38,"hf7dbm":47.58,"lf7dbm":57.05,"time":73.08},{"boost7dbm":51.4,"hf7dbm":47.98,"lf7dbm":56.56,"time":73.43},{"boost7dbm":51.35,"hf7dbm":47.87,"lf7dbm":56.79,"time":73.8},{"boost7dbm":51.3,"hf7dbm":47.63,"lf7dbm":56.75,"time":74.16},{"boost7dbm":51.32,"hf7dbm":47.76,"lf7dbm":56.28,"time":74.52},{"boost7dbm":51.7,"hf7dbm":47.66,"lf7dbm":57.41,"time":74.88},{"boost7dbm":51.62,"hf7dbm":47.58,"lf7dbm":56.9,"time":75.23},{"boost7dbm":51.33,"hf7dbm":47.68,"lf7dbm":56.77,"time":75.6},{"boost7dbm":51.31,"hf7dbm":47.54,"lf7dbm":56.7,"time":75.95},{"boost7dbm":51.28,"hf7dbm":47.55,"lf7dbm":57.05,"time":76.32},{"boost7dbm":51.34,"hf7dbm":47.67,"lf7dbm":56.98,"time":76.67},{"boost7dbm":51.29,"hf7dbm":47.71,"lf7dbm":56.9,"time":77.04},{"boost7dbm":51.23,"hf7dbm":47.61,"lf7dbm":57.51,"time":77.4},{"boost7dbm":51.4,"hf7dbm":47.54,"lf7dbm":57,"time":77.76},{"boost7dbm":51.35,"hf7dbm":47.57,"lf7dbm":57.3,"time":78.12},{"boost7dbm":51.36,"hf7dbm":48.2,"lf7dbm":56.7,"time":78.47},{"boost7dbm":51.35,"hf7dbm":47.65,"lf7dbm":57.11,"time":78.84},{"boost7dbm":51.32,"hf7dbm":47.58,"lf7dbm":57,"time":79.19},{"boost7dbm":51.37,"hf7dbm":47.73,"lf7dbm":57.47,"time":79.56},{"boost7dbm":51.83,"hf7dbm":47.64,"lf7dbm":57.19,"time":79.91},{"boost7dbm":51.46,"hf7dbm":47.64,"lf7dbm":56.81,"time":80.28},{"boost7dbm":51.29,"hf7dbm":47.66,"lf7dbm":57.07,"time":80.64},{"boost7dbm":51.35,"hf7dbm":47.47,"lf7dbm":57.15,"time":81},{"boost7dbm":51.29,"hf7dbm":47.58,"lf7dbm":57.07,"time":81.36},{"boost7dbm":51.31,"hf7dbm":47.64,"lf7dbm":56.62,"time":81.71},{"boost7dbm":51.29,"hf7dbm":47.67,"lf7dbm":56.73,"time":82.08},{"boost7dbm":51.23,"hf7dbm":47.6,"lf7dbm":57.11,"time":82.43},{"boost7dbm":51.38,"hf7dbm":47.6,"lf7dbm":56.79,"time":82.8},{"boost7dbm":51.31,"hf7dbm":47.6,"lf7dbm":57.13,"time":83.16},{"boost7dbm":51.32,"hf7dbm":48.08,"lf7dbm":57,"time":83.52},{"boost7dbm":51.37,"hf7dbm":47.75,"lf7dbm":57.24,"time":83.88},{"boost7dbm":51.3,"hf7dbm":47.54,"lf7dbm":56.73,"time":84.23},{"boost7dbm":51.35,"hf7dbm":47.77,"lf7dbm":57.05,"time":84.6},{"boost7dbm":51.82,"hf7dbm":47.57,"lf7dbm":57.11,"time":84.95},{"boost7dbm":51.54,"hf7dbm":47.64,"lf7dbm":56.81,"time":85.32},{"boost7dbm":51.28,"hf7dbm":47.55,"lf7dbm":56.34,"time":85.67},{"boost7dbm":51.36,"hf7dbm":47.45,"lf7dbm":56.73,"time":86.04},{"boost7dbm":51.32,"hf7dbm":47.59,"lf7dbm":56.81,"time":86.4},{"boost7dbm":51.36,"hf7dbm":47.62,"lf7dbm":56.85,"time":86.76},{"boost7dbm":51.25,"hf7dbm":47.79,"lf7dbm":56.94,"time":87.12},{"boost7dbm":51.33,"hf7dbm":47.6,"lf7dbm":57.24,"time":87.47},{"boost7dbm":51.45,"hf7dbm":47.57,"lf7dbm":57.58,"time":87.84},{"boost7dbm":51.4,"hf7dbm":47.68,"lf7dbm":56.85,"time":88.19},{"boost7dbm":51.29,"hf7dbm":48.15,"lf7dbm":56.7,"time":88.56},{"boost7dbm":51.37,"hf7dbm":47.63,"lf7dbm":56.87,"time":88.91},{"boost7dbm":51.33,"hf7dbm":47.66,"lf7dbm":57.15,"time":89.28},{"boost7dbm":51.62,"hf7dbm":47.75,"lf7dbm":56.94,"time":89.64},{"boost7dbm":51.76,"hf7dbm":47.72,"lf7dbm":56.85,"time":90},{"boost7dbm":51.38,"hf7dbm":47.57,"lf7dbm":56.75,"time":90.36},{"boost7dbm":51.3,"hf7dbm":47.55,"lf7dbm":56.77,"time":90.71},{"boost7dbm":51.28,"hf7dbm":47.57,"lf7dbm":56.94,"time":91.08},{"boost7dbm":51.37,"hf7dbm":47.64,"lf7dbm":56.9,"time":91.43},{"boost7dbm":51.35,"hf7dbm":47.6,"lf7dbm":56.21,"time":91.8},{"boost7dbm":51.34,"hf7dbm":47.78,"lf7dbm":56.75,"time":92.16},{"boost7dbm":51.26,"hf7dbm":47.61,"lf7dbm":56.6,"time":92.52},{"boost7dbm":51.46,"hf7dbm":47.57,"lf7dbm":57.3,"time":92.88},{"boost7dbm":51.39,"hf7dbm":47.6,"lf7dbm":57.3,"time":93.23},{"boost7dbm":51.37,"hf7dbm":48.08,"lf7dbm":56.9,"time":93.6},{"boost7dbm":51.28,"hf7dbm":47.68,"lf7dbm":56.94,"time":93.95},{"boost7dbm":51.34,"hf7dbm":47.54,"lf7dbm":56.98,"time":94.32},{"boost7dbm":51.37,"hf7dbm":47.77,"lf7dbm":56.32,"time":94.67},{"boost7dbm":51.92,"hf7dbm":47.57,"lf7dbm":56.62,"time":95.04},{"boost7dbm":51.49,"hf7dbm":47.68,"lf7dbm":56.83,"time":95.4},{"boost7dbm":51.31,"hf7dbm":47.59,"lf7dbm":56.41,"time":95.76},{"boost7dbm":51.31,"hf7dbm":47.52,"lf7dbm":56.75,"time":96.12},{"boost7dbm":51.37,"hf7dbm":47.64,"lf7dbm":56.58,"time":96.47},{"boost7dbm":51.39,"hf7dbm":47.64,"lf7dbm":57.07,"time":96.84},{"boost7dbm":51.32,"hf7dbm":47.71,"lf7dbm":56.62,"time":97.19},{"boost7dbm":51.3,"hf7dbm":47.68,"lf7dbm":56.47,"time":97.56},{"boost7dbm":51.43,"hf7dbm":47.64,"lf7dbm":57.43,"time":97.91},{"boost7dbm":51.36,"hf7dbm":47.87,"lf7dbm":56.53,"time":98.28},{"boost7dbm":51.36,"hf7dbm":47.96,"lf7dbm":56.92,"time":98.64},{"boost7dbm":51.37,"hf7dbm":47.64,"lf7dbm":56.62,"time":99},{"boost7dbm":51.41,"hf7dbm":47.61,"lf7dbm":57.09,"time":99.36},{"boost7dbm":51.85,"hf7dbm":47.78,"lf7dbm":57.09,"time":99.7},{"boost7dbm":51.62,"hf7dbm":47.63,"lf7dbm":57.11,"time":100.07},{"boost7dbm":51.39,"hf7dbm":47.62,"lf7dbm":57.24,"time":100.42},{"boost7dbm":51.26,"hf7dbm":47.63,"lf7dbm":56.68,"time":100.79},{"boost7dbm":51.3,"hf7dbm":47.54,"lf7dbm":56.96,"time":101.15},{"boost7dbm":51.31,"hf7dbm":47.59,"lf7dbm":57.05,"time":101.51},{"boost7dbm":51.39,"hf7dbm":47.61,"lf7dbm":57.11,"time":101.87},{"boost7dbm":51.35,"hf7dbm":47.75,"lf7dbm":56.85,"time":102.22},{"boost7dbm":51.32,"hf7dbm":47.63,"lf7dbm":57,"time":102.59},{"boost7dbm":51.4,"hf7dbm":47.64,"lf7dbm":57.19,"time":102.94}]
	


var xAxisKey = 'time';
txpinData.forEach(function(e, index) {
	e.time = '' + e.time;
});var txpinCtx = document.getElementById('txpin').getContext('2d');
const txpinChart = new Chart(txpinCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'RFO_HF',
            data: txpinData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'hf7dbm'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
        	label: 'PA_BOOST',
            data: txpinData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'boost7dbm'
            },
            borderColor: '#4161CC',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#4161CC',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
            label: 'RFO_LF',
            data: txpinData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'lf7dbm'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Зависимость уровня потребления тока от пина',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/txpin.png">
</noscript>
<p>Да, разница есть.</p>
<ul>
<li>Если сравнивать RFO_LF и RFO_HF, то видно, что потребление тока на частоте 168Мгц выше. Видимо, на этих частотах антенна <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D1%8D%D1%84%D1%84%D0%B8%D1%86%D0%B8%D0%B5%D0%BD%D1%82_%D1%81%D1%82%D0%BE%D1%8F%D1%87%D0%B5%D0%B9_%D0%B2%D0%BE%D0%BB%D0%BD%D1%8B">не согласована</a> больше.</li>
<li>Потребление тока при передаче через отдельный усилитель мощности и PA_BOOST пин больше, чем при передаче через RFO_HF. Наверное, разница уходит на питание того самого усилителя.</li>
</ul>
<h4 id="токовая-защита-усилителя">Токовая защита усилителя</h4>
<p>В чипе есть защита усилителя от превышения выходящего тока. При этом приговариваются слова про батарею, химические компоненты и пиковое потребление тока. Поначалу я ничего не понял. Немного почитав теорию, стало чуть более понятно. Усилитель рассчитан на импеданс антенны <strong>50</strong>Ом. Если импеданс не совпадает, либо перестал совпадать (антенна заржавела), то для генерации заданного уровня мощности, будет тратится всё больше и больше тока. Это может привести к тому, что усилитель может перегореть. Я сравнил отправку сообщения: без защиты (240мА), с небольшим ограничением (140мА), с максимальным ограничением (45мА).</p>
<pre tabindex="0"><code>AT+LORATX=CA,140200012,125000,9,5,18,8,0,1,1,0,17,240,1
AT+LORATX=CA,140200012,125000,9,5,18,8,0,1,1,0,17,140,1
AT+LORATX=CA,140200012,125000,9,5,18,8,0,1,1,0,17,45,1
</code></pre>































<canvas id="ocp2" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="ocp2" download="ocp2.png" href="" title="Токовая защита усилителя">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var ocp2Data = [{"ocp140":41.45,"ocp240":41.84,"ocp45":41.49,"time":0},{"ocp140":82.77,"ocp240":83.25,"ocp45":82.75,"time":0.35},{"ocp140":79.43,"ocp240":78.92,"ocp45":78.94,"time":0.72},{"ocp140":78.55,"ocp240":79.11,"ocp45":78.08,"time":1.08},{"ocp140":78.42,"ocp240":78.62,"ocp45":78.15,"time":1.43},{"ocp140":78.25,"ocp240":78.72,"ocp45":78.74,"time":1.8},{"ocp140":79.04,"ocp240":79.28,"ocp45":78.7,"time":2.16},{"ocp140":78,"ocp240":78.62,"ocp45":79.02,"time":2.51},{"ocp140":79.09,"ocp240":78.4,"ocp45":79.09,"time":2.87},{"ocp140":79.15,"ocp240":78.36,"ocp45":78.7,"time":3.24},{"ocp140":78.66,"ocp240":78.72,"ocp45":78.47,"time":3.59},{"ocp140":78.17,"ocp240":79.24,"ocp45":78.81,"time":3.95},{"ocp140":78.21,"ocp240":78.64,"ocp45":78.85,"time":4.32},{"ocp140":78.25,"ocp240":79.02,"ocp45":78.66,"time":4.67},{"ocp140":78.59,"ocp240":78.94,"ocp45":78.53,"time":5.03},{"ocp140":78.77,"ocp240":78.83,"ocp45":78.51,"time":5.4},{"ocp140":78.55,"ocp240":78.23,"ocp45":78.72,"time":5.75},{"ocp140":78.55,"ocp240":78.7,"ocp45":78.27,"time":6.11},{"ocp140":78.49,"ocp240":78.57,"ocp45":78.7,"time":6.48},{"ocp140":77.65,"ocp240":77.29,"ocp45":77.5,"time":6.83},{"ocp140":77.29,"ocp240":77.38,"ocp45":76.86,"time":7.19},{"ocp140":78.55,"ocp240":78.7,"ocp45":78.87,"time":7.56},{"ocp140":79.56,"ocp240":78.94,"ocp45":79.32,"time":7.91},{"ocp140":79.02,"ocp240":79.09,"ocp45":78.59,"time":8.27},{"ocp140":78.51,"ocp240":78.79,"ocp45":78.44,"time":8.64},{"ocp140":78.62,"ocp240":78.96,"ocp45":78.59,"time":9},{"ocp140":79.04,"ocp240":78.64,"ocp45":78.59,"time":9.35},{"ocp140":78.89,"ocp240":79.24,"ocp45":78.47,"time":9.72},{"ocp140":79.15,"ocp240":78.96,"ocp45":78.27,"time":10.08},{"ocp140":78.32,"ocp240":78.85,"ocp45":78.89,"time":10.43},{"ocp140":79.04,"ocp240":79.09,"ocp45":78.83,"time":10.8},{"ocp140":78.94,"ocp240":78.96,"ocp45":78.94,"time":11.16},{"ocp140":79.07,"ocp240":78.57,"ocp45":78.66,"time":11.51},{"ocp140":79.02,"ocp240":79.17,"ocp45":78.81,"time":11.87},{"ocp140":79.24,"ocp240":79.09,"ocp45":78.27,"time":12.24},{"ocp140":78.55,"ocp240":78.47,"ocp45":78.94,"time":12.59},{"ocp140":79.26,"ocp240":78.59,"ocp45":79.07,"time":12.95},{"ocp140":79.09,"ocp240":78.4,"ocp45":79,"time":13.32},{"ocp140":78.77,"ocp240":78.87,"ocp45":78.74,"time":13.67},{"ocp140":78.92,"ocp240":79.09,"ocp45":78.87,"time":14.03},{"ocp140":78.79,"ocp240":78.89,"ocp45":78.81,"time":14.4},{"ocp140":78.23,"ocp240":79.37,"ocp45":79.17,"time":14.75},{"ocp140":78.53,"ocp240":78.32,"ocp45":79.26,"time":15.11},{"ocp140":79.19,"ocp240":78.72,"ocp45":78.85,"time":15.48},{"ocp140":79,"ocp240":78.57,"ocp45":78.92,"time":15.83},{"ocp140":79.11,"ocp240":78.83,"ocp45":78.77,"time":16.19},{"ocp140":78.7,"ocp240":78.89,"ocp45":78.55,"time":16.56},{"ocp140":79.3,"ocp240":78.62,"ocp45":79.13,"time":16.91},{"ocp140":78.94,"ocp240":78.51,"ocp45":78.57,"time":17.27},{"ocp140":78.64,"ocp240":78.59,"ocp45":79.04,"time":17.64},{"ocp140":79.11,"ocp240":78.42,"ocp45":79.22,"time":18},{"ocp140":79,"ocp240":78.62,"ocp45":78.47,"time":18.35},{"ocp140":78.7,"ocp240":78.85,"ocp45":78.53,"time":18.72},{"ocp140":79.22,"ocp240":78.77,"ocp45":78.66,"time":19.08},{"ocp140":78.81,"ocp240":78.42,"ocp45":79.04,"time":19.43},{"ocp140":78.72,"ocp240":79.49,"ocp45":78.49,"time":19.8},{"ocp140":78.92,"ocp240":78.83,"ocp45":78.59,"time":20.16},{"ocp140":79.13,"ocp240":78.81,"ocp45":79.15,"time":20.51},{"ocp140":78.98,"ocp240":78.55,"ocp45":78.81,"time":20.87},{"ocp140":78.55,"ocp240":78.96,"ocp45":78.81,"time":21.24},{"ocp140":78.89,"ocp240":78.36,"ocp45":78.7,"time":21.59},{"ocp140":78.59,"ocp240":78.4,"ocp45":78.92,"time":21.95},{"ocp140":78.94,"ocp240":78.32,"ocp45":78.92,"time":22.32},{"ocp140":78.79,"ocp240":78.57,"ocp45":79.22,"time":22.67},{"ocp140":79.6,"ocp240":78.53,"ocp45":78.77,"time":23.03},{"ocp140":78.96,"ocp240":79.09,"ocp45":78.7,"time":23.4},{"ocp140":78.79,"ocp240":78.66,"ocp45":78.59,"time":23.75},{"ocp140":78.98,"ocp240":78.94,"ocp45":78.89,"time":24.1},{"ocp140":78.55,"ocp240":78.94,"ocp45":78.92,"time":24.47},{"ocp140":79.07,"ocp240":79.43,"ocp45":78.66,"time":24.83},{"ocp140":79.26,"ocp240":78.74,"ocp45":78.27,"time":25.18},{"ocp140":78.74,"ocp240":78.72,"ocp45":78.83,"time":25.55},{"ocp140":78.68,"ocp240":78.53,"ocp45":78.34,"time":25.91},{"ocp140":79.02,"ocp240":78.89,"ocp45":78.81,"time":26.26},{"ocp140":79.11,"ocp240":79,"ocp45":79,"time":26.62},{"ocp140":79.09,"ocp240":78.87,"ocp45":79.11,"time":26.99},{"ocp140":79.3,"ocp240":78.68,"ocp45":78.38,"time":27.34},{"ocp140":79.15,"ocp240":78.96,"ocp45":79.13,"time":27.7},{"ocp140":79.41,"ocp240":78.42,"ocp45":78.74,"time":28.07},{"ocp140":78.85,"ocp240":78.4,"ocp45":78.49,"time":28.42},{"ocp140":79.15,"ocp240":78.79,"ocp45":78.62,"time":28.78},{"ocp140":79.28,"ocp240":78.85,"ocp45":78.68,"time":29.15},{"ocp140":78.87,"ocp240":78.72,"ocp45":78.08,"time":29.5},{"ocp140":78.44,"ocp240":79.41,"ocp45":78.53,"time":29.86},{"ocp140":78.64,"ocp240":78.62,"ocp45":78.57,"time":30.23},{"ocp140":78.83,"ocp240":78.3,"ocp45":78.57,"time":30.58},{"ocp140":78.23,"ocp240":78.64,"ocp45":78.51,"time":30.94},{"ocp140":78.3,"ocp240":79,"ocp45":78.64,"time":31.31},{"ocp140":78.25,"ocp240":78.74,"ocp45":78.62,"time":31.66},{"ocp140":78.74,"ocp240":78.55,"ocp45":79.04,"time":32.02},{"ocp140":79.04,"ocp240":78.77,"ocp45":78.64,"time":32.39},{"ocp140":78.83,"ocp240":79.04,"ocp45":79.41,"time":32.75},{"ocp140":79.26,"ocp240":79.02,"ocp45":78.57,"time":33.1},{"ocp140":78.64,"ocp240":78.49,"ocp45":78.59,"time":33.47},{"ocp140":78.72,"ocp240":78.57,"ocp45":78.38,"time":33.83},{"ocp140":78.89,"ocp240":78.44,"ocp45":79,"time":34.18},{"ocp140":78.55,"ocp240":78.98,"ocp45":78.57,"time":34.55},{"ocp140":79.07,"ocp240":79.22,"ocp45":78.64,"time":34.91},{"ocp140":78.64,"ocp240":79.11,"ocp45":78.59,"time":35.26},{"ocp140":79.19,"ocp240":78.74,"ocp45":79.13,"time":35.62},{"ocp140":78.55,"ocp240":78.49,"ocp45":78.34,"time":35.99},{"ocp140":78.15,"ocp240":78.66,"ocp45":79.32,"time":36.34},{"ocp140":79.34,"ocp240":79.13,"ocp45":79.17,"time":36.7},{"ocp140":79.19,"ocp240":78.92,"ocp45":78.72,"time":37.07},{"ocp140":79.02,"ocp240":79.13,"ocp45":78.79,"time":37.42},{"ocp140":79.13,"ocp240":78.7,"ocp45":79.73,"time":37.78},{"ocp140":79.19,"ocp240":78.59,"ocp45":78.74,"time":38.15},{"ocp140":79.09,"ocp240":78.49,"ocp45":78.7,"time":38.5},{"ocp140":78.57,"ocp240":78.42,"ocp45":78.47,"time":38.86},{"ocp140":79.11,"ocp240":79.02,"ocp45":78.77,"time":39.23},{"ocp140":78.64,"ocp240":78.62,"ocp45":79.11,"time":39.58},{"ocp140":78.83,"ocp240":79.45,"ocp45":78.85,"time":39.94},{"ocp140":78.85,"ocp240":79,"ocp45":78.57,"time":40.31},{"ocp140":79.09,"ocp240":78.96,"ocp45":78.51,"time":40.66},{"ocp140":79.24,"ocp240":78.89,"ocp45":78.34,"time":41.02},{"ocp140":78.87,"ocp240":79.28,"ocp45":78.72,"time":41.39},{"ocp140":79.04,"ocp240":79.22,"ocp45":78.98,"time":41.75},{"ocp140":78.89,"ocp240":78.77,"ocp45":79.15,"time":42.1},{"ocp140":79.11,"ocp240":78.57,"ocp45":78.85,"time":42.47},{"ocp140":79.13,"ocp240":79.02,"ocp45":79.07,"time":42.83},{"ocp140":78.89,"ocp240":78.74,"ocp45":78.42,"time":43.18},{"ocp140":78.85,"ocp240":78.79,"ocp45":77.91,"time":43.55},{"ocp140":78.32,"ocp240":78.83,"ocp45":78.51,"time":43.91},{"ocp140":78.47,"ocp240":78.83,"ocp45":78.64,"time":44.26},{"ocp140":78.72,"ocp240":79.28,"ocp45":78.49,"time":44.62},{"ocp140":78.79,"ocp240":79.04,"ocp45":78.47,"time":44.99},{"ocp140":78.59,"ocp240":78.83,"ocp45":78.64,"time":45.34},{"ocp140":78.98,"ocp240":78.92,"ocp45":78.68,"time":45.7},{"ocp140":79.24,"ocp240":78.53,"ocp45":78.81,"time":46.07},{"ocp140":79,"ocp240":79,"ocp45":78.77,"time":46.42},{"ocp140":78.96,"ocp240":78.96,"ocp45":78.85,"time":46.78},{"ocp140":78.94,"ocp240":78.62,"ocp45":78.7,"time":47.15},{"ocp140":78.44,"ocp240":79.11,"ocp45":79,"time":47.5},{"ocp140":79,"ocp240":78.7,"ocp45":79.51,"time":47.86},{"ocp140":78.77,"ocp240":78.19,"ocp45":78.17,"time":48.23},{"ocp140":78.59,"ocp240":78.25,"ocp45":78.32,"time":48.58},{"ocp140":78.74,"ocp240":78.7,"ocp45":78.49,"time":48.94},{"ocp140":79.34,"ocp240":78.53,"ocp45":78.57,"time":49.31},{"ocp140":78.85,"ocp240":79.04,"ocp45":78.27,"time":49.66},{"ocp140":78.32,"ocp240":78.85,"ocp45":78.55,"time":50.02},{"ocp140":78.94,"ocp240":79.17,"ocp45":78.98,"time":50.39},{"ocp140":78.4,"ocp240":78.47,"ocp45":78.36,"time":50.75},{"ocp140":78.89,"ocp240":78.38,"ocp45":78.51,"time":51.1},{"ocp140":78.44,"ocp240":78.89,"ocp45":78.79,"time":51.47},{"ocp140":78.79,"ocp240":78.85,"ocp45":79.39,"time":51.83},{"ocp140":78.36,"ocp240":78.92,"ocp45":78.81,"time":52.18},{"ocp140":78.53,"ocp240":78.74,"ocp45":78.57,"time":52.55},{"ocp140":79.6,"ocp240":78.87,"ocp45":78.74,"time":52.91},{"ocp140":78.81,"ocp240":78.79,"ocp45":78.53,"time":53.26},{"ocp140":78.83,"ocp240":78.96,"ocp45":78.51,"time":53.62},{"ocp140":78.79,"ocp240":79.11,"ocp45":78.25,"time":53.99},{"ocp140":78.62,"ocp240":78.94,"ocp45":78.53,"time":54.34},{"ocp140":78.53,"ocp240":79.07,"ocp45":78.74,"time":54.7},{"ocp140":78.23,"ocp240":79.15,"ocp45":78.92,"time":55.07},{"ocp140":78.38,"ocp240":79,"ocp45":78.74,"time":55.42},{"ocp140":78.49,"ocp240":79.11,"ocp45":79.04,"time":55.78},{"ocp140":78.81,"ocp240":79.15,"ocp45":78.85,"time":56.15},{"ocp140":78.12,"ocp240":78.83,"ocp45":79.11,"time":56.5},{"ocp140":78.72,"ocp240":79,"ocp45":78.72,"time":56.86},{"ocp140":78.34,"ocp240":78.79,"ocp45":78.74,"time":57.23},{"ocp140":78.89,"ocp240":78.55,"ocp45":78.87,"time":57.58},{"ocp140":79.07,"ocp240":78.7,"ocp45":78.89,"time":57.94},{"ocp140":79.02,"ocp240":78.7,"ocp45":78.38,"time":58.31},{"ocp140":78.64,"ocp240":79.32,"ocp45":78.21,"time":58.66},{"ocp140":78.7,"ocp240":79.37,"ocp45":77.91,"time":59.02},{"ocp140":78.98,"ocp240":79.37,"ocp45":78.72,"time":59.39},{"ocp140":79.11,"ocp240":79.32,"ocp45":78.34,"time":59.75},{"ocp140":78.72,"ocp240":78.72,"ocp45":77.97,"time":60.1},{"ocp140":78.81,"ocp240":79.09,"ocp45":78.66,"time":60.47},{"ocp140":79.24,"ocp240":79.37,"ocp45":78.59,"time":60.83},{"ocp140":78.53,"ocp240":79.02,"ocp45":78.34,"time":61.18},{"ocp140":78.53,"ocp240":78.85,"ocp45":78.83,"time":61.55},{"ocp140":78.3,"ocp240":78.77,"ocp45":78.7,"time":61.91},{"ocp140":78.68,"ocp240":78.59,"ocp45":78.51,"time":62.26},{"ocp140":79,"ocp240":79.13,"ocp45":78.77,"time":62.62},{"ocp140":79.11,"ocp240":78.55,"ocp45":79.04,"time":62.99},{"ocp140":78.59,"ocp240":78.94,"ocp45":79.17,"time":63.34},{"ocp140":78.72,"ocp240":79.39,"ocp45":78.36,"time":63.7},{"ocp140":78.85,"ocp240":79.26,"ocp45":78.72,"time":64.07},{"ocp140":78.62,"ocp240":78.77,"ocp45":78.4,"time":64.42},{"ocp140":78.64,"ocp240":79.3,"ocp45":78.7,"time":64.78},{"ocp140":78.38,"ocp240":78.85,"ocp45":78.59,"time":65.15},{"ocp140":78.74,"ocp240":79.02,"ocp45":78.81,"time":65.5},{"ocp140":78.72,"ocp240":79.22,"ocp45":78.64,"time":65.86},{"ocp140":78.62,"ocp240":79.34,"ocp45":78.7,"time":66.23},{"ocp140":79.11,"ocp240":79.26,"ocp45":79.02,"time":66.58},{"ocp140":78.94,"ocp240":78.96,"ocp45":78.79,"time":66.94},{"ocp140":78.87,"ocp240":78.7,"ocp45":78.85,"time":67.31},{"ocp140":78.94,"ocp240":78.79,"ocp45":79.22,"time":67.66},{"ocp140":79.39,"ocp240":78.81,"ocp45":78.74,"time":68.02},{"ocp140":79.02,"ocp240":78.4,"ocp45":78.66,"time":68.39},{"ocp140":78.94,"ocp240":78.98,"ocp45":78.98,"time":68.75},{"ocp140":78.94,"ocp240":78.83,"ocp45":78.66,"time":69.1},{"ocp140":79.3,"ocp240":78.94,"ocp45":78.27,"time":69.47},{"ocp140":78.87,"ocp240":79.26,"ocp45":78.77,"time":69.83},{"ocp140":78.29,"ocp240":78.94,"ocp45":78.89,"time":70.18},{"ocp140":78.62,"ocp240":78.92,"ocp45":79,"time":70.55},{"ocp140":78.59,"ocp240":79,"ocp45":78.3,"time":70.91},{"ocp140":78.74,"ocp240":78.92,"ocp45":78.81,"time":71.26},{"ocp140":79.17,"ocp240":78.87,"ocp45":78.74,"time":71.62},{"ocp140":78.87,"ocp240":78.25,"ocp45":78.74,"time":71.99},{"ocp140":79.71,"ocp240":78.7,"ocp45":78.81,"time":72.34},{"ocp140":78.79,"ocp240":79.49,"ocp45":79.15,"time":72.7},{"ocp140":79.15,"ocp240":78.47,"ocp45":78.94,"time":73.07},{"ocp140":78.57,"ocp240":79.39,"ocp45":78.47,"time":73.42},{"ocp140":79.07,"ocp240":78.83,"ocp45":79,"time":73.78},{"ocp140":78.83,"ocp240":79.02,"ocp45":78.34,"time":74.15},{"ocp140":78.81,"ocp240":78.72,"ocp45":79,"time":74.5},{"ocp140":78.64,"ocp240":79.26,"ocp45":79.13,"time":74.86},{"ocp140":78.96,"ocp240":78.85,"ocp45":78.59,"time":75.23},{"ocp140":78.77,"ocp240":78.98,"ocp45":78.51,"time":75.58},{"ocp140":79.04,"ocp240":78.74,"ocp45":78.32,"time":75.94},{"ocp140":78.62,"ocp240":79.13,"ocp45":79.15,"time":76.31},{"ocp140":78.4,"ocp240":78.68,"ocp45":78.87,"time":76.66},{"ocp140":78.89,"ocp240":78.32,"ocp45":78.79,"time":77.02},{"ocp140":78.83,"ocp240":78.53,"ocp45":78.36,"time":77.39},{"ocp140":78.87,"ocp240":78.85,"ocp45":79.75,"time":77.75},{"ocp140":79.58,"ocp240":78.66,"ocp45":78.53,"time":78.1},{"ocp140":79.04,"ocp240":78.98,"ocp45":78.53,"time":78.47},{"ocp140":79.34,"ocp240":78.49,"ocp45":78.62,"time":78.83},{"ocp140":79.58,"ocp240":79.17,"ocp45":78.64,"time":79.18},{"ocp140":79.11,"ocp240":78.89,"ocp45":78.81,"time":79.55},{"ocp140":78.79,"ocp240":79.47,"ocp45":79,"time":79.91},{"ocp140":79.04,"ocp240":78.89,"ocp45":78.74,"time":80.26},{"ocp140":78.57,"ocp240":79.04,"ocp45":78.94,"time":80.62},{"ocp140":78.36,"ocp240":78.77,"ocp45":78.77,"time":80.99},{"ocp140":78.59,"ocp240":79.04,"ocp45":78.7,"time":81.34},{"ocp140":79.09,"ocp240":79.13,"ocp45":78.96,"time":81.7},{"ocp140":79.39,"ocp240":79.09,"ocp45":78.44,"time":82.07},{"ocp140":78.85,"ocp240":78.81,"ocp45":78.53,"time":82.42},{"ocp140":79.6,"ocp240":78.94,"ocp45":79.3,"time":82.78},{"ocp140":78.62,"ocp240":79.02,"ocp45":78.79,"time":83.15},{"ocp140":78.66,"ocp240":78.87,"ocp45":78.1,"time":83.5},{"ocp140":78.53,"ocp240":78.57,"ocp45":78.51,"time":83.86},{"ocp140":78.81,"ocp240":79.56,"ocp45":78.7,"time":84.23},{"ocp140":78.98,"ocp240":79.51,"ocp45":78.79,"time":84.58},{"ocp140":78.79,"ocp240":79.17,"ocp45":79.09,"time":84.94},{"ocp140":78.68,"ocp240":79.26,"ocp45":78.53,"time":85.31},{"ocp140":79.17,"ocp240":78.72,"ocp45":78.83,"time":85.66},{"ocp140":78.68,"ocp240":78.89,"ocp45":78.42,"time":86.02},{"ocp140":78.96,"ocp240":78.89,"ocp45":78.47,"time":86.39},{"ocp140":78.83,"ocp240":78.66,"ocp45":79.07,"time":86.75},{"ocp140":78.53,"ocp240":78.81,"ocp45":78.57,"time":87.1},{"ocp140":79.07,"ocp240":78.66,"ocp45":78.77,"time":87.47},{"ocp140":78.72,"ocp240":79.04,"ocp45":79.56,"time":87.83},{"ocp140":78.96,"ocp240":78.83,"ocp45":78.87,"time":88.18},{"ocp140":78.98,"ocp240":78.79,"ocp45":78.55,"time":88.55},{"ocp140":79.04,"ocp240":78.4,"ocp45":78.79,"time":88.91},{"ocp140":78.79,"ocp240":78.94,"ocp45":78.92,"time":89.26},{"ocp140":78.81,"ocp240":79.02,"ocp45":78.49,"time":89.62},{"ocp140":79.24,"ocp240":79.02,"ocp45":78.51,"time":89.99},{"ocp140":78.53,"ocp240":78.94,"ocp45":78.77,"time":90.34},{"ocp140":78.7,"ocp240":79.09,"ocp45":78.02,"time":90.7},{"ocp140":79.07,"ocp240":78.98,"ocp45":78.87,"time":91.07},{"ocp140":78.83,"ocp240":78.87,"ocp45":78.83,"time":91.42},{"ocp140":78.85,"ocp240":78.89,"ocp45":79.3,"time":91.78},{"ocp140":78.77,"ocp240":78.79,"ocp45":78.47,"time":92.15},{"ocp140":78.96,"ocp240":78.89,"ocp45":78.59,"time":92.5},{"ocp140":78.87,"ocp240":79.11,"ocp45":79.13,"time":92.86},{"ocp140":78.66,"ocp240":78.59,"ocp45":78.87,"time":93.23},{"ocp140":78.96,"ocp240":78.72,"ocp45":78.44,"time":93.58},{"ocp140":78.3,"ocp240":78.47,"ocp45":78.81,"time":93.94},{"ocp140":78.74,"ocp240":79.24,"ocp45":78.66,"time":94.31},{"ocp140":78.57,"ocp240":79.73,"ocp45":78.87,"time":94.66},{"ocp140":79.28,"ocp240":79.02,"ocp45":78.96,"time":95.02},{"ocp140":78.81,"ocp240":78.44,"ocp45":78.32,"time":95.39},{"ocp140":78.81,"ocp240":78.83,"ocp45":78.17,"time":95.75},{"ocp140":78.85,"ocp240":78.68,"ocp45":78.51,"time":96.1},{"ocp140":78.68,"ocp240":79.19,"ocp45":78.44,"time":96.47},{"ocp140":79.13,"ocp240":78.66,"ocp45":78.81,"time":96.83},{"ocp140":78.72,"ocp240":79.22,"ocp45":78.12,"time":97.18},{"ocp140":79.13,"ocp240":79.02,"ocp45":79,"time":97.55},{"ocp140":79.22,"ocp240":78.83,"ocp45":78.92,"time":97.91},{"ocp140":79.17,"ocp240":78.92,"ocp45":78.32,"time":98.26},{"ocp140":78.94,"ocp240":78.53,"ocp45":78.74,"time":98.62},{"ocp140":79.07,"ocp240":78.92,"ocp45":78.44,"time":98.99},{"ocp140":78.89,"ocp240":78.81,"ocp45":78.72,"time":99.34},{"ocp140":78.83,"ocp240":79.17,"ocp45":78.7,"time":99.7},{"ocp140":78.92,"ocp240":78.64,"ocp45":78.77,"time":100.07},{"ocp140":79,"ocp240":78.74,"ocp45":78.89,"time":100.42},{"ocp140":78.96,"ocp240":78.42,"ocp45":78.66,"time":100.78},{"ocp140":78.51,"ocp240":78.64,"ocp45":78.19,"time":101.15},{"ocp140":79.17,"ocp240":78.66,"ocp45":78.55,"time":101.5},{"ocp140":78.89,"ocp240":79,"ocp45":78.36,"time":101.86},{"ocp140":78.96,"ocp240":79.47,"ocp45":78.4,"time":102.23},{"ocp140":78.72,"ocp240":78.7,"ocp45":78.49,"time":102.58},{"ocp140":79.92,"ocp240":78.87,"ocp45":79.77,"time":102.94},{"ocp140":78.62,"ocp240":78.62,"ocp45":79,"time":103.31}]
	


var xAxisKey = 'time';
ocp2Data.forEach(function(e, index) {
	e.time = '' + e.time;
});var ocp2Ctx = document.getElementById('ocp2').getContext('2d');
const ocp2Chart = new Chart(ocp2Ctx, {
    type: 'line',
    data: {
        datasets: [{
        	label: '140мА',
            data: ocp2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'ocp140'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
        	label: '45мА',
            data: ocp2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'ocp45'
            },
            borderColor: '#4161CC',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#4161CC',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
            label: '240мА',
            data: ocp2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'ocp240'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Токовая защита усилителя',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/ocp2.png">
</noscript>
<p>Плата потребляет постоянное количество тока независимо от установленной защиты. Но это не значит, что защита не работает. Возможно, нужно измерять фактическую передаваемую мощность на антенне. К сожалению, у меня нет нужного оборудования, чтобы это проверить.</p>
<h2 id="сравнение-с-c-версией">Сравнение с C++ версией</h2>
<p>Как я уже писал, <a href="https://github.com/dernasherbrezon/lora-at">lora-at</a> изначально была реализована на C++ с помощью библиотек разного уровня качества. Моя теория заключалась в том, что переписав проект на С, я бы смог достичь более высокой эффективности и простоты. Одна из целей была достигнута - сборка проекта стала занимать меньше времени и размер прошивки уменьшился в два раза. Но что насчёт энергопотребления?</p>
<p>Работа чипа sx127x не зависит от выбранного языка, но вот всё остальное может теоретически отличаться.</p>
<h3 id="подключение-по-bluetooth">Подключение по bluetooth</h3>
<p>Одно из основных отличий первой версии от второй является работа с bluetooth. Если в первой версии использовалась С++ библиотека поверх Bluedroid, то во второй версии я использовал Nimble. В документации сказано, что Nimble - это более легковесная реализация BLE протокола. Но так ли это на самом деле? И есть ли разница в скорости работы? Это очень легко проверить. Для этого можно использовать команду:</p>
<pre tabindex="0"><code>AT+BLUETOOTH=B8:27:EB:6C:7C:F8
</code></pre><p>Эта команда сделает следующее:</p>
<ul>
<li>запустит подключение к bluetooth серверу по адресу <code>B8:27:EB:6C:7C:F8</code></li>
<li>выполнит поиск нужного GATT сервиса и характеристики</li>
</ul>
































<canvas id="bluetooth2" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="bluetooth2" download="bluetooth2.png" href="" title="Потребление тока при подключении к bluetooth серверу">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var bluetooth2Data = [{"blec":37.67,"blec2":49.24,"blecpp":41.73,"time":0},{"blec":80.54,"blec2":68.02,"blecpp":54.25,"time":17.23},{"blec":99.44,"blec2":90.19,"blecpp":66.03,"time":34.45},{"blec":99.34,"blec2":191.75,"blecpp":107.67,"time":51.67},{"blec":99.49,"blec2":194.91,"blecpp":195.52,"time":68.91},{"blec":99.94,"blec2":112.2,"blecpp":199.03,"time":86.14},{"blec":99.37,"blec2":99.58,"blecpp":114.33,"time":103.36},{"blec":99.81,"blec2":103.06,"blecpp":99.79,"time":120.59},{"blec":99.89,"blec2":102.71,"blecpp":103.88,"time":137.82},{"blec":99.57,"blec2":105.67,"blecpp":103.76,"time":155.04},{"blec":99.74,"blec2":108.02,"blecpp":103.94,"time":172.27},{"blec":99.57,"blec2":104.95,"blecpp":104.08,"time":189.5},{"blec":100.09,"blec2":104.9,"blecpp":104.21,"time":206.73},{"blec":99.55,"blec2":104.94,"blecpp":103.97,"time":223.96},{"blec":99.6,"blec2":104.92,"blecpp":104.22,"time":241.18},{"blec":99.77,"blec2":104.99,"blecpp":104.22,"time":258.41},{"blec":99.98,"blec2":104.73,"blecpp":104.27,"time":275.64},{"blec":99.26,"blec2":104.87,"blecpp":104.12,"time":292.87},{"blec":99.63,"blec2":104.95,"blecpp":104.26,"time":310.1},{"blec":100.29,"blec2":104.59,"blecpp":103.75,"time":327.33},{"blec":99.78,"blec2":104.79,"blecpp":103.89,"time":344.55},{"blec":99.38,"blec2":104.85,"blecpp":104.01,"time":361.78},{"blec":99.68,"blec2":104.79,"blecpp":104.13,"time":379.01},{"blec":100.16,"blec2":104.6,"blecpp":104.19,"time":396.25},{"blec":99.97,"blec2":104.47,"blecpp":104.22,"time":413.48},{"blec":99.69,"blec2":104.63,"blecpp":103.73,"time":430.7},{"blec":99.9,"blec2":104.96,"blecpp":104.07,"time":447.92},{"blec":100.02,"blec2":104.91,"blecpp":104.01,"time":465.16},{"blec":99.68,"blec2":104.87,"blecpp":104.09,"time":482.39},{"blec":99.79,"blec2":104.89,"blecpp":104.09,"time":499.61},{"blec":100.13,"blec2":104.62,"blecpp":103.97,"time":516.84},{"blec":99.84,"blec2":104.87,"blecpp":104.14,"time":534.07},{"blec":99.59,"blec2":104.76,"blecpp":104.16,"time":551.29},{"blec":99.79,"blec2":104.82,"blecpp":104.12,"time":568.52},{"blec":99.73,"blec2":104.81,"blecpp":104.11,"time":585.75},{"blec":99.58,"blec2":104.94,"blecpp":104.15,"time":602.98},{"blec":99.52,"blec2":105.06,"blecpp":103.98,"time":620.21},{"blec":99.85,"blec2":105.05,"blecpp":104.1,"time":637.44},{"blec":99.41,"blec2":88.25,"blecpp":104.19,"time":654.66},{"blec":99.5,"blec2":72.13,"blecpp":103.97,"time":671.89},{"blec":99.98,"blec2":70.41,"blecpp":104.06,"time":689.12},{"blec":100.25,"blec2":44.93,"blecpp":103.88,"time":706.35},{"blec":99.95,"blec2":70.55,"blecpp":103.83,"time":723.58},{"blec":99.9,"blec2":100.55,"blecpp":104.3,"time":740.8},{"blec":100.36,"blec2":100.89,"blecpp":103.88,"time":758.03},{"blec":100.19,"blec2":100.85,"blecpp":104.32,"time":775.26},{"blec":99.92,"blec2":100.33,"blecpp":104.27,"time":792.5},{"blec":99.5,"blec2":100.57,"blecpp":104.4,"time":809.73},{"blec":100.45,"blec2":101.2,"blecpp":104.34,"time":826.95},{"blec":100.03,"blec2":100.73,"blecpp":103.98,"time":844.17},{"blec":99.95,"blec2":100.59,"blecpp":104.16,"time":861.41},{"blec":99.85,"blec2":100.77,"blecpp":104.31,"time":878.64},{"blec":100.54,"blec2":101.25,"blecpp":104.21,"time":895.86},{"blec":99.56,"blec2":100.86,"blecpp":104.26,"time":913.09},{"blec":99.77,"blec2":100.51,"blecpp":103.97,"time":930.32},{"blec":100.36,"blec2":100.26,"blecpp":103.8,"time":947.54},{"blec":99.79,"blec2":100.86,"blecpp":103.76,"time":964.77},{"blec":100.01,"blec2":100.7,"blecpp":104.08,"time":982},{"blec":99.53,"blec2":100.47,"blecpp":104.08,"time":999.23},{"blec":99.97,"blec2":100.97,"blecpp":104.13,"time":1016.46},{"blec":99.73,"blec2":100.73,"blecpp":103.91,"time":1033.69},{"blec":99.88,"blec2":100.54,"blecpp":103.9,"time":1050.91},{"blec":99.94,"blec2":100.65,"blecpp":104.13,"time":1068.14},{"blec":100.06,"blec2":101.26,"blecpp":103.87,"time":1085.37},{"blec":99.77,"blec2":100.74,"blecpp":61.08,"time":1102.6},{"blec":99.51,"blec2":100.62,"blecpp":41.68,"time":1119.83},{"blec":100.12,"blec2":101.05,"blecpp":62.69,"time":1137.07},{"blec":99.72,"blec2":100.89,"blecpp":62.29,"time":1154.28},{"blec":99.15,"blec2":100.72,"blecpp":62.16,"time":1171.51},{"blec":100.01,"blec2":100.82,"blecpp":62.12,"time":1188.75},{"blec":100.45,"blec2":101.15,"blecpp":61.88,"time":1205.98},{"blec":99.55,"blec2":100.85,"blecpp":60.16,"time":1223.2},{"blec":99.64,"blec2":84.67,"blecpp":64.48,"time":1240.42},{"blec":100.33,"blec2":48.96,"blecpp":62.3,"time":1257.66},{"blec":100.24,"blec2":31.28,"blecpp":61.66,"time":1274.89},{"blec":99.91,"blec2":31.29,"blecpp":31.15,"time":1292.11},{"blec":99.86,"blec2":51.24,"blecpp":31.13,"time":1309.34},{"blec":100.07,"blec2":31.28,"blecpp":31.12,"time":1326.57},{"blec":99.82,"blec2":31.27,"blecpp":31.11,"time":1343.79},{"blec":100.21,"blec2":48.56,"blecpp":31.14,"time":1361.02},{"blec":100.19,"blec2":31.27,"blecpp":31.18,"time":1378.25},{"blec":100.65,"blec2":31.27,"blecpp":31.21,"time":1395.48},{"blec":99.97,"blec2":51.16,"blecpp":31.18,"time":1412.71},{"blec":100.08,"blec2":31.25,"blecpp":31.22,"time":1429.94},{"blec":100.49,"blec2":31.88,"blecpp":31.2,"time":1447.16},{"blec":99.98,"blec2":47.85,"blecpp":34.29,"time":1464.39},{"blec":99.78,"blec2":31.27,"blecpp":95.37,"time":1481.62},{"blec":100.01,"blec2":38.57,"blecpp":100.53,"time":1498.85},{"blec":100.37,"blec2":41.21,"blecpp":41.48,"time":1516.08},{"blec":99.32,"blec2":31.24,"blecpp":55.78,"time":1533.32},{"blec":100.1,"blec2":45.07,"blecpp":101.3,"time":1550.53},{"blec":99.7,"blec2":34.77,"blecpp":74.89,"time":1567.76},{"blec":100.13,"blec2":31.24,"blecpp":31.17,"time":1585},{"blec":99.86,"blec2":51.2,"blecpp":92.2,"time":1602.23},{"blec":100.24,"blec2":42.26,"blecpp":100.66,"time":1619.45},{"blec":100.64,"blec2":37.79,"blecpp":38.68,"time":1636.68},{"blec":100.17,"blec2":54.88,"blecpp":58.43,"time":1653.91},{"blec":99.92,"blec2":31.26,"blecpp":101.39,"time":1671.14},{"blec":99.77,"blec2":31.24,"blecpp":72.34,"time":1688.36},{"blec":100.35,"blec2":54.91,"blecpp":31.12,"time":1705.59},{"blec":99.75,"blec2":43.14,"blecpp":94.78,"time":1722.82},{"blec":99.98,"blec2":41.5,"blecpp":100.54,"time":1740.04},{"blec":100.12,"blec2":57.78,"blecpp":36.3,"time":1757.27},{"blec":100.14,"blec2":31.24,"blecpp":60.98,"time":1774.5},{"blec":100.03,"blec2":31.25,"blecpp":100.6,"time":1791.73},{"blec":99.86,"blec2":0,"blecpp":69.91,"time":1808.96},{"blec":100.68,"blec2":0,"blecpp":31.17,"time":1826.19},{"blec":99.81,"blec2":0,"blecpp":97.36,"time":1843.41},{"blec":99.95,"blec2":0,"blecpp":101.43,"time":1860.64},{"blec":100.42,"blec2":0,"blecpp":33.92,"time":1877.87},{"blec":99.8,"blec2":0,"blecpp":63.58,"time":1895.1},{"blec":100.14,"blec2":0,"blecpp":100.98,"time":1912.33},{"blec":100.05,"blec2":0,"blecpp":67.76,"time":1929.57},{"blec":100.39,"blec2":0,"blecpp":31.27,"time":1946.78},{"blec":99.89,"blec2":0,"blecpp":99.66,"time":1964.01},{"blec":100.08,"blec2":0,"blecpp":101,"time":1981.25},{"blec":100.18,"blec2":0,"blecpp":31.51,"time":1998.48},{"blec":100.34,"blec2":0,"blecpp":66.05,"time":2015.7},{"blec":99.75,"blec2":0,"blecpp":101.56,"time":2032.93},{"blec":99.71,"blec2":0,"blecpp":65.53,"time":2050.16},{"blec":100.44,"blec2":0,"blecpp":32.69,"time":2067.39},{"blec":100.01,"blec2":0,"blecpp":100.87,"time":2084.61},{"blec":99.99,"blec2":0,"blecpp":98.89,"time":2101.84},{"blec":99.99,"blec2":0,"blecpp":31.34,"time":2119.07},{"blec":100.43,"blec2":0,"blecpp":68.39,"time":2136.3},{"blec":100.18,"blec2":0,"blecpp":101.07,"time":2153.52},{"blec":100.13,"blec2":0,"blecpp":62.9,"time":2170.75},{"blec":100.15,"blec2":0,"blecpp":35.24,"time":2187.98},{"blec":100.5,"blec2":0,"blecpp":100.72,"time":2205.21},{"blec":100.15,"blec2":0,"blecpp":96.96,"time":2222.44},{"blec":100.15,"blec2":0,"blecpp":31.35,"time":2239.66},{"blec":100.89,"blec2":0,"blecpp":70.81,"time":2256.89},{"blec":100.15,"blec2":0,"blecpp":101.18,"time":2274.12},{"blec":100.1,"blec2":0,"blecpp":60.62,"time":2291.35},{"blec":100.14,"blec2":0,"blecpp":37.56,"time":2308.58},{"blec":100.57,"blec2":0,"blecpp":100.5,"time":2325.82},{"blec":100.11,"blec2":0,"blecpp":93.74,"time":2343.03},{"blec":100.03,"blec2":0,"blecpp":31.43,"time":2360.26},{"blec":100.5,"blec2":0,"blecpp":73.22,"time":2377.5},{"blec":99.91,"blec2":0,"blecpp":101.4,"time":2394.73},{"blec":99.98,"blec2":0,"blecpp":58.34,"time":2411.95},{"blec":100.36,"blec2":0,"blecpp":39.97,"time":2429.18},{"blec":100.56,"blec2":0,"blecpp":100.95,"time":2446.41},{"blec":99.92,"blec2":0,"blecpp":53.03,"time":2463.64},{"blec":100.04,"blec2":0,"blecpp":48.42,"time":2480.86},{"blec":100.34,"blec2":0,"blecpp":59.86,"time":2498.09},{"blec":100.2,"blec2":0,"blecpp":57.98,"time":2515.32},{"blec":99.9,"blec2":0,"blecpp":49.74,"time":2532.55},{"blec":99.59,"blec2":0,"blecpp":57.31,"time":2549.77},{"blec":100.38,"blec2":0,"blecpp":54.68,"time":2567},{"blec":100.05,"blec2":0,"blecpp":55.73,"time":2584.23},{"blec":100.15,"blec2":0,"blecpp":88.85,"time":2601.46},{"blec":100.05,"blec2":0,"blecpp":49.19,"time":2618.69},{"blec":100.85,"blec2":0,"blecpp":51.88,"time":2635.92},{"blec":99.73,"blec2":0,"blecpp":60.3,"time":2653.14},{"blec":100.21,"blec2":0,"blecpp":57.29,"time":2670.37},{"blec":100.42,"blec2":0,"blecpp":64.7,"time":2687.6},{"blec":100.02,"blec2":0,"blecpp":75.48,"time":2704.84},{"blec":100.19,"blec2":0,"blecpp":53.26,"time":2722.07},{"blec":100.01,"blec2":0,"blecpp":48.34,"time":2739.28},{"blec":100.4,"blec2":0,"blecpp":31.54,"time":2756.51},{"blec":100.09,"blec2":0,"blecpp":38.14,"time":2773.75},{"blec":100.23,"blec2":0,"blecpp":72.98,"time":2790.98},{"blec":100.11,"blec2":0,"blecpp":39.23,"time":2808.2},{"blec":100.62,"blec2":0,"blecpp":44.58,"time":2825.43},{"blec":99.84,"blec2":0,"blecpp":40.81,"time":2842.66},{"blec":99.95,"blec2":0,"blecpp":31.53,"time":2859.89},{"blec":100.7,"blec2":0,"blecpp":50.75,"time":2877.11},{"blec":100.2,"blec2":0,"blecpp":64.07,"time":2894.34},{"blec":99.62,"blec2":0,"blecpp":31.53,"time":2911.57},{"blec":100.22,"blec2":0,"blecpp":53.8,"time":2928.8},{"blec":100.76,"blec2":0,"blecpp":31.58,"time":2946.02},{"blec":100.14,"blec2":0,"blecpp":31.59,"time":2963.25},{"blec":100.1,"blec2":0,"blecpp":57.24,"time":2980.48},{"blec":100.38,"blec2":0,"blecpp":40.65,"time":2997.71},{"blec":100.17,"blec2":0,"blecpp":31.53,"time":3014.94},{"blec":99.69,"blec2":0,"blecpp":48.4,"time":3032.17},{"blec":99.81,"blec2":0,"blecpp":31.55,"time":3049.39},{"blec":100.42,"blec2":0,"blecpp":31.58,"time":3066.62},{"blec":101.01,"blec2":0,"blecpp":48.42,"time":3083.85},{"blec":64.2,"blec2":0,"blecpp":31.58,"time":3101.09},{"blec":30.93,"blec2":0,"blecpp":31.57,"time":3118.32},{"blec":30.89,"blec2":0,"blecpp":67.85,"time":3135.54},{"blec":47.8,"blec2":0,"blecpp":32.56,"time":3152.76},{"blec":30.9,"blec2":0,"blecpp":31.54,"time":3170},{"blec":30.98,"blec2":0,"blecpp":69.59,"time":3187.23},{"blec":48.05,"blec2":0,"blecpp":31.54,"time":3204.45},{"blec":30.89,"blec2":0,"blecpp":31.59,"time":3221.68},{"blec":36.1,"blec2":0,"blecpp":48.61,"time":3238.91},{"blec":42.95,"blec2":0,"blecpp":31.54,"time":3256.14},{"blec":30.89,"blec2":0,"blecpp":36.64,"time":3273.36},{"blec":42.54,"blec2":0,"blecpp":63.8,"time":3290.59},{"blec":38.91,"blec2":0,"blecpp":31.54,"time":3307.82},{"blec":30.87,"blec2":0,"blecpp":43.08,"time":3325.05},{"blec":48.02,"blec2":0,"blecpp":57.61,"time":3342.27},{"blec":30.83,"blec2":0,"blecpp":31.58,"time":3359.5},{"blec":30.86,"blec2":0,"blecpp":49.82,"time":3376.73},{"blec":47.92,"blec2":0,"blecpp":32.9,"time":3393.96},{"blec":30.86,"blec2":0,"blecpp":31.53,"time":3411.19},{"blec":30.87,"blec2":0,"blecpp":53.38,"time":3428.42},{"blec":47.93,"blec2":0,"blecpp":54.38,"time":3445.64},{"blec":30.86,"blec2":0,"blecpp":31.53,"time":3462.87},{"blec":30.83,"blec2":0,"blecpp":51.51,"time":3480.1},{"blec":47.87,"blec2":0,"blecpp":31.59,"time":3497.34},{"blec":30.83,"blec2":0,"blecpp":31.54,"time":3514.57},{"blec":30.83,"blec2":0,"blecpp":58.57,"time":3531.79},{"blec":47.79,"blec2":0,"blecpp":39.32,"time":3549.01},{"blec":30.82,"blec2":0,"blecpp":31.55,"time":3566.25},{"blec":30.82,"blec2":0,"blecpp":48.54,"time":3583.48},{"blec":50.44,"blec2":0,"blecpp":31.57,"time":3600.7},{"blec":30.85,"blec2":0,"blecpp":31.55,"time":3617.93},{"blec":30.83,"blec2":0,"blecpp":48.36,"time":3635.16},{"blec":48.09,"blec2":0,"blecpp":31.52,"time":3652.39},{"blec":30.83,"blec2":0,"blecpp":31.52,"time":3669.61},{"blec":30.82,"blec2":0,"blecpp":51.2,"time":3686.84},{"blec":47.75,"blec2":0,"blecpp":31.54,"time":3704.07},{"blec":30.81,"blec2":0,"blecpp":31.54,"time":3721.3},{"blec":34.52,"blec2":0,"blecpp":66.67,"time":3738.52},{"blec":44.31,"blec2":0,"blecpp":31.52,"time":3755.75},{"blec":30.82,"blec2":0,"blecpp":34.95,"time":3772.98},{"blec":41.02,"blec2":0,"blecpp":47.84,"time":3790.21},{"blec":37.62,"blec2":0,"blecpp":31.53,"time":3807.44},{"blec":30.81,"blec2":0,"blecpp":41.28,"time":3824.67},{"blec":47.62,"blec2":0,"blecpp":56.62,"time":3841.89},{"blec":31.03,"blec2":0,"blecpp":31.57,"time":3859.12},{"blec":30.81,"blec2":0,"blecpp":48.13,"time":3876.35},{"blec":47.91,"blec2":0,"blecpp":31.89,"time":3893.59},{"blec":30.8,"blec2":0,"blecpp":31.54,"time":3910.82},{"blec":30.81,"blec2":0,"blecpp":51.27,"time":3928.04},{"blec":47.87,"blec2":0,"blecpp":31.58,"time":3945.26},{"blec":30.8,"blec2":0,"blecpp":31.57,"time":3962.5},{"blec":30.79,"blec2":0,"blecpp":53.83,"time":3979.73},{"blec":47.98,"blec2":0,"blecpp":44.15,"time":3996.95},{"blec":30.81,"blec2":0,"blecpp":31.57,"time":4014.18},{"blec":30.78,"blec2":0,"blecpp":51.38,"time":4031.41},{"blec":48.08,"blec2":0,"blecpp":31.55,"time":4048.64},{"blec":30.77,"blec2":0,"blecpp":31.57,"time":4065.86},{"blec":35.74,"blec2":0,"blecpp":48.16,"time":4083.09},{"blec":47.69,"blec2":0,"blecpp":31.57,"time":4100.32},{"blec":30.78,"blec2":0,"blecpp":31.54,"time":4117.55},{"blec":30.78,"blec2":0,"blecpp":62.22,"time":4134.78},{"blec":47.79,"blec2":0,"blecpp":36.2,"time":4152},{"blec":30.8,"blec2":0,"blecpp":31.54,"time":4169.23},{"blec":30.78,"blec2":0,"blecpp":48.68,"time":4186.46},{"blec":59.17,"blec2":0,"blecpp":31.53,"time":4203.69},{"blec":40.03,"blec2":0,"blecpp":31.54,"time":4220.92},{"blec":32.65,"blec2":0,"blecpp":51.28,"time":4238.14},{"blec":46.24,"blec2":0,"blecpp":31.61,"time":4255.37},{"blec":30.78,"blec2":0,"blecpp":33.13,"time":4272.6},{"blec":39.31,"blec2":0,"blecpp":64.82,"time":4289.84},{"blec":39.4,"blec2":0,"blecpp":31.55,"time":4307.07},{"blec":30.78,"blec2":0,"blecpp":39.97,"time":4324.29},{"blec":46.14,"blec2":0,"blecpp":42.92,"time":4341.51},{"blec":38.66,"blec2":0,"blecpp":31.55,"time":4358.75},{"blec":30.76,"blec2":0,"blecpp":46.24,"time":4375.98},{"blec":51.37,"blec2":0,"blecpp":64.23,"time":4393.2},{"blec":30.76,"blec2":0,"blecpp":31.56,"time":4410.43},{"blec":30.77,"blec2":0,"blecpp":51.32,"time":4427.66},{"blec":48.89,"blec2":0,"blecpp":31.61,"time":4444.89},{"blec":30.77,"blec2":0,"blecpp":31.64,"time":4462.11},{"blec":30.77,"blec2":0,"blecpp":48.18,"time":4479.34},{"blec":48.93,"blec2":0,"blecpp":31.62,"time":4496.57},{"blec":30.77,"blec2":0,"blecpp":31.56,"time":4513.8},{"blec":30.75,"blec2":0,"blecpp":48.39,"time":4531.03},{"blec":48.93,"blec2":0,"blecpp":31.56,"time":4548.25},{"blec":30.75,"blec2":0,"blecpp":31.56,"time":4565.48},{"blec":30.76,"blec2":0,"blecpp":59.39,"time":4582.71},{"blec":48.81,"blec2":0,"blecpp":39.04,"time":4599.94},{"blec":30.76,"blec2":0,"blecpp":31.6,"time":4617.17},{"blec":30.76,"blec2":0,"blecpp":48.53,"time":4634.41},{"blec":49.05,"blec2":0,"blecpp":31.57,"time":4651.62},{"blec":30.77,"blec2":0,"blecpp":31.57,"time":4668.85},{"blec":30.75,"blec2":0,"blecpp":51.33,"time":4686.09},{"blec":48.9,"blec2":0,"blecpp":31.58,"time":4703.32},{"blec":30.73,"blec2":0,"blecpp":31.55,"time":4720.54},{"blec":31.22,"blec2":0,"blecpp":66.69,"time":4737.77},{"blec":48.47,"blec2":0,"blecpp":31.58,"time":4755},{"blec":30.75,"blec2":0,"blecpp":31.86,"time":4772.23},{"blec":37.72,"blec2":0,"blecpp":48.23,"time":4789.45},{"blec":41.79,"blec2":0,"blecpp":31.48,"time":4806.68},{"blec":30.73,"blec2":0,"blecpp":38.38,"time":4823.91},{"blec":44.24,"blec2":0,"blecpp":44.39,"time":4841.14},{"blec":35.41,"blec2":0,"blecpp":31.52,"time":4858.36},{"blec":30.73,"blec2":0,"blecpp":44.73,"time":4875.59},{"blec":51.73,"blec2":0,"blecpp":55.91,"time":4892.82},{"blec":36.21,"blec2":0,"blecpp":0,"time":4910.05},{"blec":30.73,"blec2":0,"blecpp":0,"time":4927.28},{"blec":48.3,"blec2":0,"blecpp":0,"time":4944.5},{"blec":30.73,"blec2":0,"blecpp":0,"time":4961.73},{"blec":30.74,"blec2":0,"blecpp":0,"time":4978.96},{"blec":52.37,"blec2":0,"blecpp":0,"time":4996.19},{"blec":42.76,"blec2":0,"blecpp":0,"time":5013.42},{"blec":35.92,"blec2":0,"blecpp":0,"time":5030.66},{"blec":62.25,"blec2":0,"blecpp":0,"time":5047.87},{"blec":30.73,"blec2":0,"blecpp":0,"time":5065.1},{"blec":35.67,"blec2":0,"blecpp":0,"time":5082.34},{"blec":51.1,"blec2":0,"blecpp":0,"time":5099.57},{"blec":30.72,"blec2":0,"blecpp":0,"time":5116.79},{"blec":30.72,"blec2":0,"blecpp":0,"time":5134.02}]
	


var xAxisKey = 'time';
bluetooth2Data.forEach(function(e, index) {
	e.time = '' + e.time;
});var bluetooth2Ctx = document.getElementById('bluetooth2').getContext('2d');
const bluetooth2Chart = new Chart(bluetooth2Ctx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'С\u002b\u002b',
            data: bluetooth2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'blecpp'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
        	label: 'С около RPi',
            data: bluetooth2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'blec2'
            },
            borderColor: '#4161CC',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#4161CC',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        },{
            label: 'С',
            data: bluetooth2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'blec'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' мс';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Потребление тока при подключении к bluetooth серверу',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' мс';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/bluetooth2.png">
</noscript>
<p>Тут стоит отметить, что у меня не всегда получалось подключиться к серверу! В какой-то момент мне пришлось поднести плату поближе к RaspberryPI. Тут-то и обнаружилось, что чем ближе к bluetooth серверу, тем быстрее происходит подключение. Даже если я использовал разные версии приложения, то время на подключение было очень разным. Что давало сильный разброс в результатах. Например, с 3-х метров С-код мог потратить <strong>386.8</strong>мКл, а C++ вообще не подключиться. Или с одного метра С++ тратил <strong>308.3</strong>мКл, а С-код - <strong>150.2</strong>мКл. В общем, так себе получился тест.</p>
<h3 id="глубокий-сон">Глубокий сон</h3>
<p>Глубокий сон - это особый режим работы, при котором отключена вся периферия и ESP32 работает потребляя минимальное количество энергии. В этом режиме невозможно сделать ничего полезного, поэтому глубокий сон обычно чередуется активной фазой. В активной фазе устройство делает полезные операции, после чего опять уходит в сон. Чем меньше активная фаза, тем меньше энергии будет потреблять устройство в конечном итоге. В lora-at можно конфигурировать интервал глубокого сна. Например, команда ниже задаст конфигурацию: после 15 секунд бездействия перейти на 15 секунд в режим глубокого сна.</p>
<pre tabindex="0"><code>AT+DSCONFIG=15000,15000
</code></pre><p>Во время активной фазы lora-at подключается по bluetooth к серверу, получает расписание следующего включения и снова засыпает.</p>
































<canvas id="dsCycle" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="dsCycle" download="dsCycle.png" href="" title="Активная фаза">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var dsCycleData = [{"dsc":29.09,"dscpp":32.14,"time":0},{"dsc":41.82,"dscpp":43.21,"time":26.58},{"dsc":42.9,"dscpp":42.83,"time":53.16},{"dsc":45.41,"dscpp":43.11,"time":79.73},{"dsc":46.03,"dscpp":43.13,"time":106.31},{"dsc":45.05,"dscpp":43.09,"time":132.89},{"dsc":46.1,"dscpp":43.08,"time":159.47},{"dsc":46.05,"dscpp":43.07,"time":186.04},{"dsc":46.06,"dscpp":43.07,"time":212.62},{"dsc":46.2,"dscpp":43.08,"time":239.2},{"dsc":46.29,"dscpp":43.07,"time":265.78},{"dsc":46.13,"dscpp":43.08,"time":292.35},{"dsc":46.16,"dscpp":43.08,"time":318.93},{"dsc":44.96,"dscpp":42.93,"time":345.51},{"dsc":44.19,"dscpp":42.58,"time":372.09},{"dsc":41.34,"dscpp":46.79,"time":398.66},{"dsc":41.08,"dscpp":37.53,"time":425.24},{"dsc":41.12,"dscpp":37.36,"time":451.82},{"dsc":41.3,"dscpp":77.15,"time":478.39},{"dsc":41.21,"dscpp":101.3,"time":504.97},{"dsc":39.2,"dscpp":101.15,"time":531.55},{"dsc":39.54,"dscpp":101.18,"time":558.13},{"dsc":40.43,"dscpp":101.12,"time":584.7},{"dsc":63.63,"dscpp":101.2,"time":611.28},{"dsc":104.01,"dscpp":101.21,"time":637.86},{"dsc":104.13,"dscpp":101.18,"time":664.44},{"dsc":104.09,"dscpp":101.31,"time":691.01},{"dsc":103.87,"dscpp":101.27,"time":717.59},{"dsc":104.11,"dscpp":101.27,"time":744.17},{"dsc":104.07,"dscpp":101.27,"time":770.75},{"dsc":104.06,"dscpp":101.25,"time":797.32},{"dsc":103.99,"dscpp":101.21,"time":823.9},{"dsc":104.19,"dscpp":101.01,"time":850.48},{"dsc":104.01,"dscpp":101.32,"time":877.05},{"dsc":104.03,"dscpp":101.21,"time":903.63},{"dsc":104.06,"dscpp":101.39,"time":930.21},{"dsc":104.16,"dscpp":101.23,"time":956.79},{"dsc":104,"dscpp":101.23,"time":983.36},{"dsc":103.96,"dscpp":101.24,"time":1009.94},{"dsc":104.03,"dscpp":101.31,"time":1036.52},{"dsc":90.44,"dscpp":100.9,"time":1063.1},{"dsc":69.95,"dscpp":101.27,"time":1089.67},{"dsc":50.21,"dscpp":100.97,"time":1116.25},{"dsc":88.06,"dscpp":101.33,"time":1142.83},{"dsc":99.67,"dscpp":101.29,"time":1169.41},{"dsc":99.41,"dscpp":101.36,"time":1195.98},{"dsc":99.95,"dscpp":101.48,"time":1222.56},{"dsc":99.72,"dscpp":101.49,"time":1249.14},{"dsc":99.83,"dscpp":101.6,"time":1275.71},{"dsc":100.17,"dscpp":101.5,"time":1302.29},{"dsc":99.74,"dscpp":101.6,"time":1328.87},{"dsc":99.4,"dscpp":101.32,"time":1355.45},{"dsc":99.98,"dscpp":71.52,"time":1382.02},{"dsc":99.53,"dscpp":45.49,"time":1408.6},{"dsc":99.3,"dscpp":58.85,"time":1435.18},{"dsc":99.69,"dscpp":58.7,"time":1461.76},{"dsc":99.54,"dscpp":59.11,"time":1488.33},{"dsc":99.42,"dscpp":62.82,"time":1514.91},{"dsc":99.51,"dscpp":60.53,"time":1541.49},{"dsc":99.39,"dscpp":42.99,"time":1568.07},{"dsc":99.91,"dscpp":28.06,"time":1594.64},{"dsc":99.78,"dscpp":28.07,"time":1621.22},{"dsc":99.77,"dscpp":28.05,"time":1647.8},{"dsc":99.86,"dscpp":28.06,"time":1674.37},{"dsc":99.89,"dscpp":28.04,"time":1700.95},{"dsc":99.08,"dscpp":28.05,"time":1727.53},{"dsc":99.59,"dscpp":55.27,"time":1754.11},{"dsc":99.42,"dscpp":96.5,"time":1780.68},{"dsc":99.35,"dscpp":32.01,"time":1807.26},{"dsc":92.96,"dscpp":97.98,"time":1833.84},{"dsc":44.97,"dscpp":44.29,"time":1860.42},{"dsc":31.62,"dscpp":83.84,"time":1886.99},{"dsc":41.84,"dscpp":62.2,"time":1913.57},{"dsc":30.72,"dscpp":66.01,"time":1940.14},{"dsc":43.58,"dscpp":80.1,"time":1966.73},{"dsc":30.7,"dscpp":47.81,"time":1993.3},{"dsc":41.75,"dscpp":98.1,"time":2019.87},{"dsc":30.7,"dscpp":30.43,"time":2046.46},{"dsc":41.74,"dscpp":97.44,"time":2073.04},{"dsc":30.69,"dscpp":46.41,"time":2099.61},{"dsc":41.84,"dscpp":82.14,"time":2126.19},{"dsc":30.7,"dscpp":64.64,"time":2152.77},{"dsc":51.75,"dscpp":63.84,"time":2179.34},{"dsc":36.67,"dscpp":82.73,"time":2205.92},{"dsc":43.87,"dscpp":45.74,"time":2232.5},{"dsc":41,"dscpp":97.63,"time":2259.08},{"dsc":38.78,"dscpp":30.61,"time":2285.64},{"dsc":44.59,"dscpp":97.41,"time":2312.23},{"dsc":43.62,"dscpp":48.56,"time":2338.81},{"dsc":51.04,"dscpp":79.78,"time":2365.39},{"dsc":30.71,"dscpp":66.23,"time":2391.96},{"dsc":53.14,"dscpp":61.56,"time":2418.54},{"dsc":34.15,"dscpp":84.23,"time":2445.12},{"dsc":45.52,"dscpp":43.64,"time":2471.7},{"dsc":30.71,"dscpp":98.05,"time":2498.27},{"dsc":43.89,"dscpp":32.65,"time":2524.85},{"dsc":30.71,"dscpp":95.73,"time":2551.43},{"dsc":51.09,"dscpp":50.64,"time":2578},{"dsc":0,"dscpp":77.4,"time":2604.58},{"dsc":0,"dscpp":68.57,"time":2631.16},{"dsc":0,"dscpp":59.64,"time":2657.74},{"dsc":0,"dscpp":86.95,"time":2684.31},{"dsc":0,"dscpp":41.59,"time":2710.89},{"dsc":0,"dscpp":97.83,"time":2737.47},{"dsc":0,"dscpp":34.8,"time":2764.05},{"dsc":0,"dscpp":93.29,"time":2790.62},{"dsc":0,"dscpp":52.66,"time":2817.2},{"dsc":0,"dscpp":75.29,"time":2843.78},{"dsc":0,"dscpp":71.02,"time":2870.36},{"dsc":0,"dscpp":57.47,"time":2896.93},{"dsc":0,"dscpp":88.92,"time":2923.51},{"dsc":0,"dscpp":39.35,"time":2950.09},{"dsc":0,"dscpp":97.94,"time":2976.66},{"dsc":0,"dscpp":36.92,"time":3003.24},{"dsc":0,"dscpp":91.33,"time":3029.82},{"dsc":0,"dscpp":55.16,"time":3056.4},{"dsc":0,"dscpp":73.47,"time":3082.97},{"dsc":0,"dscpp":72.7,"time":3109.55},{"dsc":0,"dscpp":55.35,"time":3136.13},{"dsc":0,"dscpp":90.92,"time":3162.71},{"dsc":0,"dscpp":37.3,"time":3189.28},{"dsc":0,"dscpp":98.64,"time":3215.86},{"dsc":0,"dscpp":39.18,"time":3242.44},{"dsc":0,"dscpp":89.35,"time":3269.02},{"dsc":0,"dscpp":57.33,"time":3295.59},{"dsc":0,"dscpp":71.07,"time":3322.17},{"dsc":0,"dscpp":75.19,"time":3348.75},{"dsc":0,"dscpp":53.39,"time":3375.32},{"dsc":0,"dscpp":93.07,"time":3401.9},{"dsc":0,"dscpp":35.3,"time":3428.48},{"dsc":0,"dscpp":97.9,"time":3455.06},{"dsc":0,"dscpp":41.32,"time":3481.63},{"dsc":0,"dscpp":87.07,"time":3508.21},{"dsc":0,"dscpp":59.27,"time":3534.79},{"dsc":0,"dscpp":69.09,"time":3561.37},{"dsc":0,"dscpp":77.38,"time":3587.94},{"dsc":0,"dscpp":51.09,"time":3614.52},{"dsc":0,"dscpp":95.66,"time":3641.1},{"dsc":0,"dscpp":33.27,"time":3667.68},{"dsc":0,"dscpp":97.89,"time":3694.25},{"dsc":0,"dscpp":43.38,"time":3720.83},{"dsc":0,"dscpp":85.36,"time":3747.41},{"dsc":0,"dscpp":61.69,"time":3773.98},{"dsc":0,"dscpp":67.18,"time":3800.56},{"dsc":0,"dscpp":79.12,"time":3827.14},{"dsc":0,"dscpp":48.81,"time":3853.72},{"dsc":0,"dscpp":97.46,"time":3880.29},{"dsc":0,"dscpp":31.15,"time":3906.87},{"dsc":0,"dscpp":97.91,"time":3933.45},{"dsc":0,"dscpp":45.52,"time":3960.03},{"dsc":0,"dscpp":83.22,"time":3986.6},{"dsc":0,"dscpp":63.8,"time":4013.18},{"dsc":0,"dscpp":64.87,"time":4039.76},{"dsc":0,"dscpp":81.52,"time":4066.34},{"dsc":0,"dscpp":46.82,"time":4092.91},{"dsc":0,"dscpp":98.52,"time":4119.49},{"dsc":0,"dscpp":30.47,"time":4146.07},{"dsc":0,"dscpp":97.66,"time":4172.65},{"dsc":0,"dscpp":47.77,"time":4199.22},{"dsc":0,"dscpp":80.24,"time":4225.8},{"dsc":0,"dscpp":65.44,"time":4252.38},{"dsc":0,"dscpp":62.73,"time":4278.95},{"dsc":0,"dscpp":83.65,"time":4305.53},{"dsc":0,"dscpp":44.65,"time":4332.11},{"dsc":0,"dscpp":98.32,"time":4358.69},{"dsc":0,"dscpp":31.75,"time":4385.26},{"dsc":0,"dscpp":96.23,"time":4411.84},{"dsc":0,"dscpp":49.69,"time":4438.42},{"dsc":0,"dscpp":78.89,"time":4465},{"dsc":0,"dscpp":67.88,"time":4491.57},{"dsc":0,"dscpp":60.74,"time":4518.15},{"dsc":0,"dscpp":85.71,"time":4544.73},{"dsc":0,"dscpp":42.49,"time":4571.31},{"dsc":0,"dscpp":97.67,"time":4597.88},{"dsc":0,"dscpp":33.89,"time":4624.46},{"dsc":0,"dscpp":94.86,"time":4651.04},{"dsc":0,"dscpp":52.12,"time":4677.61},{"dsc":0,"dscpp":76.16,"time":4704.19},{"dsc":0,"dscpp":68.18,"time":4730.77},{"dsc":0,"dscpp":58.49,"time":4757.35},{"dsc":0,"dscpp":87.93,"time":4783.92},{"dsc":0,"dscpp":40.4,"time":4810.5},{"dsc":0,"dscpp":98.6,"time":4837.08},{"dsc":0,"dscpp":36.07,"time":4863.66},{"dsc":0,"dscpp":92.3,"time":4890.23},{"dsc":0,"dscpp":54.28,"time":4916.81},{"dsc":0,"dscpp":74.42,"time":4943.39},{"dsc":0,"dscpp":72.08,"time":4969.97},{"dsc":0,"dscpp":56.5,"time":4996.54},{"dsc":0,"dscpp":90.51,"time":5023.12},{"dsc":0,"dscpp":38.29,"time":5049.7},{"dsc":0,"dscpp":98.8,"time":5076.27},{"dsc":0,"dscpp":38.27,"time":5102.85},{"dsc":0,"dscpp":90.23,"time":5129.43},{"dsc":0,"dscpp":56.33,"time":5156.01},{"dsc":0,"dscpp":72.29,"time":5182.58},{"dsc":0,"dscpp":74.57,"time":5209.16},{"dsc":0,"dscpp":54.29,"time":5235.74},{"dsc":0,"dscpp":90.35,"time":5262.32},{"dsc":0,"dscpp":45.75,"time":5288.89},{"dsc":0,"dscpp":53.42,"time":5315.47},{"dsc":0,"dscpp":55.59,"time":5342.05},{"dsc":0,"dscpp":50.33,"time":5368.63},{"dsc":0,"dscpp":71.73,"time":5395.2},{"dsc":0,"dscpp":53.12,"time":5421.78},{"dsc":0,"dscpp":69,"time":5448.36},{"dsc":0,"dscpp":63.36,"time":5474.93},{"dsc":0,"dscpp":71.13,"time":5501.51},{"dsc":0,"dscpp":55.78,"time":5528.09},{"dsc":0,"dscpp":28.14,"time":5554.67},{"dsc":0,"dscpp":47.35,"time":5581.24},{"dsc":0,"dscpp":33.79,"time":5607.82},{"dsc":0,"dscpp":48.99,"time":5634.4},{"dsc":0,"dscpp":31.79,"time":5660.98},{"dsc":0,"dscpp":51.52,"time":5687.55},{"dsc":0,"dscpp":28.13,"time":5714.13},{"dsc":0,"dscpp":53.26,"time":5740.71},{"dsc":0,"dscpp":28.13,"time":5767.29},{"dsc":0,"dscpp":41.08,"time":5793.86},{"dsc":0,"dscpp":28.14,"time":5820.44},{"dsc":0,"dscpp":38.92,"time":5847.02},{"dsc":0,"dscpp":32.18,"time":5873.59},{"dsc":0,"dscpp":35.15,"time":5900.17},{"dsc":0,"dscpp":40.01,"time":5926.75},{"dsc":0,"dscpp":40.76,"time":5953.33},{"dsc":0,"dscpp":42.81,"time":5979.9},{"dsc":0,"dscpp":35.64,"time":6006.48},{"dsc":0,"dscpp":42.6,"time":6033.06},{"dsc":0,"dscpp":28.1,"time":6059.63},{"dsc":0,"dscpp":52.84,"time":6086.21},{"dsc":0,"dscpp":32.93,"time":6112.79},{"dsc":0,"dscpp":40.97,"time":6139.37},{"dsc":0,"dscpp":28.09,"time":6165.95},{"dsc":0,"dscpp":51.08,"time":6192.52},{"dsc":0,"dscpp":28.09,"time":6219.1},{"dsc":0,"dscpp":44.08,"time":6245.68},{"dsc":0,"dscpp":28.53,"time":6272.26},{"dsc":0,"dscpp":50.87,"time":6298.83},{"dsc":0,"dscpp":36.59,"time":6325.41},{"dsc":0,"dscpp":30.79,"time":6351.99},{"dsc":0,"dscpp":39.16,"time":6378.56},{"dsc":0,"dscpp":28.09,"time":6405.13},{"dsc":0,"dscpp":39.16,"time":6431.72},{"dsc":0,"dscpp":28.09,"time":6458.3},{"dsc":0,"dscpp":39.18,"time":6484.87},{"dsc":0,"dscpp":28.09,"time":6511.45},{"dsc":0,"dscpp":39.1,"time":6538.03},{"dsc":0,"dscpp":28.07,"time":6564.61},{"dsc":0,"dscpp":40.94,"time":6591.18},{"dsc":0,"dscpp":28.07,"time":6617.76},{"dsc":0,"dscpp":38.86,"time":6644.34},{"dsc":0,"dscpp":28.07,"time":6670.92},{"dsc":0,"dscpp":39.17,"time":6697.49},{"dsc":0,"dscpp":33.21,"time":6724.07},{"dsc":0,"dscpp":45.89,"time":6750.65},{"dsc":0,"dscpp":39.29,"time":6777.22},{"dsc":0,"dscpp":28.08,"time":6803.8},{"dsc":0,"dscpp":39.18,"time":6830.38},{"dsc":0,"dscpp":28.08,"time":6856.96},{"dsc":0,"dscpp":41.17,"time":6883.53},{"dsc":0,"dscpp":28.09,"time":6910.11},{"dsc":0,"dscpp":38.89,"time":6936.69},{"dsc":0,"dscpp":28.09,"time":6963.27},{"dsc":0,"dscpp":50.87,"time":6989.84},{"dsc":0,"dscpp":28.1,"time":7016.42},{"dsc":0,"dscpp":41.09,"time":7043},{"dsc":0,"dscpp":28.07,"time":7069.58},{"dsc":0,"dscpp":51.08,"time":7096.15},{"dsc":0,"dscpp":29.62,"time":7122.73},{"dsc":0,"dscpp":39.43,"time":7149.31},{"dsc":0,"dscpp":37.48,"time":7175.88},{"dsc":0,"dscpp":41.53,"time":7202.46},{"dsc":0,"dscpp":39.28,"time":7229.04},{"dsc":0,"dscpp":31.34,"time":7255.62},{"dsc":0,"dscpp":41.11,"time":7282.19},{"dsc":0,"dscpp":28.08,"time":7308.77},{"dsc":0,"dscpp":53.92,"time":7335.35},{"dsc":0,"dscpp":33.3,"time":7361.93},{"dsc":0,"dscpp":41.17,"time":7388.5},{"dsc":0,"dscpp":28.07,"time":7415.08},{"dsc":0,"dscpp":50.95,"time":7441.66},{"dsc":0,"dscpp":28.1,"time":7468.24},{"dsc":0,"dscpp":41.05,"time":7494.81},{"dsc":0,"dscpp":28.1,"time":7521.38},{"dsc":0,"dscpp":51.04,"time":7547.97},{"dsc":0,"dscpp":34.24,"time":7574.54},{"dsc":0,"dscpp":34.82,"time":7601.12},{"dsc":0,"dscpp":40.77,"time":7627.7},{"dsc":0,"dscpp":40.76,"time":7654.28},{"dsc":0,"dscpp":40.9,"time":7680.85},{"dsc":0,"dscpp":28.1,"time":7707.43},{"dsc":0,"dscpp":46.59,"time":7734.01},{"dsc":0,"dscpp":32.65,"time":7760.59},{"dsc":0,"dscpp":40.95,"time":7787.16},{"dsc":0,"dscpp":28.08,"time":7813.74},{"dsc":0,"dscpp":55.22,"time":7840.32},{"dsc":0,"dscpp":40.14,"time":7866.9},{"dsc":0,"dscpp":54.38,"time":7893.47},{"dsc":0,"dscpp":28.09,"time":7920.05}]
	


var xAxisKey = 'time';
dsCycleData.forEach(function(e, index) {
	e.time = '' + e.time;
});var dsCycleCtx = document.getElementById('dsCycle').getContext('2d');
const dsCycleChart = new Chart(dsCycleCtx, {
    type: 'line',
    data: {
        datasets: [{
        	label: 'Версия С\u002b\u002b',
            data: dsCycleData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'dscpp'
            },
            borderColor: '#7fc35e',
            backgroundColor: 'rgba(49, 76, 37, 0.1)',
            pointBackgroundColor: '#7fc35e',
            fill: true,
            borderWidth: 2,tension: 0.2
        },{
            label: 'Версия С',
            data: dsCycleData,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'dsc'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' ';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Активная фаза',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' ';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/dsCycle.png">
</noscript>
<ul>
<li>Потребление энергии сильно зависит от скорости подключения к bluetooth серверу. Причём иногда это занимает 2 секунды, а иногда 7. Из-за такой нестабильности сложно делать какие-то выводы</li>
<li>Потребление энергии достаточно сильно варьируется: от <strong>474.6</strong>мКл (С++ версия) до <strong>179.2</strong>мКл (С версия)</li>
<li>Время старта C++ чуть меньше. <strong>~500</strong>мс против <strong>~664</strong>мс. Однако, мне ни разу не удалось получить меньше 7 секунд для подключения С++ версии. Возможно, она пропускала какое-то bluetooth событие и вынуждена была ожидать перепосылку от сервера.</li>
</ul>
<p>Потребление энергии в режиме глубокого сна - <strong>1.7</strong>мА. Это примерно в миллион раз больше, чем теоретический минимум ESP32. Я потратил примерно 2 недели, чтобы разобраться в чём проблема. После всех ухищрений мне удалось уменьшить потребление до <strong>10</strong>мкА.</p>
<h3 id="работа-на-пониженной-частоте">Работа на пониженной частоте</h3>
<p>ESP32 может работать как на частоте 240Мгц, так и на 80Мгц. Очевидно, это уменьшает потребление энергии, за счёт более медленной работы. Но куда нам спешить, когда SPI шина работает на частоте 3Мгц?</p>
<table>
<thead>
	<tr>
		<th>Режим работы</th>
		<th>Среднее потребление тока (C)</th>
		<th>Среднее потребление тока (C++)</th>		
	</tr>
</thead>
<tbody>
	<tr>
		<td>240Мгц</td>
		<td>48.27</td>
		<td>73.36</td>
	</tr>
	<tr>
		<td>160Мгц</td>
		<td>35.81</td>
		<td>50.64</td>
	</tr>
	<tr>
		<td>80Мгц</td>
		<td><strong>26.38</strong></td>
		<td>39.44</td>
	</tr>
</tbody>
</table>
<ul>
<li>Как и ожидалось, чем меньше частота микроконтроллера, тем меньше потребление энергии</li>
<li>Иногда у меня получалось получить ещё более низкие значения, но я не смог понять как их воспроизвести</li>
</ul>
<p>Кстати, разница между С и С++ версией связана с тем, как обрабатываются события. В С-версии вся обработка происходит в отдельных тасках FreeRTOS. Основной таск вообще перестаёт работать:</p>
<pre tabindex="0"><code>I (595) main_task: Returned from app_main()
</code></pre><p>А вот С++ версия проверяет события в бесконечном цикле. Если добавить похожий цикл в С-версию, то потребление энергии будет одинаковым:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">uint64_t</span> counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">uint64_t</span> active <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (true) {
</span></span><span style="display:flex;"><span>  counter<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (counter <span style="color:#f92672">==</span> active) {
</span></span><span style="display:flex;"><span>    counter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vTaskDelay</span>(<span style="color:#a6e22e">pdMS_TO_TICKS</span>(<span style="color:#ae81ff">5000</span>));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="обработка-прерываний-uart">Обработка прерываний UART</h4>
<p>Мне настолько понравилось разбираться в потреблении энергии, что я решил измерить совершенно странные вещи. Например, мне стало интересно сколько энергии тратится на обработку полученного символа по UART. Сильно увеличенный график выглядит следующим образом:</p>
































<canvas id="uartSymbol2" width="400" height="200"></canvas>
<div class='align-center' style="margin-bottom: 1.5em">
<small>
	<a class="downloadChart" data-canvasid="uartSymbol2" download="uartSymbol2.png" href="" title="Потребление тока при передаче символа">Скачать</a>
</small>
</div>
<script>

function csvJSON(csv){
  var result = [];
  var headers=csv[0];
  for(var i=1;i<csv.length;i++){
      var obj = {};
      for(var j=0;j<headers.length;j++){
          obj[headers[j]] = parseFloat(csv[i][j]);
      }
      result.push(obj);
  }
  return result; 
}


	
	
		var uartSymbol2Data = [{"time":0,"uartSymbol":26.87},{"time":0.01,"uartSymbol":27.02},{"time":0.02,"uartSymbol":27.02},{"time":0.03,"uartSymbol":26.92},{"time":0.04,"uartSymbol":27.02},{"time":0.05,"uartSymbol":26.87},{"time":0.06,"uartSymbol":27.12},{"time":0.07,"uartSymbol":28.21},{"time":0.08,"uartSymbol":29.42},{"time":0.09,"uartSymbol":30.73},{"time":0.1,"uartSymbol":32.7},{"time":0.11,"uartSymbol":35.17},{"time":0.12,"uartSymbol":36.87},{"time":0.13,"uartSymbol":37.6},{"time":0.14,"uartSymbol":37.86},{"time":0.15,"uartSymbol":37.92},{"time":0.16,"uartSymbol":36.82},{"time":0.17,"uartSymbol":35.79},{"time":0.18,"uartSymbol":35.06},{"time":0.19,"uartSymbol":34.5},{"time":0.2,"uartSymbol":33.73},{"time":0.2,"uartSymbol":33.01},{"time":0.21,"uartSymbol":32.5},{"time":0.22,"uartSymbol":31.99},{"time":0.23,"uartSymbol":31.54},{"time":0.25,"uartSymbol":31.23},{"time":0.26,"uartSymbol":30.62},{"time":0.27,"uartSymbol":30.17},{"time":0.28,"uartSymbol":29.52},{"time":0.29,"uartSymbol":29.11},{"time":0.3,"uartSymbol":28.61},{"time":0.31,"uartSymbol":28.41},{"time":0.32,"uartSymbol":27.92},{"time":0.33,"uartSymbol":27.57},{"time":0.34,"uartSymbol":27.17},{"time":0.35,"uartSymbol":27.22},{"time":0.36,"uartSymbol":26.97},{"time":0.37,"uartSymbol":26.67},{"time":0.38,"uartSymbol":26.62},{"time":0.39,"uartSymbol":26.52},{"time":0.4,"uartSymbol":26.33},{"time":0.41,"uartSymbol":26.38},{"time":0.42,"uartSymbol":26.03},{"time":0.43,"uartSymbol":25.83},{"time":0.44,"uartSymbol":25.83},{"time":0.45,"uartSymbol":26.03},{"time":0.45,"uartSymbol":25.88},{"time":0.46,"uartSymbol":25.78},{"time":0.47,"uartSymbol":25.63},{"time":0.48,"uartSymbol":25.39},{"time":0.5,"uartSymbol":25.59},{"time":0.51,"uartSymbol":25.59},{"time":0.52,"uartSymbol":25.49},{"time":0.53,"uartSymbol":25.39},{"time":0.54,"uartSymbol":25.44},{"time":0.55,"uartSymbol":25.49},{"time":0.56,"uartSymbol":25.24},{"time":0.57,"uartSymbol":24.99},{"time":0.58,"uartSymbol":25.24},{"time":0.59,"uartSymbol":25.49},{"time":0.6,"uartSymbol":25.54},{"time":0.61,"uartSymbol":25.44},{"time":0.62,"uartSymbol":25.54},{"time":0.63,"uartSymbol":25.49},{"time":0.64,"uartSymbol":25.44},{"time":0.65,"uartSymbol":25.44},{"time":0.66,"uartSymbol":25.39},{"time":0.67,"uartSymbol":25.39},{"time":0.68,"uartSymbol":25.44},{"time":0.69,"uartSymbol":25.68},{"time":0.7,"uartSymbol":25.39},{"time":0.7,"uartSymbol":25.54},{"time":0.71,"uartSymbol":25.63},{"time":0.72,"uartSymbol":25.78},{"time":0.73,"uartSymbol":25.73},{"time":0.75,"uartSymbol":25.83},{"time":0.76,"uartSymbol":25.83},{"time":0.77,"uartSymbol":25.88},{"time":0.78,"uartSymbol":25.88},{"time":0.79,"uartSymbol":25.93},{"time":0.8,"uartSymbol":25.93},{"time":0.81,"uartSymbol":26.23},{"time":0.82,"uartSymbol":26.18},{"time":0.83,"uartSymbol":26.43},{"time":0.84,"uartSymbol":26.33},{"time":0.85,"uartSymbol":26.28},{"time":0.86,"uartSymbol":26.28},{"time":0.87,"uartSymbol":26.43},{"time":0.88,"uartSymbol":26.28},{"time":0.89,"uartSymbol":26.38},{"time":0.9,"uartSymbol":26.47},{"time":0.91,"uartSymbol":26.28},{"time":0.92,"uartSymbol":26.33},{"time":0.93,"uartSymbol":26.47},{"time":0.94,"uartSymbol":26.47},{"time":0.95,"uartSymbol":26.33},{"time":0.95,"uartSymbol":26.38},{"time":0.96,"uartSymbol":26.38},{"time":0.97,"uartSymbol":26.72},{"time":0.98,"uartSymbol":26.72},{"time":1,"uartSymbol":26.72},{"time":1.01,"uartSymbol":26.87},{"time":1.02,"uartSymbol":27.22},{"time":1.03,"uartSymbol":27.42},{"time":1.04,"uartSymbol":27.67},{"time":1.05,"uartSymbol":27.87},{"time":1.06,"uartSymbol":28.16},{"time":1.07,"uartSymbol":28.71},{"time":1.08,"uartSymbol":28.96},{"time":1.09,"uartSymbol":29.32},{"time":1.1,"uartSymbol":29.82},{"time":1.11,"uartSymbol":30.07},{"time":1.12,"uartSymbol":30.37},{"time":1.13,"uartSymbol":30.57},{"time":1.14,"uartSymbol":30.93},{"time":1.15,"uartSymbol":31.23},{"time":1.16,"uartSymbol":31.43},{"time":1.17,"uartSymbol":31.23},{"time":1.18,"uartSymbol":31.18},{"time":1.19,"uartSymbol":30.78},{"time":1.2,"uartSymbol":30.88},{"time":1.2,"uartSymbol":31.13},{"time":1.21,"uartSymbol":31.03},{"time":1.22,"uartSymbol":30.88},{"time":1.23,"uartSymbol":30.62},{"time":1.25,"uartSymbol":30.42},{"time":1.26,"uartSymbol":30.62},{"time":1.27,"uartSymbol":30.57},{"time":1.28,"uartSymbol":30.73},{"time":1.29,"uartSymbol":30.52},{"time":1.3,"uartSymbol":30.22},{"time":1.31,"uartSymbol":29.82},{"time":1.32,"uartSymbol":29.82},{"time":1.33,"uartSymbol":29.67},{"time":1.34,"uartSymbol":29.82},{"time":1.35,"uartSymbol":29.57},{"time":1.36,"uartSymbol":29.37},{"time":1.37,"uartSymbol":29.11},{"time":1.38,"uartSymbol":29.01},{"time":1.39,"uartSymbol":29.01},{"time":1.4,"uartSymbol":28.76},{"time":1.41,"uartSymbol":28.76},{"time":1.42,"uartSymbol":28.71},{"time":1.43,"uartSymbol":28.56},{"time":1.44,"uartSymbol":28.61},{"time":1.45,"uartSymbol":28.36},{"time":1.45,"uartSymbol":28.46},{"time":1.46,"uartSymbol":28.21},{"time":1.47,"uartSymbol":28.21},{"time":1.48,"uartSymbol":28.31},{"time":1.5,"uartSymbol":28.11},{"time":1.51,"uartSymbol":27.97},{"time":1.52,"uartSymbol":28.01}]
	


var xAxisKey = 'time';
uartSymbol2Data.forEach(function(e, index) {
	e.time = '' + e.time;
});var uartSymbol2Ctx = document.getElementById('uartSymbol2').getContext('2d');
const uartSymbol2Chart = new Chart(uartSymbol2Ctx, {
    type: 'line',
    data: {
        datasets: [{
            label: 'Ток',
            data: uartSymbol2Data,
            parsing: {
                xAxisKey: xAxisKey,
                yAxisKey: 'uartSymbol'
            },
            borderColor: '#ffcd00',
            backgroundColor: 'rgba(255, 205, 0, 0.1)',
            pointBackgroundColor: '#ffcd00',
            fill: true,
            borderWidth: 2,
            tension: 0.2
        }]
    },
    options: {
    	stacked: false,
    	elements: {
    		point: {
    		      radius: 0,
    		      hitRadius: 10,
    		      hoverRadius: 4,
    		      hoverBorderWidth: 3
    		}	
    	},
        animation: {
            duration: 0
        },
        interaction: {
            intersect: false,
            mode: 'index',
        },
        scales: {x: {
                title: {
                    display: true,
                    text: 'Время'
                },
                ticks: {
                    
                    callback: function(value, index, ticks) {
                    	
                        return this.getLabelForValue(value) + ' мс';
                    }}
        	},y: {
                beginAtZero: true,
                position: 'left',title: {
                    display: true,
                    text: 'Ток'
                },
                ticks: {
                    callback: function(value, index, ticks) {
                        return value + ' мA';
                    }}
            }},
        plugins: {
            title: {
                display: true,
                text: 'Потребление тока при передаче символа',
                font: {
                	size: 16
                }
            },
            legend: {
                display: false
            },
            tooltip: {
            	position: 'nearest',
            	callbacks: {title: function(context) {
                        return context[0].label + ' мс';
            		},label: function(context) {
            			let label = context.dataset.label || '';

                        if (label) {
                            label += ': ';
                        }
                        
                        var unit = "мA";if (context.parsed.y !== null) {
                        	label += context.parsed.y + ' ' + unit;
                        }
                        
                        return label;
            		}
            	}
            }
        }
    }
});
</script><noscript>
	<img src="img/uartSymbol2.png">
</noscript>
<ul>
<li>Каждое нажатие вызывает скачок потребления тока примерно на <strong>10м</strong>А и длится примерно <strong>1.4</strong>мс</li>
<li>Не очень понятно почему два скачка</li>
<li>Если положить в буфер сразу несколько символов с помощью CMD+V, то это сгенерирует одно прерывание и очень похожий график</li>
</ul>
<p>Если за <strong>1.4</strong>мс потрачено <strong>37.32</strong>мкКл, а в режиме простоя за это же время тратится <strong>35.11</strong>мкКл, то нажатие на кнопку обошлось в <strong>2.21</strong>мкКл.</p>
<h2 id="выводы">Выводы</h2>
<ul>
<li>С-код в среднем более энергоэффективен за счёт использования задач FreeRTOS, а не бесконечного цикла</li>
<li>По графику потребления энергии можно находить баги в коде</li>
<li>Bluetooth Low Energy - не самый предсказуемый в плане потребления энергии протокол</li>
<li>Даже если код перехода в глубокий сон вызван правильным образом - это не гарантирует того, что устройство действительно потребляет мало энергии. Нужно мерить!</li>
</ul>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='tags'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z" />
<line x1="7" y1="7" x2="7" y2="7" />
</svg>
<span class='screen-reader-text'>tags: </span><a class='tag' href='/tags/lora/'>Lora</a>, <a class='tag' href='/tags/lora-at/'>Lora-At</a>, <a class='tag' href='/tags/esp32/'>Esp32</a>, <a class='tag' href='/tags/esp-idf/'>Esp-Idf</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/power-profiler-kit2/'>
        <span aria-hidden='true'><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><line x1="20" y1="12" x2="4" y2="12" />
<polyline points="10 18 4 12 10 6" />
</svg>
 </span>
        <span class='screen-reader-text'>: </span>Power Profiler Kit 2</a>
    </div><div class='next-entry sep-before'>
      <a href='/posts/troubleshoot-deep-sleep/'>
        <span class='screen-reader-text'>: </span>Оптимизация энергопотребления LoRa - Часть 2<span aria-hidden='true'> <svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><line x1="4" y1="12" x2="20" y2="12" />
<polyline points="14 6 20 12 14 18" />
</svg>
</span>
      </a>
    </div></div>
</nav>


<section id='comments' class='comments'>
  <div class='container sep-before'>
    <div class='comments-area'><script>
  var remark_config = {
    host: "https://remark42.dernasherbrezon.com", 
    site_id: '9134',
    locale: 'ru',
    components: ['embed'] 
                          
                          
                          
                          
                          
  };

  (function(c) {
    for(var i = 0; i < c.length; i++){
      var d = document, s = d.createElement('script');
      s.src = remark_config.host + '/web/' +c[i] +'.js';
      s.defer = true;
      (d.head || d.body).appendChild(s);
    }
  })(remark_config.components || ['embed']);
</script>
<div id="remark42"></div>
</div>
  </div>
</section>

      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label=''>
    <ul><li>
        <a href='https://github.com/dernasherbrezon' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'></span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/dernasherbrezon' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'></span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" />
</svg>
</a>
      </li><li>
        <a href='mailto:dernasherbrezon@gmail.com' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'></span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
<polyline points="22,6 12,13 2,6" />
</svg>
</a>
      </li><li>
        <a href='https://t.me/dernasherbrezonChannel' target='_blank' rel='noopener me'>
          <span class='screen-reader-text'></span><svg
  class="icon"
  xmlns="http://www.w3.org/2000/svg"
  viewbox="0 0 24 24"
  stroke-linecap="round"
  stroke-linejoin="round"
  stroke-width="2"
  aria-hidden="true"
><path d="M23.91 3.79L20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72 0-.6-.27-.84-.95L6.3 13.7l-5.45-1.7c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z" />
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p><a href="https://creativecommons.org/licenses/by-nc-nd/3.0/">CC BY-NC-ND 3.0</a> &copy; 2017-2024 dernasherbrezon </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.c3bcf2df.js'></script><script>
var downloadLinks = document.getElementsByClassName('downloadChart');
for (var i = 0; i < downloadLinks.length; i++) {
	downloadLinks[i].addEventListener('click', function(event){
		var targetElement = event.target || event.srcElement;
		var canvasId = targetElement.getAttribute('data-canvasid');
		console.log(canvasId);
		var url_base64 = document.getElementById(canvasId).toDataURL("image/png");
		targetElement.href = url_base64;
	});
}
</script>
</body>

</html>

